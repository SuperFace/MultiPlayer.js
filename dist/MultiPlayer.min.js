(function e(t,r){if(typeof exports==="object"&&typeof module==="object")module.exports=r();else if(typeof define==="function"&&define.amd)define([],r);else if(typeof exports==="object")exports["Hls"]=r();else t["Hls"]=r()})(this,function(){return function(e){var t={};function r(i){if(t[i]){return t[i].exports}var a=t[i]={i:i,l:false,exports:{}};e[i].call(a.exports,a,a.exports,r);a.l=true;return a.exports}r.m=e;r.c=t;r.d=function(e,t,i){if(!r.o(e,t)){Object.defineProperty(e,t,{configurable:false,enumerable:true,get:i})}};r.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};r.d(t,"a",t);return t};r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};r.p="/dist/";return r(r.s=8)}([function(e,t,r){"use strict";r.d(t,"a",function(){return f});r.d(t,"b",function(){return d});var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(){}var n={trace:a,debug:a,log:a,warn:a,info:a,error:a};var s=n;function o(e,t){t="["+e+"] > "+t;return t}function l(e){var t=self.console[e];if(t){return function(){for(var r=arguments.length,i=Array(r),a=0;a<r;a++){i[a]=arguments[a]}if(i[0]){i[0]=o(e,i[0])}t.apply(self.console,i)}}return a}function u(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++){r[i-1]=arguments[i]}r.forEach(function(t){s[t]=e[t]?e[t].bind(e):l(t)})}var f=function e(t){if(t===true||(typeof t==="undefined"?"undefined":i(t))==="object"){u(t,"debug","log","info","warn","error");try{s.log()}catch(e){s=n}}else{s=n}};var d=s},function(e,t,r){"use strict";t["a"]={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},function(e,t,r){"use strict";r.d(t,"b",function(){return i});r.d(t,"a",function(){return a});var i={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"};var a={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(e,t,r){"use strict";r.d(t,"b",function(){return n});function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(){i(this,e)}e.isHeader=function e(t,r){if(r+10<=t.length){if(t[r]===73&&t[r+1]===68&&t[r+2]===51){if(t[r+3]<255&&t[r+4]<255){if(t[r+6]<128&&t[r+7]<128&&t[r+8]<128&&t[r+9]<128){return true}}}}return false};e.isFooter=function e(t,r){if(r+10<=t.length){if(t[r]===51&&t[r+1]===68&&t[r+2]===73){if(t[r+3]<255&&t[r+4]<255){if(t[r+6]<128&&t[r+7]<128&&t[r+8]<128&&t[r+9]<128){return true}}}}return false};e.getID3Data=function t(r,i){var a=i;var n=0;while(e.isHeader(r,i)){n+=10;var s=e._readSize(r,i+6);n+=s;if(e.isFooter(r,i+10)){n+=10}i+=n}if(n>0){return r.subarray(a,a+n)}return undefined};e._readSize=function e(t,r){var i=0;i=(t[r]&127)<<21;i|=(t[r+1]&127)<<14;i|=(t[r+2]&127)<<7;i|=t[r+3]&127;return i};e.getTimeStamp=function t(r){var i=e.getID3Frames(r);for(var a=0;a<i.length;a++){var n=i[a];if(e.isTimeStampFrame(n)){return e._readTimeStamp(n)}}return undefined};e.isTimeStampFrame=function e(t){return t&&t.key==="PRIV"&&t.info==="com.apple.streaming.transportStreamTimestamp"};e._getFrameData=function t(r){var i=String.fromCharCode(r[0],r[1],r[2],r[3]);var a=e._readSize(r,4);var n=10;return{type:i,size:a,data:r.subarray(n,n+a)}};e.getID3Frames=function t(r){var i=0;var a=[];while(e.isHeader(r,i)){var n=e._readSize(r,i+6);i+=10;var s=i+n;while(i+8<s){var o=e._getFrameData(r.subarray(i));var l=e._decodeFrame(o);if(l){a.push(l)}i+=o.size+10}if(e.isFooter(r,i)){i+=10}}return a};e._decodeFrame=function t(r){if(r.type==="PRIV"){return e._decodePrivFrame(r)}else if(r.type[0]==="T"){return e._decodeTextFrame(r)}else if(r.type[0]==="W"){return e._decodeURLFrame(r)}return undefined};e._readTimeStamp=function e(t){if(t.data.byteLength===8){var r=new Uint8Array(t.data);var i=r[3]&1;var a=(r[4]<<23)+(r[5]<<15)+(r[6]<<7)+r[7];a/=45;if(i){a+=47721858.84}return Math.round(a)}return undefined};e._decodePrivFrame=function t(r){if(r.size<2){return undefined}var i=e._utf8ArrayToStr(r.data,true);var a=new Uint8Array(r.data.subarray(i.length+1));return{key:r.type,info:i,data:a.buffer}};e._decodeTextFrame=function t(r){if(r.size<2){return undefined}if(r.type==="TXXX"){var i=1;var a=e._utf8ArrayToStr(r.data.subarray(i));i+=a.length+1;var n=e._utf8ArrayToStr(r.data.subarray(i));return{key:r.type,info:a,data:n}}else{var s=e._utf8ArrayToStr(r.data.subarray(1));return{key:r.type,data:s}}};e._decodeURLFrame=function t(r){if(r.type==="WXXX"){if(r.size<2){return undefined}var i=1;var a=e._utf8ArrayToStr(r.data.subarray(i));i+=a.length+1;var n=e._utf8ArrayToStr(r.data.subarray(i));return{key:r.type,info:a,data:n}}else{var s=e._utf8ArrayToStr(r.data);return{key:r.type,data:s}}};e._utf8ArrayToStr=function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var i=t.length;var a=void 0;var n=void 0;var s=void 0;var o="";var l=0;while(l<i){a=t[l++];if(a===0&&r){return o}else if(a===0||a===3){continue}switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(a);break;case 12:case 13:n=t[l++];o+=String.fromCharCode((a&31)<<6|n&63);break;case 14:n=t[l++];s=t[l++];o+=String.fromCharCode((a&15)<<12|(n&63)<<6|(s&63)<<0);break;default:}}return o};return e}();var n=a._utf8ArrayToStr;t["a"]=a},function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(t,r){i(this,e);this.subtle=t;this.aesIV=r}e.prototype.decrypt=function e(t,r){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},r,t)};return e}();var n=a;function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=function(){function e(t,r){s(this,e);this.subtle=t;this.key=r}e.prototype.expandKey=function e(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},false,["encrypt","decrypt"])};return e}();var l=o;function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var f=function(){function e(){u(this,e);this.rcon=[0,1,2,4,8,16,32,64,128,27,54];this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.sBox=new Uint32Array(256);this.invSBox=new Uint32Array(256);this.key=new Uint32Array(0);this.initTable()}e.prototype.uint8ArrayToUint32Array_=function e(t){var r=new DataView(t);var i=new Uint32Array(4);for(var a=0;a<4;a++){i[a]=r.getUint32(a*4)}return i};e.prototype.initTable=function e(){var t=this.sBox;var r=this.invSBox;var i=this.subMix;var a=i[0];var n=i[1];var s=i[2];var o=i[3];var l=this.invSubMix;var u=l[0];var f=l[1];var d=l[2];var c=l[3];var h=new Uint32Array(256);var p=0;var v=0;var g=0;for(g=0;g<256;g++){if(g<128){h[g]=g<<1}else{h[g]=g<<1^283}}for(g=0;g<256;g++){var m=v^v<<1^v<<2^v<<3^v<<4;m=m>>>8^m&255^99;t[p]=m;r[m]=p;var y=h[p];var b=h[y];var _=h[b];var E=h[m]*257^m*16843008;a[p]=E<<24|E>>>8;n[p]=E<<16|E>>>16;s[p]=E<<8|E>>>24;o[p]=E;E=_*16843009^b*65537^y*257^p*16843008;u[m]=E<<24|E>>>8;f[m]=E<<16|E>>>16;d[m]=E<<8|E>>>24;c[m]=E;if(!p){p=v=1}else{p=y^h[h[h[_^y]]];v^=h[h[v]]}}};e.prototype.expandKey=function e(t){var r=this.uint8ArrayToUint32Array_(t);var i=true;var a=0;while(a<r.length&&i){i=r[a]===this.key[a];a++}if(i){return}this.key=r;var n=this.keySize=r.length;if(n!==4&&n!==6&&n!==8){throw new Error("Invalid aes key size="+n)}var s=this.ksRows=(n+6+1)*4;var o=void 0;var l=void 0;var u=this.keySchedule=new Uint32Array(s);var f=this.invKeySchedule=new Uint32Array(s);var d=this.sBox;var c=this.rcon;var h=this.invSubMix;var p=h[0];var v=h[1];var g=h[2];var m=h[3];var y=void 0;var b=void 0;for(o=0;o<s;o++){if(o<n){y=u[o]=r[o];continue}b=y;if(o%n===0){b=b<<8|b>>>24;b=d[b>>>24]<<24|d[b>>>16&255]<<16|d[b>>>8&255]<<8|d[b&255];b^=c[o/n|0]<<24}else if(n>6&&o%n===4){b=d[b>>>24]<<24|d[b>>>16&255]<<16|d[b>>>8&255]<<8|d[b&255]}u[o]=y=(u[o-n]^b)>>>0}for(l=0;l<s;l++){o=s-l;if(l&3){b=u[o]}else{b=u[o-4]}if(l<4||o<=4){f[l]=b}else{f[l]=p[d[b>>>24]]^v[d[b>>>16&255]]^g[d[b>>>8&255]]^m[d[b&255]]}f[l]=f[l]>>>0}};e.prototype.networkToHostOrderSwap=function e(t){return t<<24|(t&65280)<<8|(t&16711680)>>8|t>>>24};e.prototype.decrypt=function e(t,r,i){var a=this.keySize+6;var n=this.invKeySchedule;var s=this.invSBox;var o=this.invSubMix;var l=o[0];var u=o[1];var f=o[2];var d=o[3];var c=this.uint8ArrayToUint32Array_(i);var h=c[0];var p=c[1];var v=c[2];var g=c[3];var m=new Int32Array(t);var y=new Int32Array(m.length);var b=void 0,_=void 0,E=void 0,T=void 0;var S=void 0,w=void 0,R=void 0,A=void 0;var L=void 0,I=void 0,D=void 0,k=void 0;var O,x;var C=this.networkToHostOrderSwap;while(r<m.length){L=C(m[r]);I=C(m[r+1]);D=C(m[r+2]);k=C(m[r+3]);S=L^n[0];w=k^n[1];R=D^n[2];A=I^n[3];O=4;for(x=1;x<a;x++){b=l[S>>>24]^u[w>>16&255]^f[R>>8&255]^d[A&255]^n[O];_=l[w>>>24]^u[R>>16&255]^f[A>>8&255]^d[S&255]^n[O+1];E=l[R>>>24]^u[A>>16&255]^f[S>>8&255]^d[w&255]^n[O+2];T=l[A>>>24]^u[S>>16&255]^f[w>>8&255]^d[R&255]^n[O+3];S=b;w=_;R=E;A=T;O=O+4}b=s[S>>>24]<<24^s[w>>16&255]<<16^s[R>>8&255]<<8^s[A&255]^n[O];_=s[w>>>24]<<24^s[R>>16&255]<<16^s[A>>8&255]<<8^s[S&255]^n[O+1];E=s[R>>>24]<<24^s[A>>16&255]<<16^s[S>>8&255]<<8^s[w&255]^n[O+2];T=s[A>>>24]<<24^s[S>>16&255]<<16^s[w>>8&255]<<8^s[R&255]^n[O+3];O=O+3;y[r]=C(b^h);y[r+1]=C(T^p);y[r+2]=C(E^v);y[r+3]=C(_^g);h=L;p=I;v=D;g=k;r=r+4}return y.buffer};e.prototype.destroy=function e(){this.key=undefined;this.keySize=undefined;this.ksRows=undefined;this.sBox=undefined;this.invSBox=undefined;this.subMix=undefined;this.invSubMix=undefined;this.keySchedule=undefined;this.invKeySchedule=undefined;this.rcon=undefined};return e}();var d=f;var c=r(2);var h=r(0);function p(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var v=function(){function e(t,r){p(this,e);this.observer=t;this.config=r;this.logEnabled=true;try{var i=crypto?crypto:self.crypto;this.subtle=i.subtle||i.webkitSubtle}catch(e){}this.disableWebCrypto=!this.subtle}e.prototype.isSync=function e(){return this.disableWebCrypto&&this.config.enableSoftwareAES};e.prototype.decrypt=function e(t,r,i,a){var s=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){if(this.logEnabled){h["b"].log("JS AES decrypt");this.logEnabled=false}var o=this.decryptor;if(!o){this.decryptor=o=new d}o.expandKey(r);a(o.decrypt(t,0,i))}else{if(this.logEnabled){h["b"].log("WebCrypto AES decrypt");this.logEnabled=false}var u=this.subtle;if(this.key!==r){this.key=r;this.fastAesKey=new l(u,r)}this.fastAesKey.expandKey().then(function(e){var o=new n(u,i);o.decrypt(t,e).catch(function(e){s.onWebCryptoError(e,t,r,i,a)}).then(function(e){a(e)})}).catch(function(e){s.onWebCryptoError(e,t,r,i,a)})}};e.prototype.onWebCryptoError=function e(t,r,i,a,n){if(this.config.enableSoftwareAES){h["b"].log("WebCrypto Error, disable WebCrypto API");this.disableWebCrypto=true;this.logEnabled=true;this.decrypt(r,i,a,n)}else{h["b"].error("decrypting error : "+t.message);this.observer.trigger(Event.ERROR,{type:c["b"].MEDIA_ERROR,details:c["a"].FRAG_DECRYPT_ERROR,fatal:true,reason:t.message})}};e.prototype.destroy=function e(){var t=this.decryptor;if(t){t.destroy();this.decryptor=undefined}};return e}();var g=t["a"]=v},function(e,t){function r(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}e.exports=r;r.EventEmitter=r;r.prototype._events=undefined;r.prototype._maxListeners=undefined;r.defaultMaxListeners=10;r.prototype.setMaxListeners=function(e){if(!a(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");this._maxListeners=e;return this};r.prototype.emit=function(e){var t,r,a,o,l,u;if(!this._events)this._events={};if(e==="error"){if(!this._events.error||n(this._events.error)&&!this._events.error.length){t=arguments[1];if(t instanceof Error){throw t}else{var f=new Error('Uncaught, unspecified "error" event. ('+t+")");f.context=t;throw f}}}r=this._events[e];if(s(r))return false;if(i(r)){switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1);r.apply(this,o)}}else if(n(r)){o=Array.prototype.slice.call(arguments,1);u=r.slice();a=u.length;for(l=0;l<a;l++)u[l].apply(this,o)}return true};r.prototype.addListener=function(e,t){var a;if(!i(t))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",e,i(t.listener)?t.listener:t);if(!this._events[e])this._events[e]=t;else if(n(this._events[e]))this._events[e].push(t);else this._events[e]=[this._events[e],t];if(n(this._events[e])&&!this._events[e].warned){if(!s(this._maxListeners)){a=this._maxListeners}else{a=r.defaultMaxListeners}if(a&&a>0&&this._events[e].length>a){this._events[e].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[e].length);if(typeof console.trace==="function"){console.trace()}}}return this};r.prototype.on=r.prototype.addListener;r.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var r=false;function a(){this.removeListener(e,a);if(!r){r=true;t.apply(this,arguments)}}a.listener=t;this.on(e,a);return this};r.prototype.removeListener=function(e,t){var r,a,s,o;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;r=this._events[e];s=r.length;a=-1;if(r===t||i(r.listener)&&r.listener===t){delete this._events[e];if(this._events.removeListener)this.emit("removeListener",e,t)}else if(n(r)){for(o=s;o-- >0;){if(r[o]===t||r[o].listener&&r[o].listener===t){a=o;break}}if(a<0)return this;if(r.length===1){r.length=0;delete this._events[e]}else{r.splice(a,1)}if(this._events.removeListener)this.emit("removeListener",e,t)}return this};r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[e])delete this._events[e];return this}if(arguments.length===0){for(t in this._events){if(t==="removeListener")continue;this.removeAllListeners(t)}this.removeAllListeners("removeListener");this._events={};return this}r=this._events[e];if(i(r)){this.removeListener(e,r)}else if(r){while(r.length)this.removeListener(e,r[r.length-1])}delete this._events[e];return this};r.prototype.listeners=function(e){var t;if(!this._events||!this._events[e])t=[];else if(i(this._events[e]))t=[this._events[e]];else t=this._events[e].slice();return t};r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;else if(t)return t.length}return 0};r.listenerCount=function(e,t){return e.listenerCount(t)};function i(e){return typeof e==="function"}function a(e){return typeof e==="number"}function n(e){return typeof e==="object"&&e!==null}function s(e){return e===void 0}},function(e,t,r){(function(r){var i=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/;var a=/^([^\/;?#]*)(.*)$/;var n=/(?:\/|^)\.(?=\/)/g;var s=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g;var o={buildAbsoluteURL:function(e,t,r){r=r||{};e=e.trim();t=t.trim();if(!t){if(!r.alwaysNormalize){return e}var i=this.parseURL(e);if(!s){throw new Error("Error trying to parse base URL.")}i.path=o.normalizePath(i.path);return o.buildURLFromParts(i)}var n=this.parseURL(t);if(!n){throw new Error("Error trying to parse relative URL.")}if(n.scheme){if(!r.alwaysNormalize){return t}n.path=o.normalizePath(n.path);return o.buildURLFromParts(n)}var s=this.parseURL(e);if(!s){throw new Error("Error trying to parse base URL.")}if(!s.netLoc&&s.path&&s.path[0]!=="/"){var l=a.exec(s.path);s.netLoc=l[1];s.path=l[2]}if(s.netLoc&&!s.path){s.path="/"}var u={scheme:s.scheme,netLoc:n.netLoc,path:null,params:n.params,query:n.query,fragment:n.fragment};if(!n.netLoc){u.netLoc=s.netLoc;if(n.path[0]!=="/"){if(!n.path){u.path=s.path;if(!n.params){u.params=s.params;if(!n.query){u.query=s.query}}}else{var f=s.path;var d=f.substring(0,f.lastIndexOf("/")+1)+n.path;u.path=o.normalizePath(d)}}}if(u.path===null){u.path=r.alwaysNormalize?o.normalizePath(n.path):n.path}return o.buildURLFromParts(u)},parseURL:function(e){var t=i.exec(e);if(!t){return null}return{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}},normalizePath:function(e){e=e.split("").reverse().join("").replace(n,"");while(e.length!==(e=e.replace(s,"")).length){}return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};if(true)e.exports=o;else if(typeof define==="function"&&define.amd)define([],function(){return o});else if(typeof t==="object")t["URLToolkit"]=o;else r["URLToolkit"]=o})(this)},function(e,t,r){"use strict";var i=r(1);var a=r(2);var n=r(4);var s=r(0);function o(e,t,r,i){var n,o,l,u,f,d=navigator.userAgent.toLowerCase(),c=i,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];n=((t[r+2]&192)>>>6)+1;o=(t[r+2]&60)>>>2;if(o>h.length-1){e.trigger(Event.ERROR,{type:a["b"].MEDIA_ERROR,details:a["a"].FRAG_PARSING_ERROR,fatal:true,reason:"invalid ADTS sampling index:"+o});return}u=(t[r+2]&1)<<2;u|=(t[r+3]&192)>>>6;s["b"].log("manifest codec:"+i+",ADTS data:type:"+n+",sampleingIndex:"+o+"["+h[o]+"Hz],channelConfig:"+u);if(/firefox/i.test(d)){if(o>=6){n=5;f=new Array(4);l=o-3}else{n=2;f=new Array(2);l=o}}else if(d.indexOf("android")!==-1){n=2;f=new Array(2);l=o}else{n=5;f=new Array(4);if(i&&(i.indexOf("mp4a.40.29")!==-1||i.indexOf("mp4a.40.5")!==-1)||!i&&o>=6){l=o-3}else{if(i&&i.indexOf("mp4a.40.2")!==-1&&(o>=6&&u===1||/vivaldi/i.test(d))||!i&&u===1){n=2;f=new Array(2)}l=o}}f[0]=n<<3;f[0]|=(o&14)>>1;f[1]|=(o&1)<<7;f[1]|=u<<3;if(n===5){f[1]|=(l&14)>>1;f[2]=(l&1)<<7;f[2]|=2<<2;f[3]=0}return{config:f,samplerate:h[o],channelCount:u,codec:"mp4a.40."+n,manifestCodec:c}}function l(e,t){return e[t]===255&&(e[t+1]&246)===240}function u(e,t){return!!(e[t+1]&1)?7:9}function f(e,t){return(e[t+3]&3)<<11|e[t+4]<<3|(e[t+5]&224)>>>5}function d(e,t){if(t+1<e.length&&l(e,t)){return true}return false}function c(e,t){if(t+1<e.length&&l(e,t)){var r=u(e,t);var i=r;if(t+5<e.length){i=f(e,t)}var a=t+i;if(a===e.length||a+1<e.length&&l(e,a)){return true}}return false}function h(e,t,r,i,a){if(!e.samplerate){var n=o(t,r,i,a);e.config=n.config;e.samplerate=n.samplerate;e.channelCount=n.channelCount;e.codec=n.codec;e.manifestCodec=n.manifestCodec;s["b"].log("parsed codec:"+e.codec+",rate:"+n.samplerate+",nb channel:"+n.channelCount)}}function p(e){return 1024*9e4/e}function v(e,t,r,i,a){var n,s,o;var l=e.length;n=u(e,t);s=f(e,t);s-=n;if(s>0&&t+n+s<=l){o=r+i*a;return{headerLength:n,frameLength:s,stamp:o}}return undefined}function g(e,t,r,i,a){var n=p(e.samplerate);var s=v(t,r,i,a,n);if(s){var o=s.stamp;var l=s.headerLength;var u=s.frameLength;var f={unit:t.subarray(r+l,r+l+u),pts:o,dts:o};e.samples.push(f);e.len+=u;return{sample:f,length:u+l}}return undefined}var m=r(3);function y(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var b=function(){function e(t,r,i){y(this,e);this.observer=t;this.config=i;this.remuxer=r}e.prototype.resetInitSegment=function e(t,r,i,a){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:true,samples:[],len:0,manifestCodec:r,duration:a,inputTimeScale:9e4}};e.prototype.resetTimeStamp=function e(){};e.probe=function e(t){if(!t){return false}var r=m["a"].getID3Data(t,0)||[];var i=r.length;for(var a=t.length;i<a;i++){if(c(t,i)){s["b"].log("ADTS sync word found !");return true}}return false};e.prototype.append=function e(t,r,i,a){var n=this._audioTrack;var o=m["a"].getID3Data(t,0)||[];var l=m["a"].getTimeStamp(o);var u=l?90*l:r*9e4;var f=0;var c=u;var p=t.length;var v=o.length;var y=[{pts:c,dts:c,data:o}];while(v<p-1){if(d(t,v)&&v+5<p){h(n,this.observer,t,v,n.manifestCodec);var b=g(n,t,v,u,f);if(b){v+=b.length;c=b.sample.pts;f++}else{s["b"].log("Unable to parse AAC frame");break}}else if(m["a"].isHeader(t,v)){o=m["a"].getID3Data(t,v);y.push({pts:c,dts:c,data:o});v+=o.length}else{v++}}this.remuxer.remux(n,{samples:[]},{samples:y,inputTimeScale:9e4},{samples:[]},r,i,a)};e.prototype.destroy=function e(){};return e}();var _=b;function E(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var T=Math.pow(2,32)-1;var S=function(){function e(t,r){E(this,e);this.observer=t;this.remuxer=r}e.prototype.resetTimeStamp=function e(t){this.initPTS=t};e.prototype.resetInitSegment=function t(r,a,n,s){if(r&&r.byteLength){var o=this.initData=e.parseInitSegment(r);if(a==null){a="mp4a.40.5"}if(n==null){n="avc1.42e01e"}var l={};if(o.audio&&o.video){l.audiovideo={container:"video/mp4",codec:a+","+n,initSegment:s?r:null}}else{if(o.audio){l.audio={container:"audio/mp4",codec:a,initSegment:s?r:null}}if(o.video){l.video={container:"video/mp4",codec:n,initSegment:s?r:null}}}this.observer.trigger(i["a"].FRAG_PARSING_INIT_SEGMENT,{tracks:l})}else{if(a){this.audioCodec=a}if(n){this.videoCodec=n}}};e.probe=function t(r){return e.findBox({data:r,start:0,end:Math.min(r.length,16384)},["moof"]).length>0};e.bin2str=function e(t){return String.fromCharCode.apply(null,t)};e.readUint32=function e(t,r){if(t.data){r+=t.start;t=t.data}var i=t[r]<<24|t[r+1]<<16|t[r+2]<<8|t[r+3];return i<0?4294967296+i:i};e.writeUint32=function e(t,r,i){if(t.data){r+=t.start;t=t.data}t[r]=i>>24;t[r+1]=i>>16&255;t[r+2]=i>>8&255;t[r+3]=i&255};e.findBox=function t(r,i){var a=[],n,s,o,l,u,f,d;if(r.data){f=r.start;l=r.end;r=r.data}else{f=0;l=r.byteLength}if(!i.length){return null}for(n=f;n<l;){s=e.readUint32(r,n);o=e.bin2str(r.subarray(n+4,n+8));d=s>1?n+s:l;if(o===i[0]){if(i.length===1){a.push({data:r,start:n+8,end:d})}else{u=e.findBox({data:r,start:n+8,end:d},i.slice(1));if(u.length){a=a.concat(u)}}}n=d}return a};e.parseInitSegment=function t(r){var i=[];var a=e.findBox(r,["moov","trak"]);a.forEach(function(t){var r=e.findBox(t,["tkhd"])[0];if(r){var a=r.data[r.start];var n=a===0?12:20;var o=e.readUint32(r,n);var l=e.findBox(t,["mdia","mdhd"])[0];if(l){a=l.data[l.start];n=a===0?12:20;var u=e.readUint32(l,n);var f=e.findBox(t,["mdia","hdlr"])[0];if(f){var d=e.bin2str(f.data.subarray(f.start+8,f.start+12));var c={soun:"audio",vide:"video"}[d];if(c){var h=e.findBox(t,["mdia","minf","stbl","stsd"]);if(h.length){h=h[0];var p=e.bin2str(h.data.subarray(h.start+12,h.start+16));s["b"].log("MP4Demuxer:"+c+":"+p+" found")}i[o]={timescale:u,type:c};i[c]={timescale:u,id:o}}}}}});return i};e.getStartDTS=function t(r,i){var a,n,s;a=e.findBox(i,["moof","traf"]);n=[].concat.apply([],a.map(function(t){return e.findBox(t,["tfhd"]).map(function(i){var a,n,s;a=e.readUint32(i,4);n=r[a].timescale||9e4;s=e.findBox(t,["tfdt"]).map(function(t){var r,i;r=t.data[t.start];i=e.readUint32(t,4);if(r===1){i*=Math.pow(2,32);i+=e.readUint32(t,8)}return i})[0];return s/n})}));s=Math.min.apply(null,n);return isFinite(s)?s:0};e.offsetStartDTS=function t(r,i,a){e.findBox(i,["moof","traf"]).map(function(t){return e.findBox(t,["tfhd"]).map(function(i){var n=e.readUint32(i,4);var s=r[n].timescale||9e4;e.findBox(t,["tfdt"]).map(function(t){var r=t.data[t.start];var i=e.readUint32(t,4);if(r===0){e.writeUint32(t,4,i-a*s)}else{i*=Math.pow(2,32);i+=e.readUint32(t,8);i-=a*s;i=Math.max(i,0);var n=Math.floor(i/(T+1));var o=Math.floor(i%(T+1));e.writeUint32(t,4,n);e.writeUint32(t,8,o)}})})})};e.prototype.append=function t(r,a,n,s){var o=this.initData;if(!o){this.resetInitSegment(r,this.audioCodec,this.videoCodec);o=this.initData}var l=void 0,u=this.initPTS;if(u===undefined){var f=e.getStartDTS(o,r);this.initPTS=u=f-a;this.observer.trigger(i["a"].INIT_PTS_FOUND,{initPTS:u})}e.offsetStartDTS(o,r,u);l=e.getStartDTS(o,r);this.remuxer.remux(o.audio,o.video,null,null,l,n,s,r)};e.prototype.destroy=function e(){};return e}();var w=S;var R={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function e(t,r,i,a,n){if(i+24>r.length){return undefined}var s=this.parseHeader(r,i);if(s&&i+s.frameLength<=r.length){var o=s.samplesPerFrame*9e4/s.sampleRate;var l=a+n*o;var u={unit:r.subarray(i,i+s.frameLength),pts:l,dts:l};t.config=[];t.channelCount=s.channelCount;t.samplerate=s.sampleRate;t.samples.push(u);t.len+=s.frameLength;return{sample:u,length:s.frameLength}}return undefined},parseHeader:function e(t,r){var i=t[r+1]>>3&3;var a=t[r+1]>>1&3;var n=t[r+2]>>4&15;var s=t[r+2]>>2&3;var o=t[r+2]>>1&1;if(i!==1&&n!==0&&n!==15&&s!==3){var l=i===3?3-a:a===3?3:4;var u=R.BitratesMap[l*14+n-1]*1e3;var f=i===3?0:i===2?1:2;var d=R.SamplingRateMap[f*3+s];var c=t[r+3]>>6===3?1:2;var h=R.SamplesCoefficients[i][a];var p=R.BytesInSlot[a];var v=h*8*p;var g=parseInt(h*u/d+o,10)*p;return{sampleRate:d,channelCount:c,frameLength:g,samplesPerFrame:v}}return undefined},isHeaderPattern:function e(t,r){return t[r]===255&&(t[r+1]&224)===224&&(t[r+1]&6)!==0},isHeader:function e(t,r){if(r+1<t.length&&this.isHeaderPattern(t,r)){return true}return false},probe:function e(t,r){if(r+1<t.length&&this.isHeaderPattern(t,r)){var i=4;var a=this.parseHeader(t,r);var n=i;if(a&&a.frameLength){n=a.frameLength}var s=r+n;if(s===t.length||s+1<t.length&&this.isHeaderPattern(t,s)){return true}}return false}};var A=R;function L(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var I=function(){function e(t){L(this,e);this.data=t;this.bytesAvailable=t.byteLength;this.word=0;this.bitsAvailable=0}e.prototype.loadWord=function e(){var t=this.data,r=this.bytesAvailable,i=t.byteLength-r,a=new Uint8Array(4),n=Math.min(4,r);if(n===0){throw new Error("no bytes available")}a.set(t.subarray(i,i+n));this.word=new DataView(a.buffer).getUint32(0);this.bitsAvailable=n*8;this.bytesAvailable-=n};e.prototype.skipBits=function e(t){var r;if(this.bitsAvailable>t){this.word<<=t;this.bitsAvailable-=t}else{t-=this.bitsAvailable;r=t>>3;t-=r>>3;this.bytesAvailable-=r;this.loadWord();this.word<<=t;this.bitsAvailable-=t}};e.prototype.readBits=function e(t){var r=Math.min(this.bitsAvailable,t),i=this.word>>>32-r;if(t>32){s["b"].error("Cannot read more than 32 bits at a time")}this.bitsAvailable-=r;if(this.bitsAvailable>0){this.word<<=r}else if(this.bytesAvailable>0){this.loadWord()}r=t-r;if(r>0&&this.bitsAvailable){return i<<r|this.readBits(r)}else{return i}};e.prototype.skipLZ=function e(){var t;for(t=0;t<this.bitsAvailable;++t){if(0!==(this.word&2147483648>>>t)){this.word<<=t;this.bitsAvailable-=t;return t}}this.loadWord();return t+this.skipLZ()};e.prototype.skipUEG=function e(){this.skipBits(1+this.skipLZ())};e.prototype.skipEG=function e(){this.skipBits(1+this.skipLZ())};e.prototype.readUEG=function e(){var t=this.skipLZ();return this.readBits(t+1)-1};e.prototype.readEG=function e(){var t=this.readUEG();if(1&t){return 1+t>>>1}else{return-1*(t>>>1)}};e.prototype.readBoolean=function e(){return 1===this.readBits(1)};e.prototype.readUByte=function e(){return this.readBits(8)};e.prototype.readUShort=function e(){return this.readBits(16)};e.prototype.readUInt=function e(){return this.readBits(32)};e.prototype.skipScalingList=function e(t){var r=8,i=8,a,n;for(a=0;a<t;a++){if(i!==0){n=this.readEG();i=(r+n+256)%256}r=i===0?r:i}};e.prototype.readSPS=function e(){var t=0,r=0,i=0,a=0,n,s,o,l,u,f,d,c,h,p=this.readUByte.bind(this),v=this.readBits.bind(this),g=this.readUEG.bind(this),m=this.readBoolean.bind(this),y=this.skipBits.bind(this),b=this.skipEG.bind(this),_=this.skipUEG.bind(this),E=this.skipScalingList.bind(this);p();n=p();s=v(5);y(3);o=p();_();if(n===100||n===110||n===122||n===244||n===44||n===83||n===86||n===118||n===128){var T=g();if(T===3){y(1)}_();_();y(1);if(m()){c=T!==3?8:12;for(h=0;h<c;h++){if(m()){if(h<6){E(16)}else{E(64)}}}}}_();var S=g();if(S===0){g()}else if(S===1){y(1);b();b();l=g();for(h=0;h<l;h++){b()}}_();y(1);u=g();f=g();d=v(1);if(d===0){y(1)}y(1);if(m()){t=g();r=g();i=g();a=g()}var w=[1,1];if(m()){if(m()){var R=p();switch(R){case 1:w=[1,1];break;case 2:w=[12,11];break;case 3:w=[10,11];break;case 4:w=[16,11];break;case 5:w=[40,33];break;case 6:w=[24,11];break;case 7:w=[20,11];break;case 8:w=[32,11];break;case 9:w=[80,33];break;case 10:w=[18,11];break;case 11:w=[15,11];break;case 12:w=[64,33];break;case 13:w=[160,99];break;case 14:w=[4,3];break;case 15:w=[3,2];break;case 16:w=[2,1];break;case 255:{w=[p()<<8|p(),p()<<8|p()];break}}}}return{width:Math.ceil((u+1)*16-t*2-r*2),height:(2-d)*(f+1)*16-(d?2:4)*(i+a),pixelRatio:w}};e.prototype.readSliceType=function e(){this.readUByte();this.readUEG();return this.readUEG()};return e}();var D=I;function k(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var O=function(){function e(t,r,i,a){k(this,e);this.decryptdata=i;this.discardEPB=a;this.decrypter=new n["a"](t,r)}e.prototype.decryptBuffer=function e(t,r){this.decrypter.decrypt(t,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,r)};e.prototype.decryptAacSample=function e(t,r,i,a){var n=t[r].unit;var s=n.subarray(16,n.length-n.length%16);var o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);var l=this;this.decryptBuffer(o,function(e){e=new Uint8Array(e);n.set(e,16);if(!a){l.decryptAacSamples(t,r+1,i)}})};e.prototype.decryptAacSamples=function e(t,r,i){for(;;r++){if(r>=t.length){i();return}if(t[r].unit.length<32){continue}var a=this.decrypter.isSync();this.decryptAacSample(t,r,i,a);if(!a){return}}};e.prototype.getAvcEncryptedData=function e(t){var r=Math.floor((t.length-48)/160)*16+16;var i=new Int8Array(r);var a=0;for(var n=32;n<=t.length-16;n+=160,a+=16){i.set(t.subarray(n,n+16),a)}return i};e.prototype.getAvcDecryptedUnit=function e(t,r){r=new Uint8Array(r);var i=0;for(var a=32;a<=t.length-16;a+=160,i+=16){t.set(r.subarray(i,i+16),a)}return t};e.prototype.decryptAvcSample=function e(t,r,i,a,n,s){var o=this.discardEPB(n.data);var l=this.getAvcEncryptedData(o);var u=this;this.decryptBuffer(l.buffer,function(e){n.data=u.getAvcDecryptedUnit(o,e);if(!s){u.decryptAvcSamples(t,r,i+1,a)}})};e.prototype.decryptAvcSamples=function e(t,r,i,a){for(;;r++,i=0){if(r>=t.length){a();return}var n=t[r].units;for(;;i++){if(i>=n.length){break}var s=n[i];if(s.length<=48||s.type!==1&&s.type!==5){continue}var o=this.decrypter.isSync();this.decryptAvcSample(t,r,i,a,s,o);if(!o){return}}}};return e}();var x=O;function C(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var P={video:0,audio:1,id3:2,text:3};var F=function(){function e(t,r,i,a){C(this,e);this.observer=t;this.config=i;this.typeSupported=a;this.remuxer=r;this.sampleAes=null}e.prototype.setDecryptData=function e(t){if(t!=null&&t.key!=null&&t.method==="SAMPLE-AES"){this.sampleAes=new x(this.observer,this.config,t,this.discardEPB)}else{this.sampleAes=null}};e.probe=function t(r){var i=e._syncOffset(r);if(i<0){return false}else{if(i){s["b"].warn("MPEG2-TS detected but first sync word found @ offset "+i+", junk ahead ?")}return true}};e._syncOffset=function e(t){var r=Math.min(1e3,t.length-3*188);var i=0;while(i<r){if(t[i]===71&&t[i+188]===71&&t[i+2*188]===71){return i}else{i++}}return-1};e.createTrack=function e(t,r){return{container:t==="video"||t==="audio"?"video/mp2t":undefined,type:t,id:P[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:t==="video"?0:undefined,isAAC:t==="audio"?true:undefined,duration:t==="audio"?r:undefined}};e.prototype.resetInitSegment=function t(r,i,a,n){this.pmtParsed=false;this._pmtId=-1;this._avcTrack=e.createTrack("video",n);this._audioTrack=e.createTrack("audio",n);this._id3Track=e.createTrack("id3",n);this._txtTrack=e.createTrack("text",n);this.aacOverFlow=null;this.aacLastPTS=null;this.avcSample=null;this.audioCodec=i;this.videoCodec=a;this._duration=n};e.prototype.resetTimeStamp=function e(){};e.prototype.append=function t(r,n,o,l){var u,f=r.length,d,c,h,p,v,g=false;this.contiguous=o;var m=this.pmtParsed,y=this._avcTrack,b=this._audioTrack,_=this._id3Track,E=y.pid,T=b.pid,S=_.pid,w=this._pmtId,R=y.pesData,A=b.pesData,L=_.pesData,I=this._parsePAT,D=this._parsePMT,k=this._parsePES,O=this._parseAVCPES.bind(this),x=this._parseAACPES.bind(this),C=this._parseMPEGPES.bind(this),P=this._parseID3PES.bind(this);var F=e._syncOffset(r);f-=(f+F)%188;for(u=F;u<f;u+=188){if(r[u]===71){d=!!(r[u+1]&64);c=((r[u+1]&31)<<8)+r[u+2];h=(r[u+3]&48)>>4;if(h>1){p=u+5+r[u+4];if(p===u+188){continue}}else{p=u+4}switch(c){case E:if(d){if(R&&(v=k(R))){O(v,false)}R={data:[],size:0}}if(R){R.data.push(r.subarray(p,u+188));R.size+=u+188-p}break;case T:if(d){if(A&&(v=k(A))){if(b.isAAC){x(v)}else{C(v)}}A={data:[],size:0}}if(A){A.data.push(r.subarray(p,u+188));A.size+=u+188-p}break;case S:if(d){if(L&&(v=k(L))){P(v)}L={data:[],size:0}}if(L){L.data.push(r.subarray(p,u+188));L.size+=u+188-p}break;case 0:if(d){p+=r[p]+1}w=this._pmtId=I(r,p);break;case w:if(d){p+=r[p]+1}var N=D(r,p,this.typeSupported.mpeg===true||this.typeSupported.mp3===true,this.sampleAes!=null);E=N.avc;if(E>0){y.pid=E}T=N.audio;if(T>0){b.pid=T;b.isAAC=N.isAAC}S=N.id3;if(S>0){_.pid=S}if(g&&!m){s["b"].log("reparse from beginning");g=false;u=F-188}m=this.pmtParsed=true;break;case 17:case 8191:break;default:g=true;break}}else{this.observer.trigger(i["a"].ERROR,{type:a["b"].MEDIA_ERROR,details:a["a"].FRAG_PARSING_ERROR,fatal:false,reason:"TS packet did not start with 0x47"})}}if(R&&(v=k(R))){O(v,true);y.pesData=null}else{y.pesData=R}if(A&&(v=k(A))){if(b.isAAC){x(v)}else{C(v)}b.pesData=null}else{if(A&&A.size){s["b"].log("last AAC PES packet truncated,might overlap between fragments")}b.pesData=A}if(L&&(v=k(L))){P(v);_.pesData=null}else{_.pesData=L}if(this.sampleAes==null){this.remuxer.remux(b,y,_,this._txtTrack,n,o,l)}else{this.decryptAndRemux(b,y,_,this._txtTrack,n,o,l)}};e.prototype.decryptAndRemux=function e(t,r,i,a,n,s,o){if(t.samples&&t.isAAC){var l=this;this.sampleAes.decryptAacSamples(t.samples,0,function(){l.decryptAndRemuxAvc(t,r,i,a,n,s,o)})}else{this.decryptAndRemuxAvc(t,r,i,a,n,s,o)}};e.prototype.decryptAndRemuxAvc=function e(t,r,i,a,n,s,o){if(r.samples){var l=this;this.sampleAes.decryptAvcSamples(r.samples,0,0,function(){l.remuxer.remux(t,r,i,a,n,s,o)})}else{this.remuxer.remux(t,r,i,a,n,s,o)}};e.prototype.destroy=function e(){this._initPTS=this._initDTS=undefined;this._duration=0};e.prototype._parsePAT=function e(t,r){return(t[r+10]&31)<<8|t[r+11]};e.prototype._parsePMT=function e(t,r,i,a){var n,o,l,u,f={audio:-1,avc:-1,id3:-1,isAAC:true};n=(t[r+1]&15)<<8|t[r+2];o=r+3+n-4;l=(t[r+10]&15)<<8|t[r+11];r+=12+l;while(r<o){u=(t[r+1]&31)<<8|t[r+2];switch(t[r]){case 207:if(!a){s["b"].log("unkown stream type:"+t[r]);break}case 15:if(f.audio===-1){f.audio=u}break;case 21:if(f.id3===-1){f.id3=u}break;case 219:if(!a){s["b"].log("unkown stream type:"+t[r]);break}case 27:if(f.avc===-1){f.avc=u}break;case 3:case 4:if(!i){s["b"].log("MPEG audio found, not supported in this browser for now")}else if(f.audio===-1){f.audio=u;f.isAAC=false}break;case 36:s["b"].warn("HEVC stream type found, not supported for now");break;default:s["b"].log("unkown stream type:"+t[r]);break}r+=((t[r+3]&15)<<8|t[r+4])+5}return f};e.prototype._parsePES=function e(t){var r=0,i,a,n,o,l,u,f,d,c,h=t.data;if(!t||t.size===0){return null}while(h[0].length<19&&h.length>1){var p=new Uint8Array(h[0].length+h[1].length);p.set(h[0]);p.set(h[1],h[0].length);h[0]=p;h.splice(1,1)}i=h[0];n=(i[0]<<16)+(i[1]<<8)+i[2];if(n===1){o=(i[4]<<8)+i[5];if(o&&o>t.size-6){return null}a=i[7];if(a&192){f=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2;if(f>4294967295){f-=8589934592}if(a&64){d=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2;if(d>4294967295){d-=8589934592}if(f-d>60*9e4){s["b"].warn(Math.round((f-d)/9e4)+"s delta between PTS and DTS, align them");f=d}}else{d=f}}l=i[8];c=l+9;t.size-=c;u=new Uint8Array(t.size);for(var v=0,g=h.length;v<g;v++){i=h[v];var m=i.byteLength;if(c){if(c>m){c-=m;continue}else{i=i.subarray(c);m-=c;c=0}}u.set(i,r);r+=m}if(o){o-=l+3}return{data:u,pts:f,dts:d,len:o}}else{return null}};e.prototype.pushAccesUnit=function e(t,r){if(t.units.length&&t.frame){var i=r.samples;var a=i.length;if(!this.config.forceKeyFrameOnDiscontinuity||t.key===true||r.sps&&(a||this.contiguous)){t.id=a;i.push(t)}else{r.dropped++}}if(t.debug.length){s["b"].log(t.pts+"/"+t.dts+":"+t.debug)}};e.prototype._parseAVCPES=function e(t,r){var i=this;var a=this._avcTrack,n=this._parseAVCNALu(t.data),s=false,o,l=this.avcSample,u,f=false,d,c=this.pushAccesUnit.bind(this),h=function e(t,r,i,a){return{key:t,pts:r,dts:i,units:[],debug:a}};t.data=null;if(l&&n.length&&!a.audFound){c(l,a);l=this.avcSample=h(false,t.pts,t.dts,"")}n.forEach(function(e){switch(e.type){case 1:u=true;if(!l){l=i.avcSample=h(true,t.pts,t.dts,"")}if(s){l.debug+="NDR "}l.frame=true;var r=e.data;if(f&&r.length>4){var n=new D(r).readSliceType();if(n===2||n===4||n===7||n===9){l.key=true}}break;case 5:u=true;if(!l){l=i.avcSample=h(true,t.pts,t.dts,"")}if(s){l.debug+="IDR "}l.key=true;l.frame=true;break;case 6:u=true;if(s&&l){l.debug+="SEI "}o=new D(i.discardEPB(e.data));o.readUByte();var p=0;var v=0;var g=false;var m=0;while(!g&&o.bytesAvailable>1){p=0;do{m=o.readUByte();p+=m}while(m===255);v=0;do{m=o.readUByte();v+=m}while(m===255);if(p===4&&o.bytesAvailable!==0){g=true;var y=o.readUByte();if(y===181){var b=o.readUShort();if(b===49){var _=o.readUInt();if(_===1195456820){var E=o.readUByte();if(E===3){var T=o.readUByte();var S=o.readUByte();var w=31&T;var R=[T,S];for(d=0;d<w;d++){R.push(o.readUByte());R.push(o.readUByte());R.push(o.readUByte())}i._insertSampleInOrder(i._txtTrack.samples,{type:3,pts:t.pts,bytes:R})}}}}}else if(v<o.bytesAvailable){for(d=0;d<v;d++){o.readUByte()}}}break;case 7:u=true;f=true;if(s&&l){l.debug+="SPS "}if(!a.sps){o=new D(e.data);var A=o.readSPS();a.width=A.width;a.height=A.height;a.pixelRatio=A.pixelRatio;a.sps=[e.data];a.duration=i._duration;var L=e.data.subarray(1,4);var I="avc1.";for(d=0;d<3;d++){var k=L[d].toString(16);if(k.length<2){k="0"+k}I+=k}a.codec=I}break;case 8:u=true;if(s&&l){l.debug+="PPS "}if(!a.pps){a.pps=[e.data]}break;case 9:u=false;a.audFound=true;if(l){c(l,a)}l=i.avcSample=h(false,t.pts,t.dts,s?"AUD ":"");break;case 12:u=false;break;default:u=false;if(l){l.debug+="unknown NAL "+e.type+" "}break}if(l&&u){var O=l.units;O.push(e)}});if(r&&l){c(l,a);this.avcSample=null}};e.prototype._insertSampleInOrder=function e(t,r){var i=t.length;if(i>0){if(r.pts>=t[i-1].pts){t.push(r)}else{for(var a=i-1;a>=0;a--){if(r.pts<t[a].pts){t.splice(a,0,r);break}}}}else{t.push(r)}};e.prototype._getLastNalUnit=function e(){var t=this.avcSample,r=void 0;if(!t||t.units.length===0){var i=this._avcTrack,a=i.samples;t=a[a.length-1]}if(t){var n=t.units;r=n[n.length-1]}return r};e.prototype._parseAVCNALu=function e(t){var r=0,i=t.byteLength,a,n,s=this._avcTrack,o=s.naluState||0,l=o;var u=[],f,d,c=-1,h;if(o===-1){c=0;h=t[0]&31;o=0;r=1}while(r<i){a=t[r++];if(!o){o=a?0:1;continue}if(o===1){o=a?0:2;continue}if(!a){o=3}else if(a===1){if(c>=0){f={data:t.subarray(c,r-o-1),type:h};u.push(f)}else{var p=this._getLastNalUnit();if(p){if(l&&r<=4-l){if(p.state){p.data=p.data.subarray(0,p.data.byteLength-l)}}n=r-o-1;if(n>0){var v=new Uint8Array(p.data.byteLength+n);v.set(p.data,0);v.set(t.subarray(0,n),p.data.byteLength);p.data=v}}}if(r<i){d=t[r]&31;c=r;h=d;o=0}else{o=-1}}else{o=0}}if(c>=0&&o>=0){f={data:t.subarray(c,i),type:h,state:o};u.push(f)}if(u.length===0){var g=this._getLastNalUnit();if(g){var m=new Uint8Array(g.data.byteLength+t.byteLength);m.set(g.data,0);m.set(t,g.data.byteLength);g.data=m}}s.naluState=o;return u};e.prototype.discardEPB=function e(t){var r=t.byteLength,i=[],a=1,n,s;while(a<r-2){if(t[a]===0&&t[a+1]===0&&t[a+2]===3){i.push(a+2);a+=2}else{a++}}if(i.length===0){return t}n=r-i.length;s=new Uint8Array(n);var o=0;for(a=0;a<n;o++,a++){if(o===i[0]){o++;i.shift()}s[a]=t[o]}return s};e.prototype._parseAACPES=function e(t){var r=this._audioTrack,n=t.data,o=t.pts,l=0,u=this.aacOverFlow,f=this.aacLastPTS,c,v,m,y,b;if(u){var _=new Uint8Array(u.byteLength+n.byteLength);_.set(u,0);_.set(n,u.byteLength);n=_}for(m=l,b=n.length;m<b-1;m++){if(d(n,m)){break}}if(m){var E,T;if(m<b-1){E="AAC PES did not start with ADTS header,offset:"+m;T=false}else{E="no ADTS header found in AAC PES";T=true}s["b"].warn("parsing error:"+E);this.observer.trigger(i["a"].ERROR,{type:a["b"].MEDIA_ERROR,details:a["a"].FRAG_PARSING_ERROR,fatal:T,reason:E});if(T){return}}h(r,this.observer,n,m,this.audioCodec);v=0;c=p(r.samplerate);if(u&&f){var S=f+c;if(Math.abs(S-o)>1){s["b"].log("AAC: align PTS for overlapping frames by "+Math.round((S-o)/90));o=S}}while(m<b){if(d(n,m)&&m+5<b){var w=g(r,n,m,o,v);if(w){m+=w.length;y=w.sample.pts;v++}else{break}}else{m++}}if(m<b){u=n.subarray(m,b)}else{u=null}this.aacOverFlow=u;this.aacLastPTS=y};e.prototype._parseMPEGPES=function e(t){var r=t.data;var i=r.length;var a=0;var n=0;var s=t.pts;while(n<i){if(A.isHeader(r,n)){var o=A.appendFrame(this._audioTrack,r,n,s,a);if(o){n+=o.length;a++}else{break}}else{n++}}};e.prototype._parseID3PES=function e(t){this._id3Track.samples.push(t)};return e}();var N=F;function M(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var U=function(){function e(t,r,i){M(this,e);this.observer=t;this.config=i;this.remuxer=r}e.prototype.resetInitSegment=function e(t,r,i,a){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:false,samples:[],len:0,manifestCodec:r,duration:a,inputTimeScale:9e4}};e.prototype.resetTimeStamp=function e(){};e.probe=function e(t){var r,i;var a=m["a"].getID3Data(t,0);if(a&&m["a"].getTimeStamp(a)!==undefined){for(r=a.length,i=Math.min(t.length-1,r+100);r<i;r++){if(A.probe(t,r)){s["b"].log("MPEG Audio sync word found !");return true}}}return false};e.prototype.append=function e(t,r,i,a){var n=m["a"].getID3Data(t,0);var s=m["a"].getTimeStamp(n);var o=s?90*s:r*9e4;var l=n.length;var u=t.length;var f=0,d=0;var c=this._audioTrack;var h=[{pts:o,dts:o,data:n}];while(l<u){if(A.isHeader(t,l)){var p=A.appendFrame(c,t,l,o,f);if(p){l+=p.length;d=p.sample.pts;f++}else{break}}else if(m["a"].isHeader(t,l)){n=m["a"].getID3Data(t,l);h.push({pts:d,dts:d,data:n});l+=n.length}else{l++}}this.remuxer.remux(c,{samples:[]},{samples:h,inputTimeScale:9e4},{samples:[]},r,i,a)};e.prototype.destroy=function e(){};return e}();var B=U;function G(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var H=function(){function e(){G(this,e)}e.getSilentFrame=function e(t,r){switch(t){case"mp4a.40.2":if(r===1){return new Uint8Array([0,200,0,128,35,128])}else if(r===2){return new Uint8Array([33,0,73,144,2,25,0,35,128])}else if(r===3){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142])}else if(r===4){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56])}else if(r===5){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56])}else if(r===6){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}break;default:if(r===1){return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}else if(r===2){return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}else if(r===3){return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}break}return null};return e}();var j=H;function $(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var K=Math.pow(2,32)-1;var W=function(){function e(){$(this,e)}e.init=function t(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var r;for(r in e.types){if(e.types.hasOwnProperty(r)){e.types[r]=[r.charCodeAt(0),r.charCodeAt(1),r.charCodeAt(2),r.charCodeAt(3)]}}var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);var a=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:i,audio:a};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);var s=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=s;e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]);e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]);e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]);var l=new Uint8Array([97,118,99,49]);var u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,o,u,o,l);e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))};e.box=function e(t){var r=Array.prototype.slice.call(arguments,1),i=8,a=r.length,n=a,s;while(a--){i+=r[a].byteLength}s=new Uint8Array(i);s[0]=i>>24&255;s[1]=i>>16&255;s[2]=i>>8&255;s[3]=i&255;s.set(t,4);for(a=0,i=8;a<n;a++){s.set(r[a],i);i+=r[a].byteLength}return s};e.hdlr=function t(r){return e.box(e.types.hdlr,e.HDLR_TYPES[r])};e.mdat=function t(r){return e.box(e.types.mdat,r)};e.mdhd=function t(r,i){i*=r;var a=Math.floor(i/(K+1));var n=Math.floor(i%(K+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,r&255,a>>24,a>>16&255,a>>8&255,a&255,n>>24,n>>16&255,n>>8&255,n&255,85,196,0,0]))};e.mdia=function t(r){return e.box(e.types.mdia,e.mdhd(r.timescale,r.duration),e.hdlr(r.type),e.minf(r))};e.mfhd=function t(r){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255]))};e.minf=function t(r){if(r.type==="audio"){return e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(r))}else{return e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(r))}};e.moof=function t(r,i,a){return e.box(e.types.moof,e.mfhd(r),e.traf(a,i))};e.moov=function t(r){var i=r.length,a=[];while(i--){a[i]=e.trak(r[i])}return e.box.apply(null,[e.types.moov,e.mvhd(r[0].timescale,r[0].duration)].concat(a).concat(e.mvex(r)))};e.mvex=function t(r){var i=r.length,a=[];while(i--){a[i]=e.trex(r[i])}return e.box.apply(null,[e.types.mvex].concat(a))};e.mvhd=function t(r,i){i*=r;var a=Math.floor(i/(K+1));var n=Math.floor(i%(K+1));var s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,r&255,a>>24,a>>16&255,a>>8&255,a&255,n>>24,n>>16&255,n>>8&255,n&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,s)};e.sdtp=function t(r){var i=r.samples||[],a=new Uint8Array(4+i.length),n,s;for(s=0;s<i.length;s++){n=i[s].flags;a[s+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy}return e.box(e.types.sdtp,a)};e.stbl=function t(r){return e.box(e.types.stbl,e.stsd(r),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))};e.avc1=function t(r){var i=[],a=[],n,s,o;for(n=0;n<r.sps.length;n++){s=r.sps[n];o=s.byteLength;i.push(o>>>8&255);i.push(o&255);i=i.concat(Array.prototype.slice.call(s))}for(n=0;n<r.pps.length;n++){s=r.pps[n];o=s.byteLength;a.push(o>>>8&255);a.push(o&255);a=a.concat(Array.prototype.slice.call(s))}var l=e.box(e.types.avcC,new Uint8Array([1,i[3],i[4],i[5],252|3,224|r.sps.length].concat(i).concat([r.pps.length]).concat(a))),u=r.width,f=r.height,d=r.pixelRatio[0],c=r.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,d&255,c>>24,c>>16&255,c>>8&255,c&255])))};e.esds=function e(t){var r=t.config.length;return new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(t.config).concat([6,1,2]))};e.mp4a=function t(r){var i=r.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r.channelCount,0,16,0,0,0,0,i>>8&255,i&255,0,0]),e.box(e.types.esds,e.esds(r)))};e.mp3=function t(r){var i=r.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r.channelCount,0,16,0,0,0,0,i>>8&255,i&255,0,0]))};e.stsd=function t(r){if(r.type==="audio"){if(!r.isAAC&&r.codec==="mp3"){return e.box(e.types.stsd,e.STSD,e.mp3(r))}return e.box(e.types.stsd,e.STSD,e.mp4a(r))}else{return e.box(e.types.stsd,e.STSD,e.avc1(r))}};e.tkhd=function t(r){var i=r.id,a=r.duration*r.timescale,n=r.width,s=r.height,o=Math.floor(a/(K+1)),l=Math.floor(a%(K+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,i&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,l>>24,l>>16&255,l>>8&255,l&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,n&255,0,0,s>>8&255,s&255,0,0]))};e.traf=function t(r,i){var a=e.sdtp(r),n=r.id,s=Math.floor(i/(K+1)),o=Math.floor(i%(K+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,o>>24,o>>16&255,o>>8&255,o&255])),e.trun(r,a.length+16+20+8+16+8+8),a)};e.trak=function t(r){r.duration=r.duration||4294967295;return e.box(e.types.trak,e.tkhd(r),e.mdia(r))};e.trex=function t(r){var i=r.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))};e.trun=function t(r,i){var a=r.samples||[],n=a.length,s=12+16*n,o=new Uint8Array(s),l,u,f,d,c,h;i+=8+s;o.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255],0);for(l=0;l<n;l++){u=a[l];f=u.duration;d=u.size;c=u.flags;h=u.cts;o.set([f>>>24&255,f>>>16&255,f>>>8&255,f&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,c.degradPrio&240<<8,c.degradPrio&15,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*l)}return e.box(e.types.trun,o)};e.initSegment=function t(r){if(!e.types){e.init()}var i=e.moov(r),a;a=new Uint8Array(e.FTYP.byteLength+i.byteLength);a.set(e.FTYP);a.set(i,e.FTYP.byteLength);return a};return e}();var V=W;function q(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var Y=10*1e3;var z=function(){function e(t,r,i,a){q(this,e);this.observer=t;this.config=r;this.typeSupported=i;var n=navigator.userAgent;this.isSafari=a&&a.indexOf("Apple")>-1&&n&&!n.match("CriOS");this.ISGenerated=false}e.prototype.destroy=function e(){};e.prototype.resetTimeStamp=function e(t){this._initPTS=this._initDTS=t};e.prototype.resetInitSegment=function e(){this.ISGenerated=false};e.prototype.remux=function e(t,r,a,n,o,l,u){if(!this.ISGenerated){this.generateIS(t,r,o)}if(this.ISGenerated){var f=t.samples.length;var d=r.samples.length;var c=o;var h=o;if(f&&d){var p=(t.samples[0].dts-r.samples[0].dts)/r.inputTimeScale;c+=Math.max(0,p);h+=Math.max(0,-p)}if(f){if(!t.timescale){s["b"].warn("regenerate InitSegment as audio detected");this.generateIS(t,r,o)}var v=this.remuxAudio(t,c,l,u);if(d){var g=void 0;if(v){g=v.endPTS-v.startPTS}if(!r.timescale){s["b"].warn("regenerate InitSegment as video detected");this.generateIS(t,r,o)}this.remuxVideo(r,h,l,g,u)}}else{var m=void 0;if(d){m=this.remuxVideo(r,h,l,u)}if(m&&t.codec){this.remuxEmptyAudio(t,c,l,m)}}}if(a.samples.length){this.remuxID3(a,o)}if(n.samples.length){this.remuxText(n,o)}this.observer.trigger(i["a"].FRAG_PARSED)};e.prototype.generateIS=function e(t,r,n){var o=this.observer,l=t.samples,u=r.samples,f=this.typeSupported,d="audio/mp4",c={},h={tracks:c},p=this._initPTS===undefined,v,g;if(p){v=g=Infinity}if(t.config&&l.length){t.timescale=t.samplerate;s["b"].log("audio sampling rate : "+t.samplerate);if(!t.isAAC){if(f.mpeg){d="audio/mpeg";t.codec=""}else if(f.mp3){t.codec="mp3"}}c.audio={container:d,codec:t.codec,initSegment:!t.isAAC&&f.mpeg?new Uint8Array:V.initSegment([t]),metadata:{channelCount:t.channelCount}};if(p){v=g=l[0].pts-t.inputTimeScale*n}}if(r.sps&&r.pps&&u.length){var m=r.inputTimeScale;r.timescale=m;c.video={container:"video/mp4",codec:r.codec,initSegment:V.initSegment([r]),metadata:{width:r.width,height:r.height}};if(p){v=Math.min(v,u[0].pts-m*n);g=Math.min(g,u[0].dts-m*n);this.observer.trigger(i["a"].INIT_PTS_FOUND,{initPTS:v})}}if(Object.keys(c).length){o.trigger(i["a"].FRAG_PARSING_INIT_SEGMENT,h);this.ISGenerated=true;if(p){this._initPTS=v;this._initDTS=g}}else{o.trigger(i["a"].ERROR,{type:a["b"].MEDIA_ERROR,details:a["a"].FRAG_PARSING_ERROR,fatal:false,reason:"no audio/video samples found"})}};e.prototype.remuxVideo=function e(t,r,n,o,l){var u=8,f=t.timescale,d,c,h,p,v,g,m,y,b=t.samples,_=[],E=b.length,T=this._PTSNormalize,S=this._initDTS;var w=this.nextAvcDts;var R=this.isSafari;if(R){n|=b.length&&w&&(l&&Math.abs(r-w/f)<.1||Math.abs(b[0].pts-w-S)<f/5)}if(!n){w=r*f}b.forEach(function(e){e.pts=T(e.pts-S,w);e.dts=T(e.dts-S,w)});b.sort(function(e,t){var r=e.dts-t.dts;var i=e.pts-t.pts;return r?r:i?i:e.id-t.id});var A=b.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(A<0){s["b"].warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(A/90)+" ms to overcome this issue");for(var L=0;L<b.length;L++){b[L].dts+=A}}var I=b[0];v=Math.max(I.dts,0);p=Math.max(I.pts,0);var D=Math.round((v-w)/90);if(n){if(D){if(D>1){s["b"].log("AVC:"+D+" ms hole between fragments detected,filling it")}else if(D<-1){s["b"].log("AVC:"+-D+" ms overlapping between fragments detected")}v=w;b[0].dts=v;p=Math.max(p-D,w);b[0].pts=p;s["b"].log("Video/PTS/DTS adjusted: "+Math.round(p/90)+"/"+Math.round(v/90)+",delta:"+D+" ms")}}g=v;I=b[b.length-1];y=Math.max(I.dts,0);m=Math.max(I.pts,0,y);if(R){d=Math.round((y-v)/(b.length-1))}var k=0,O=0;for(var x=0;x<E;x++){var C=b[x],P=C.units,F=P.length,N=0;for(var M=0;M<F;M++){N+=P[M].data.length}O+=N;k+=F;C.length=N;if(R){C.dts=v+x*d}else{C.dts=Math.max(C.dts,v)}C.pts=Math.max(C.pts,C.dts)}var U=O+4*k+8;try{c=new Uint8Array(U)}catch(e){this.observer.trigger(i["a"].ERROR,{type:a["b"].MUX_ERROR,details:a["a"].REMUX_ALLOC_ERROR,fatal:false,bytes:U,reason:"fail allocating video mdat "+U});return}var B=new DataView(c.buffer);B.setUint32(0,U);c.set(V.types.mdat,4);for(var G=0;G<E;G++){var H=b[G],j=H.units,$=0,K=void 0;for(var W=0,q=j.length;W<q;W++){var Y=j[W],z=Y.data,X=Y.data.byteLength;B.setUint32(u,X);u+=4;c.set(z,u);u+=X;$+=4+X}if(!R){if(G<E-1){d=b[G+1].dts-H.dts}else{var Q=this.config,J=H.dts-b[G>0?G-1:G].dts;if(Q.stretchShortVideoTrack){var Z=Q.maxBufferHole,ee=Q.maxSeekHole,te=Math.floor(Math.min(Z,ee)*f),re=(o?p+o*f:this.nextAudioPts)-H.pts;if(re>te){d=re-J;if(d<0){d=J}s["b"].log("It is approximately "+re/90+" ms to the next segment; using duration "+d/90+" ms for the last video frame.")}else{d=J}}else{d=J}}K=Math.round(H.pts-H.dts)}else{K=Math.max(0,d*Math.round((H.pts-H.dts)/d))}_.push({size:$,duration:d,cts:K,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:H.key?2:1,isNonSync:H.key?0:1}})}this.nextAvcDts=y+d;var ie=t.dropped;t.len=0;t.nbNalu=0;t.dropped=0;if(_.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var ae=_[0].flags;ae.dependsOn=2;ae.isNonSync=0}t.samples=_;h=V.moof(t.sequenceNumber++,v,t);t.samples=[];var ne={data1:h,data2:c,startPTS:p/f,endPTS:(m+d)/f,startDTS:v/f,endDTS:this.nextAvcDts/f,type:"video",nb:_.length,dropped:ie};this.observer.trigger(i["a"].FRAG_PARSING_DATA,ne);return ne};e.prototype.remuxAudio=function e(t,r,n,o){var l=t.inputTimeScale,u=t.timescale,f=l/u,d=t.isAAC?1024:1152,c=d*f,h=this._PTSNormalize,p=this._initDTS,v=!t.isAAC&&this.typeSupported.mpeg;var g,m,y,b,_,E,T,S=t.samples,w=[],R=this.nextAudioPts;n|=S.length&&R&&(o&&Math.abs(r-R/l)<.1||Math.abs(S[0].pts-R-p)<20*c);S.forEach(function(e){e.pts=e.dts=h(e.pts-p,r*l)});S=S.filter(function(e){return e.pts>=0});if(S.length===0){return}if(!n){if(!o){R=S[0].pts}else{R=r*l}}if(t.isAAC){var A=this.config.maxAudioFramesDrift;for(var L=0,I=R;L<S.length;){var D=S[L],k;var O=D.pts;k=O-I;var x=Math.abs(1e3*k/l);if(k<=-A*c){s["b"].warn("Dropping 1 audio frame @ "+(I/l).toFixed(3)+"s due to "+Math.round(x)+" ms overlap.");S.splice(L,1);t.len-=D.unit.length}else if(k>=A*c&&x<Y&&I){var C=Math.round(k/c);s["b"].warn("Injecting "+C+" audio frame @ "+(I/l).toFixed(3)+"s due to "+Math.round(1e3*k/l)+" ms gap.");for(var P=0;P<C;P++){var F=Math.max(I,0);y=j.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(!y){s["b"].log("Unable to get silent frame for given audio codec; duplicating last frame instead.");y=D.unit.subarray()}S.splice(L,0,{unit:y,pts:F,dts:F});t.len+=y.length;I+=c;L++}D.pts=D.dts=I;I+=c;L++}else{if(Math.abs(k)>.1*c){}D.pts=D.dts=I;I+=c;L++}}}for(var N=0,M=S.length;N<M;N++){var U=S[N];var B=U.unit;var G=U.pts;if(T!==undefined){m.duration=Math.round((G-T)/f)}else{var H=Math.round(1e3*(G-R)/l),$=0;if(n&&t.isAAC){if(H){if(H>0&&H<Y){$=Math.round((G-R)/c);s["b"].log(H+" ms hole between AAC samples detected,filling it");if($>0){y=j.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(!y){y=B.subarray()}t.len+=$*y.length}}else if(H<-12){s["b"].log("drop overlapping AAC sample, expected/parsed/delta:"+(R/l).toFixed(3)+"s/"+(G/l).toFixed(3)+"s/"+-H+"ms");t.len-=B.byteLength;continue}G=R}}E=G;if(t.len>0){var K=v?t.len:t.len+8;g=v?0:8;try{b=new Uint8Array(K)}catch(e){this.observer.trigger(i["a"].ERROR,{type:a["b"].MUX_ERROR,details:a["a"].REMUX_ALLOC_ERROR,fatal:false,bytes:K,reason:"fail allocating audio mdat "+K});return}if(!v){var W=new DataView(b.buffer);W.setUint32(0,K);b.set(V.types.mdat,4)}}else{return}for(var q=0;q<$;q++){y=j.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(!y){s["b"].log("Unable to get silent frame for given audio codec; duplicating this frame instead.");y=B.subarray()}b.set(y,g);g+=y.byteLength;m={size:y.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}};w.push(m)}}b.set(B,g);var z=B.byteLength;g+=z;m={size:z,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}};w.push(m);T=G}var X=0;var Q=w.length;if(Q>=2){X=w[Q-2].duration;m.duration=X}if(Q){this.nextAudioPts=R=T+f*X;t.len=0;t.samples=w;if(v){_=new Uint8Array}else{_=V.moof(t.sequenceNumber++,E/f,t)}t.samples=[];var J=E/l;var Z=R/l;var ee={data1:_,data2:b,startPTS:J,endPTS:Z,startDTS:J,endDTS:Z,type:"audio",nb:Q};this.observer.trigger(i["a"].FRAG_PARSING_DATA,ee);return ee}return null};e.prototype.remuxEmptyAudio=function e(t,r,i,a){var n=t.inputTimeScale,o=t.samplerate?t.samplerate:n,l=n/o,u=this.nextAudioPts,f=(u!==undefined?u:a.startDTS*n)+this._initDTS,d=a.endDTS*n+this._initDTS,c=1024,h=l*c,p=Math.ceil((d-f)/h),v=j.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);s["b"].warn("remux empty Audio");if(!v){s["b"].trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");return}var g=[];for(var m=0;m<p;m++){var y=f+m*h;g.push({unit:v,pts:y,dts:y});t.len+=v.length}t.samples=g;this.remuxAudio(t,r,i)};e.prototype.remuxID3=function e(t,r){var a=t.samples.length,n;var s=t.inputTimeScale;var o=this._initPTS;var l=this._initDTS;if(a){for(var u=0;u<a;u++){n=t.samples[u];n.pts=(n.pts-o)/s;n.dts=(n.dts-l)/s}this.observer.trigger(i["a"].FRAG_PARSING_METADATA,{samples:t.samples})}t.samples=[];r=r};e.prototype.remuxText=function e(t,r){t.samples.sort(function(e,t){return e.pts-t.pts});var a=t.samples.length,n;var s=t.inputTimeScale;var o=this._initPTS;if(a){for(var l=0;l<a;l++){n=t.samples[l];n.pts=(n.pts-o)/s}this.observer.trigger(i["a"].FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[];r=r};e.prototype._PTSNormalize=function e(t,r){var i;if(r===undefined){return t}if(r<t){i=-8589934592}else{i=8589934592}while(Math.abs(t-r)>4294967296){t+=i}return t};return e}();var X=z;function Q(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var J=function(){function e(t){Q(this,e);this.observer=t}e.prototype.destroy=function e(){};e.prototype.resetTimeStamp=function e(){};e.prototype.resetInitSegment=function e(){};e.prototype.remux=function e(t,r,a,n,s,o,l,u){var f=this.observer;var d="";if(t){d+="audio"}if(r){d+="video"}f.trigger(i["a"].FRAG_PARSING_DATA,{data1:u,startPTS:s,startDTS:s,type:d,nb:1,dropped:0});f.trigger(i["a"].FRAG_PARSED)};return e}();var Z=J;function ee(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var te=function(){function e(t,r,i,a){ee(this,e);this.observer=t;this.typeSupported=r;this.config=i;this.vendor=a}e.prototype.destroy=function e(){var t=this.demuxer;if(t){t.destroy()}};e.prototype.push=function e(t,r,a,s,o,l,u,f,d,c,h,p){if(t.byteLength>0&&r!=null&&r.key!=null&&r.method==="AES-128"){var v=this.decrypter;if(v==null){v=this.decrypter=new n["a"](this.observer,this.config)}var g=this;var m;try{m=performance.now()}catch(e){m=Date.now()}v.decrypt(t,r.key.buffer,r.iv.buffer,function(e){var t;try{t=performance.now()}catch(e){t=Date.now()}g.observer.trigger(i["a"].FRAG_DECRYPTED,{stats:{tstart:m,tdecrypt:t}});g.pushDecrypted(new Uint8Array(e),r,new Uint8Array(a),s,o,l,u,f,d,c,h,p)})}else{this.pushDecrypted(new Uint8Array(t),r,new Uint8Array(a),s,o,l,u,f,d,c,h,p)}};e.prototype.pushDecrypted=function e(t,r,n,s,o,l,u,f,d,c,h,p){var v=this.demuxer;if(!v||u&&!this.probe(t)){var g=this.observer;var m=this.typeSupported;var y=this.config;var b=[{demux:N,remux:X},{demux:w,remux:Z},{demux:_,remux:X},{demux:B,remux:X}];for(var E=0,T=b.length;E<T;E++){var S=b[E];var R=S.demux.probe;if(R(t)){var A=this.remuxer=new S.remux(g,y,m,this.vendor);v=new S.demux(g,A,y,m);this.probe=R;break}}if(!v){g.trigger(i["a"].ERROR,{type:a["b"].MEDIA_ERROR,details:a["a"].FRAG_PARSING_ERROR,fatal:true,reason:"no demux matching with content found"});return}this.demuxer=v}var L=this.remuxer;if(u||f){v.resetInitSegment(n,s,o,c);L.resetInitSegment()}if(u){v.resetTimeStamp(p);L.resetTimeStamp(p)}if(typeof v.setDecryptData==="function"){v.setDecryptData(r)}v.append(t,l,d,h)};return e}();var re=t["a"]=te},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i={};r.d(i,"newCue",function(){return Mt});var a=r(6);var n=r.n(a);var s=r(1);var o=r(2);var l=r(0);var u=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var d=function(){function e(t){f(this,e);this.hls=t;this.onEvent=this.onEvent.bind(this);for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++){i[a-1]=arguments[a]}this.handledEvents=i;this.useGenericHandler=true;this.registerListeners()}e.prototype.destroy=function e(){this.unregisterListeners()};e.prototype.isEventHandler=function e(){return u(this.handledEvents)==="object"&&this.handledEvents.length&&typeof this.onEvent==="function"};e.prototype.registerListeners=function e(){if(this.isEventHandler()){this.handledEvents.forEach(function(e){if(e==="hlsEventGeneric"){throw new Error("Forbidden event name: "+e)}this.hls.on(e,this.onEvent)},this)}};e.prototype.unregisterListeners=function e(){if(this.isEventHandler()){this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)},this)}};e.prototype.onEvent=function e(t,r){this.onEventGeneric(t,r)};e.prototype.onEventGeneric=function e(t,r){var i=function e(t,r){var i="on"+t.replace("hls","");if(typeof this[i]!=="function"){throw new Error("Event "+t+" has no generic handler in this "+this.constructor.name+" class (tried "+i+")")}return this[i].bind(this,r)};try{i.call(this,t,r).call()}catch(e){l["b"].error("internal error happened while processing "+t+":"+e.message);this.hls.trigger(s["a"].ERROR,{type:o["b"].OTHER_ERROR,details:o["a"].INTERNAL_EXCEPTION,fatal:false,event:t,err:e})}};return e}();var c=d;function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var p=/^(\d+)x(\d+)$/;var v=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g;var g=function(){function e(t){h(this,e);if(typeof t==="string"){t=e.parseAttrList(t)}for(var r in t){if(t.hasOwnProperty(r)){this[r]=t[r]}}}e.prototype.decimalInteger=function e(t){var r=parseInt(this[t],10);if(r>Number.MAX_SAFE_INTEGER){return Infinity}return r};e.prototype.hexadecimalInteger=function e(t){if(this[t]){var r=(this[t]||"0x").slice(2);r=(r.length&1?"0":"")+r;var i=new Uint8Array(r.length/2);for(var a=0;a<r.length/2;a++){i[a]=parseInt(r.slice(a*2,a*2+2),16)}return i}else{return null}};e.prototype.hexadecimalIntegerAsNumber=function e(t){var r=parseInt(this[t],16);if(r>Number.MAX_SAFE_INTEGER){return Infinity}return r};e.prototype.decimalFloatingPoint=function e(t){return parseFloat(this[t])};e.prototype.enumeratedString=function e(t){return this[t]};e.prototype.decimalResolution=function e(t){var r=p.exec(this[t]);if(r===null){return undefined}return{width:parseInt(r[1],10),height:parseInt(r[2],10)}};e.parseAttrList=function e(t){var r,i={};v.lastIndex=0;while((r=v.exec(t))!==null){var a=r[2],n='"';if(a.indexOf(n)===0&&a.lastIndexOf(n)===a.length-1){a=a.slice(1,-1)}i[r[1]]=a}return i};return e}();var m=g;var y={audio:{a3ds:true,"ac-3":true,"ac-4":true,alac:true,alaw:true,dra1:true,"dts+":true,"dts-":true,dtsc:true,dtse:true,dtsh:true,"ec-3":true,enca:true,g719:true,g726:true,m4ae:true,mha1:true,mha2:true,mhm1:true,mhm2:true,mlpa:true,mp4a:true,"raw ":true,Opus:true,samr:true,sawb:true,sawp:true,sevc:true,sqcp:true,ssmv:true,twos:true,ulaw:true},video:{avc1:true,avc2:true,avc3:true,avc4:true,avcp:true,drac:true,dvav:true,dvhe:true,encv:true,hev1:true,hvc1:true,mjp2:true,mp4v:true,mvc1:true,mvc2:true,mvc3:true,mvc4:true,resv:true,rv60:true,s263:true,svc1:true,svc2:true,"vc-1":true,vp08:true,vp09:true}};function b(e,t){var r=y[t];return!!r&&r[e.slice(0,4)]===true}function _(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}var E=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function T(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function S(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}function w(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var R=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g;var A=/#EXT-X-MEDIA:(.*)/g;var L=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g");var I=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/;var D=function(){function e(){w(this,e);this.method=null;this.key=null;this.iv=null;this._uri=null}E(e,[{key:"uri",get:function e(){if(!this._uri&&this.reluri){this._uri=n.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:true})}return this._uri}}]);return e}();var k=function(){function e(){w(this,e);this._url=null;this._byteRange=null;this._decryptdata=null;this.tagList=[]}e.prototype.createInitializationVector=function e(t){var r=new Uint8Array(16);for(var i=12;i<16;i++){r[i]=t>>8*(15-i)&255}return r};e.prototype.fragmentDecryptdataFromLevelkey=function e(t,r){var i=t;if(t&&t.method&&t.uri&&!t.iv){i=new D;i.method=t.method;i.baseuri=t.baseuri;i.reluri=t.reluri;i.iv=this.createInitializationVector(r)}return i};e.prototype.cloneObj=function e(t){return JSON.parse(JSON.stringify(t))};E(e,[{key:"url",get:function e(){if(!this._url&&this.relurl){this._url=n.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:true})}return this._url},set:function e(t){this._url=t}},{key:"programDateTime",get:function e(){if(!this._programDateTime&&this.rawProgramDateTime){this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))}return this._programDateTime}},{key:"byteRange",get:function e(){if(!this._byteRange){var t=this._byteRange=[];if(this.rawByteRange){var r=this.rawByteRange.split("@",2);if(r.length===1){var i=this.lastByteRangeEndOffset;t[0]=i?i:0}else{t[0]=parseInt(r[1])}t[1]=parseInt(r[0])+t[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function e(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function e(){return this.byteRange[1]}},{key:"decryptdata",get:function e(){if(!this._decryptdata){this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)}return this._decryptdata}}]);return e}();function O(e,t){if(!e){return null}var r=null;for(var i=0;i<e.length;i++){var a=e[i];if(a.id===t){r=a}}return r}var x=function(e){S(t,e);function t(r){w(this,t);var i=T(this,e.call(this,r,s["a"].MANIFEST_LOADING,s["a"].LEVEL_LOADING,s["a"].AUDIO_TRACK_LOADING,s["a"].SUBTITLE_TRACK_LOADING));i.loaders={};return i}t.prototype.destroy=function e(){for(var t in this.loaders){var r=this.loaders[t];if(r){r.destroy()}}this.loaders={};c.prototype.destroy.call(this)};t.prototype.onManifestLoading=function e(t){this.load(t.url,{type:"manifest"})};t.prototype.onLevelLoading=function e(t){this.load(t.url,{type:"level",level:t.level,id:t.id})};t.prototype.onAudioTrackLoading=function e(t){this.load(t.url,{type:"audioTrack",id:t.id})};t.prototype.onSubtitleTrackLoading=function e(t){this.load(t.url,{type:"subtitleTrack",id:t.id})};t.prototype.load=function e(t,r){var i=this.loaders[r.type];if(i!==undefined){var a=i.context;if(a&&a.url===t){l["b"].trace("playlist request ongoing");return}else{l["b"].warn("abort previous loader for type:"+r.type);i.abort()}}var n=this.hls.config,s=void 0,o=void 0,u=void 0,f=void 0;if(r.type==="manifest"){s=n.manifestLoadingMaxRetry;o=n.manifestLoadingTimeOut;u=n.manifestLoadingRetryDelay;f=n.manifestLoadingMaxRetryTimeout}else if(r.type==="level"){s=0;o=n.levelLoadingTimeOut}else{s=n.levelLoadingMaxRetry;o=n.levelLoadingTimeOut;u=n.levelLoadingRetryDelay;f=n.levelLoadingMaxRetryTimeout;l["b"].log("loading playlist for "+r.type+" "+(r.level||r.id))}i=this.loaders[r.type]=r.loader=typeof n.pLoader!=="undefined"?new n.pLoader(n):new n.loader(n);r.url=t;r.responseType="";var d=void 0,c=void 0;d={timeout:o,maxRetry:s,retryDelay:u,maxRetryDelay:f};c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};i.load(r,d,c)};t.prototype.resolve=function e(t,r){return n.a.buildAbsoluteURL(r,t,{alwaysNormalize:true})};t.prototype.parseMasterPlaylist=function e(t,r){var i=[],a=void 0;R.lastIndex=0;function n(e,t){["video","audio"].forEach(function(r){var i=e.filter(function(e){return b(e,r)});if(i.length){var a=i.filter(function(e){return e.lastIndexOf("avc1",0)===0||e.lastIndexOf("mp4a",0)===0});t[r+"Codec"]=a.length>0?a[0]:i[0];e=e.filter(function(e){return i.indexOf(e)===-1})}});t.unknownCodecs=e}while((a=R.exec(t))!=null){var s={};var o=s.attrs=new m(a[1]);s.url=this.resolve(a[2],r);var l=o.decimalResolution("RESOLUTION");if(l){s.width=l.width;s.height=l.height}s.bitrate=o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH");s.name=o.NAME;n([].concat((o.CODECS||"").split(/[ ,]+/)),s);if(s.videoCodec&&s.videoCodec.indexOf("avc1")!==-1){s.videoCodec=this.avc1toavcoti(s.videoCodec)}i.push(s)}return i};t.prototype.parseMasterPlaylistMedia=function e(t,r,i){var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var n=void 0;var s=[];var o=0;A.lastIndex=0;while((n=A.exec(t))!==null){var l={};var u=new m(n[1]);if(u.TYPE===i){l.groupId=u["GROUP-ID"];l.name=u.NAME;l.type=i;l.default=u.DEFAULT==="YES";l.autoselect=u.AUTOSELECT==="YES";l.forced=u.FORCED==="YES";if(u.URI){l.url=this.resolve(u.URI,r)}l.lang=u.LANGUAGE;if(!l.name){l.name=l.lang}if(a.length){var f=O(a,l.groupId);l.audioCodec=f?f.codec:a[0].codec}l.id=o++;s.push(l)}}return s};t.prototype.avc1toavcoti=function e(t){var r,i=t.split(".");if(i.length>2){r=i.shift()+".";r+=parseInt(i.shift()).toString(16);r+=("000"+parseInt(i.shift()).toString(16)).substr(-4)}else{r=t}return r};t.prototype.parseLevelPlaylist=function e(t,r,i,a){var n=0,s=0,o={type:null,version:null,url:r,fragments:[],live:true,startSN:0},u=new D,f=0,d=null,c=new k,h,p;L.lastIndex=0;while((h=L.exec(t))!==null){var v=h[1];if(v){c.duration=parseFloat(v);var g=(" "+h[2]).slice(1);c.title=g?g:null;c.tagList.push(g?["INF",v,g]:["INF",v])}else if(h[3]){if(!isNaN(c.duration)){var y=n++;c.type=a;c.start=s;c.levelkey=u;c.sn=y;c.level=i;c.cc=f;c.baseurl=r;c.relurl=(" "+h[3]).slice(1);o.fragments.push(c);d=c;s+=c.duration;c=new k}}else if(h[4]){c.rawByteRange=(" "+h[4]).slice(1);if(d){var b=d.byteRangeEndOffset;if(b){c.lastByteRangeEndOffset=b}}}else if(h[5]){c.rawProgramDateTime=(" "+h[5]).slice(1);c.tagList.push(["PROGRAM-DATE-TIME",c.rawProgramDateTime]);if(o.programDateTime===undefined){o.programDateTime=new Date(new Date(Date.parse(h[5]))-1e3*s)}}else{h=h[0].match(I);for(p=1;p<h.length;p++){if(h[p]!==undefined){break}}var _=(" "+h[p+1]).slice(1);var E=(" "+h[p+2]).slice(1);switch(h[p]){case"#":c.tagList.push(E?[_,E]:[_]);break;case"PLAYLIST-TYPE":o.type=_.toUpperCase();break;case"MEDIA-SEQUENCE":n=o.startSN=parseInt(_);break;case"TARGETDURATION":o.targetduration=parseFloat(_);break;case"VERSION":o.version=parseInt(_);break;case"EXTM3U":break;case"ENDLIST":o.live=false;break;case"DIS":f++;c.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":f=parseInt(_);break;case"KEY":var T=_;var S=new m(T);var w=S.enumeratedString("METHOD"),R=S.URI,A=S.hexadecimalInteger("IV");if(w){u=new D;if(R&&["AES-128","SAMPLE-AES"].indexOf(w)>=0){u.method=w;u.baseuri=r;u.reluri=R;u.key=null;u.iv=A}}break;case"START":var O=_;var x=new m(O);var C=x.decimalFloatingPoint("TIME-OFFSET");if(!isNaN(C)){o.startTimeOffset=C}break;case"MAP":var P=new m(_);c.relurl=P.URI;c.rawByteRange=P.BYTERANGE;c.baseurl=r;c.level=i;c.type=a;c.sn="initSegment";o.initSegment=c;c=new k;break;default:l["b"].warn("line parsed but not handled: "+h);break}}}c=d;if(c&&!c.relurl){o.fragments.pop();s-=c.duration}o.totalduration=s;o.averagetargetduration=s/o.fragments.length;o.endSN=n-1;o.startCC=o.fragments[0]?o.fragments[0].cc:0;o.endCC=f;return o};t.prototype.loadsuccess=function e(t,r,i){var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var n=t.data,u=t.url,f=i.type,d=i.id,c=i.level,h=this.hls;this.loaders[f]=undefined;if(u===undefined||u.indexOf("data:")===0){u=i.url}r.tload=performance.now();if(n.indexOf("#EXTM3U")===0){if(n.indexOf("#EXTINF:")>0){var p=f!=="audioTrack"&&f!=="subtitleTrack",v=!isNaN(c)?c:!isNaN(d)?d:0,g=this.parseLevelPlaylist(n,u,v,f==="audioTrack"?"audio":f==="subtitleTrack"?"subtitle":"main");g.tload=r.tload;if(f==="manifest"){h.trigger(s["a"].MANIFEST_LOADED,{levels:[{url:u,details:g}],audioTracks:[],url:u,stats:r,networkDetails:a})}r.tparsed=performance.now();if(g.targetduration){if(p){h.trigger(s["a"].LEVEL_LOADED,{details:g,level:c||0,id:d||0,stats:r,networkDetails:a})}else{if(f==="audioTrack"){h.trigger(s["a"].AUDIO_TRACK_LOADED,{details:g,id:d,stats:r,networkDetails:a})}else if(f==="subtitleTrack"){h.trigger(s["a"].SUBTITLE_TRACK_LOADED,{details:g,id:d,stats:r,networkDetails:a})}}}else{h.trigger(s["a"].ERROR,{type:o["b"].NETWORK_ERROR,details:o["a"].MANIFEST_PARSING_ERROR,fatal:true,url:u,reason:"invalid targetduration",networkDetails:a})}}else{var m=this.parseMasterPlaylist(n,u);if(m.length){var y=m.map(function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}});var b=this.parseMasterPlaylistMedia(n,u,"AUDIO",y);var _=this.parseMasterPlaylistMedia(n,u,"SUBTITLES");if(b.length){var E=false;b.forEach(function(e){if(!e.url){E=true}});if(E===false&&m[0].audioCodec&&!m[0].attrs.AUDIO){l["b"].log("audio codec signaled in quality level, but no embedded audio track signaled, create one");b.unshift({type:"main",name:"main"})}}h.trigger(s["a"].MANIFEST_LOADED,{levels:m,audioTracks:b,subtitles:_,url:u,stats:r,networkDetails:a})}else{h.trigger(s["a"].ERROR,{type:o["b"].NETWORK_ERROR,details:o["a"].MANIFEST_PARSING_ERROR,fatal:true,url:u,reason:"no level found in manifest",networkDetails:a})}}}else{h.trigger(s["a"].ERROR,{type:o["b"].NETWORK_ERROR,details:o["a"].MANIFEST_PARSING_ERROR,fatal:true,url:u,reason:"no EXTM3U delimiter",networkDetails:a})}};t.prototype.loaderror=function e(t,r){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var a,n,l=r.loader;switch(r.type){case"manifest":a=o["a"].MANIFEST_LOAD_ERROR;n=true;break;case"level":a=o["a"].LEVEL_LOAD_ERROR;n=false;break;case"audioTrack":a=o["a"].AUDIO_TRACK_LOAD_ERROR;n=false;break}if(l){l.abort();this.loaders[r.type]=undefined}this.hls.trigger(s["a"].ERROR,{type:o["b"].NETWORK_ERROR,details:a,fatal:n,url:l.url,loader:l,response:t,context:r,networkDetails:i})};t.prototype.loadtimeout=function e(t,r){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var a,n,l=r.loader;switch(r.type){case"manifest":a=o["a"].MANIFEST_LOAD_TIMEOUT;n=true;break;case"level":a=o["a"].LEVEL_LOAD_TIMEOUT;n=false;break;case"audioTrack":a=o["a"].AUDIO_TRACK_LOAD_TIMEOUT;n=false;break}if(l){l.abort();this.loaders[r.type]=undefined}this.hls.trigger(s["a"].ERROR,{type:o["b"].NETWORK_ERROR,details:a,fatal:n,url:l.url,loader:l,context:r,networkDetails:i})};return t}(c);var C=x;function P(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function F(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function N(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var M=function(e){N(t,e);function t(r){P(this,t);var i=F(this,e.call(this,r,s["a"].FRAG_LOADING));i.loaders={};return i}t.prototype.destroy=function e(){var t=this.loaders;for(var r in t){var i=t[r];if(i){i.destroy()}}this.loaders={};c.prototype.destroy.call(this)};t.prototype.onFragLoading=function e(t){var r=t.frag,i=r.type,a=this.loaders[i],n=this.hls.config;r.loaded=0;if(a){l["b"].warn("abort previous fragment loader for type:"+i);a.abort()}a=this.loaders[i]=r.loader=typeof n.fLoader!=="undefined"?new n.fLoader(n):new n.loader(n);var s=void 0,o=void 0,u=void 0;s={url:r.url,frag:r,responseType:"arraybuffer",progressData:false};var f=r.byteRangeStartOffset,d=r.byteRangeEndOffset;if(!isNaN(f)&&!isNaN(d)){s.rangeStart=f;s.rangeEnd=d}o={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:n.fragLoadingMaxRetryTimeout};u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)};a.load(s,o,u)};t.prototype.loadsuccess=function e(t,r,i){var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var n=t.data,o=i.frag;o.loader=undefined;this.loaders[o.type]=undefined;this.hls.trigger(s["a"].FRAG_LOADED,{payload:n,frag:o,stats:r,networkDetails:a})};t.prototype.loaderror=function e(t,r){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var a=r.loader;if(a){a.abort()}this.loaders[r.type]=undefined;this.hls.trigger(s["a"].ERROR,{type:o["b"].NETWORK_ERROR,details:o["a"].FRAG_LOAD_ERROR,fatal:false,frag:r.frag,response:t,networkDetails:i})};t.prototype.loadtimeout=function e(t,r){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var a=r.loader;if(a){a.abort()}this.loaders[r.type]=undefined;this.hls.trigger(s["a"].ERROR,{type:o["b"].NETWORK_ERROR,details:o["a"].FRAG_LOAD_TIMEOUT,fatal:false,frag:r.frag,networkDetails:i})};t.prototype.loadprogress=function e(t,r,i){var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var n=r.frag;n.loaded=t.loaded;this.hls.trigger(s["a"].FRAG_LOAD_PROGRESS,{frag:n,stats:t,networkDetails:a})};return t}(c);var U=M;function B(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function G(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function H(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var j=function(e){H(t,e);function t(r){B(this,t);var i=G(this,e.call(this,r,s["a"].KEY_LOADING));i.loaders={};i.decryptkey=null;i.decrypturl=null;return i}t.prototype.destroy=function e(){for(var t in this.loaders){var r=this.loaders[t];if(r){r.destroy()}}this.loaders={};c.prototype.destroy.call(this)};t.prototype.onKeyLoading=function e(t){var r=t.frag,i=r.type,a=this.loaders[i],n=r.decryptdata,o=n.uri;if(o!==this.decrypturl||this.decryptkey===null){var u=this.hls.config;if(a){l["b"].warn("abort previous key loader for type:"+i);a.abort()}r.loader=this.loaders[i]=new u.loader(u);this.decrypturl=o;this.decryptkey=null;var f=void 0,d=void 0,c=void 0;f={url:o,frag:r,responseType:"arraybuffer"};d={timeout:u.fragLoadingTimeOut,maxRetry:u.fragLoadingMaxRetry,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout};c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};r.loader.load(f,d,c)}else if(this.decryptkey){n.key=this.decryptkey;this.hls.trigger(s["a"].KEY_LOADED,{frag:r})}};t.prototype.loadsuccess=function e(t,r,i){var a=i.frag;this.decryptkey=a.decryptdata.key=new Uint8Array(t.data);a.loader=undefined;this.loaders[a.type]=undefined;this.hls.trigger(s["a"].KEY_LOADED,{frag:a})};t.prototype.loaderror=function e(t,r){var i=r.frag,a=i.loader;if(a){a.abort()}this.loaders[r.type]=undefined;this.hls.trigger(s["a"].ERROR,{type:o["b"].NETWORK_ERROR,details:o["a"].KEY_LOAD_ERROR,fatal:false,frag:i,response:t})};t.prototype.loadtimeout=function e(t,r){var i=r.frag,a=i.loader;if(a){a.abort()}this.loaders[r.type]=undefined;this.hls.trigger(s["a"].ERROR,{type:o["b"].NETWORK_ERROR,details:o["a"].KEY_LOAD_TIMEOUT,fatal:false,frag:i})};return t}(c);var $=j;var K={search:function e(t,r){var i=0;var a=t.length-1;var n=null;var s=null;while(i<=a){n=(i+a)/2|0;s=t[n];var o=r(s);if(o>0){i=n+1}else if(o<0){a=n-1}else{return s}}return null}};var W=K;var V={isBuffered:function e(t,r){try{if(t){var i=t.buffered;for(var a=0;a<i.length;a++){if(r>=i.start(a)&&r<=i.end(a)){return true}}}}catch(e){}return false},bufferInfo:function e(t,r,i){try{if(t){var a=t.buffered,n=[],s;for(s=0;s<a.length;s++){n.push({start:a.start(s),end:a.end(s)})}return this.bufferedInfo(n,r,i)}}catch(e){}return{len:0,start:r,end:r,nextStart:undefined}},bufferedInfo:function e(t,r,i){var a=[],n,s,o,l,u;t.sort(function(e,t){var r=e.start-t.start;if(r){return r}else{return t.end-e.end}});for(u=0;u<t.length;u++){var f=a.length;if(f){var d=a[f-1].end;if(t[u].start-d<i){if(t[u].end>d){a[f-1].end=t[u].end}}else{a.push(t[u])}}else{a.push(t[u])}}for(u=0,n=0,s=o=r;u<a.length;u++){var c=a[u].start,h=a[u].end;if(r+i>=c&&r<h){s=c;o=h;n=o-r}else if(r+i<c){l=c;break}}return{len:n,start:s,end:o,nextStart:l}}};var q=V;var Y=r(7);var z=r(5);var X=r.n(z);var Q=r(9);var J=r.n(Q);function Z(){if(typeof window!=="undefined"){return window.MediaSource||window.WebKitMediaSource}}function ee(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var te=Z();var re=function(){function e(t,r){ee(this,e);this.hls=t;this.id=r;var i=this.observer=new X.a;var a=t.config;i.trigger=function e(t){for(var r=arguments.length,a=Array(r>1?r-1:0),n=1;n<r;n++){a[n-1]=arguments[n]}i.emit.apply(i,[t,t].concat(a))};i.off=function e(t){for(var r=arguments.length,a=Array(r>1?r-1:0),n=1;n<r;n++){a[n-1]=arguments[n]}i.removeListener.apply(i,[t].concat(a))};var n=function(e,r){r=r||{};r.frag=this.frag;r.id=this.id;t.trigger(e,r)}.bind(this);i.on(s["a"].FRAG_DECRYPTED,n);i.on(s["a"].FRAG_PARSING_INIT_SEGMENT,n);i.on(s["a"].FRAG_PARSING_DATA,n);i.on(s["a"].FRAG_PARSED,n);i.on(s["a"].ERROR,n);i.on(s["a"].FRAG_PARSING_METADATA,n);i.on(s["a"].FRAG_PARSING_USERDATA,n);i.on(s["a"].INIT_PTS_FOUND,n);var u={mp4:te.isTypeSupported("video/mp4"),mpeg:te.isTypeSupported("audio/mpeg"),mp3:te.isTypeSupported('audio/mp4; codecs="mp3"')};var f=navigator.vendor;if(a.enableWorker&&typeof Worker!=="undefined"){l["b"].log("demuxing in webworker");var d=void 0;try{d=this.w=J()(10);this.onwmsg=this.onWorkerMessage.bind(this);d.addEventListener("message",this.onwmsg);d.onerror=function(e){t.trigger(s["a"].ERROR,{type:o["b"].OTHER_ERROR,details:o["a"].INTERNAL_EXCEPTION,fatal:true,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})};d.postMessage({cmd:"init",typeSupported:u,vendor:f,id:r,config:JSON.stringify(a)})}catch(e){l["b"].error("error while initializing DemuxerWorker, fallback on DemuxerInline");if(d){URL.revokeObjectURL(d.objectURL)}this.demuxer=new Y["a"](i,u,a,f);this.w=undefined}}else{this.demuxer=new Y["a"](i,u,a,f)}}e.prototype.destroy=function e(){var t=this.w;if(t){t.removeEventListener("message",this.onwmsg);t.terminate();this.w=null}else{var r=this.demuxer;if(r){r.destroy();this.demuxer=null}}var i=this.observer;if(i){i.removeAllListeners();this.observer=null}};e.prototype.push=function e(t,r,i,a,n,s,o,u){var f=this.w;var d=!isNaN(n.startDTS)?n.startDTS:n.start;var c=n.decryptdata;var h=this.frag;var p=!(h&&n.cc===h.cc);var v=!(h&&n.level===h.level);var g=h&&n.sn===h.sn+1;var m=!v&&g;if(p){l["b"].log(this.id+":discontinuity detected")}if(v){l["b"].log(this.id+":switch detected")}this.frag=n;if(f){f.postMessage({cmd:"demux",data:t,decryptdata:c,initSegment:r,audioCodec:i,videoCodec:a,timeOffset:d,discontinuity:p,trackSwitch:v,contiguous:m,duration:s,accurateTimeOffset:o,defaultInitPTS:u},t instanceof ArrayBuffer?[t]:[])}else{var y=this.demuxer;if(y){y.push(t,c,r,i,a,d,p,v,m,s,o,u)}}};e.prototype.onWorkerMessage=function e(t){var r=t.data,i=this.hls;switch(r.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case s["a"].FRAG_PARSING_DATA:r.data.data1=new Uint8Array(r.data1);if(r.data2){r.data.data2=new Uint8Array(r.data2)}default:r.data=r.data||{};r.data.frag=this.frag;r.data.id=this.id;i.trigger(r.event,r.data);break}};return e}();var ie=re;function ae(e,t,r){var i=e[t],a=e[r],n=a.startPTS;if(!isNaN(n)){if(r>t){i.duration=n-i.start;if(i.duration<0){l["b"].warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")}}else{a.duration=i.start-n;if(a.duration<0){l["b"].warn("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!")}}}else{if(r>t){a.start=i.start+i.duration}else{a.start=Math.max(i.start-a.duration,0)}}}function ne(e,t,r,i,a,n){var s=r;if(!isNaN(t.startPTS)){var o=Math.abs(t.startPTS-r);if(isNaN(t.deltaPTS)){t.deltaPTS=o}else{t.deltaPTS=Math.max(o,t.deltaPTS)}s=Math.max(r,t.startPTS);r=Math.min(r,t.startPTS);i=Math.max(i,t.endPTS);a=Math.min(a,t.startDTS);n=Math.max(n,t.endDTS)}var l=r-t.start;t.start=t.startPTS=r;t.maxStartPTS=s;t.endPTS=i;t.startDTS=a;t.endDTS=n;t.duration=i-r;var u=t.sn;if(!e||u<e.startSN||u>e.endSN){return 0}var f,d,c;f=u-e.startSN;d=e.fragments;d[f]=t;for(c=f;c>0;c--){ae(d,c,c-1)}for(c=f;c<d.length-1;c++){ae(d,c,c+1)}e.PTSKnown=true;return l}function se(e,t){var r=Math.max(e.startSN,t.startSN)-t.startSN,i=Math.min(e.endSN,t.endSN)-t.startSN,a=t.startSN-e.startSN,n=e.fragments,s=t.fragments,o=0,u;if(i<r){t.PTSKnown=false;return}for(var f=r;f<=i;f++){var d=n[a+f],c=s[f];if(c&&d){o=d.cc-c.cc;if(!isNaN(d.startPTS)){c.start=c.startPTS=d.startPTS;c.endPTS=d.endPTS;c.duration=d.duration;c.backtracked=d.backtracked;c.dropped=d.dropped;u=c}}}if(o){l["b"].log("discontinuity sliding from playlist, take drift into account");for(f=0;f<s.length;f++){s[f].cc+=o}}if(u){ne(t,u,u.startPTS,u.endPTS,u.startDTS,u.endDTS)}else{if(a>=0&&a<n.length){var h=n[a].start;for(f=0;f<s.length;f++){s[f].start+=h}}}t.PTSKnown=e.PTSKnown}var oe={toString:function e(t){var r="",i=t.length;for(var a=0;a<i;a++){r+="["+t.start(a).toFixed(3)+","+t.end(a).toFixed(3)+"]"}return r}};var le=oe;function ue(e,t){var r=null;for(var i=0;i<e.length;i+=1){var a=e[i];if(a&&a.cc===t){r=a;break}}return r}function fe(e,t){return W.search(e,function(e){if(e.cc<t){return 1}else if(e.cc>t){return-1}else{return 0}})}function de(e,t,r){var i=false;if(t&&t.details&&r){if(r.endCC>r.startCC||e&&e.cc<r.startCC){i=true}}return i}function ce(e,t){var r=e.fragments;var i=t.fragments;if(!i.length||!r.length){l["b"].log("No fragments to align");return}var a=ue(r,i[0].cc);if(!a||a&&!a.startPTS){l["b"].log("No frag in previous level to align on");return}return a}function he(e,t){t.fragments.forEach(function(t){if(t){var r=t.start+e;t.start=t.startPTS=r;t.endPTS=r+t.duration}});t.PTSKnown=true}function pe(e,t,r){if(de(e,t,r)){var i=ce(t.details,r);if(i){l["b"].log("Adjusting PTS using last level due to CC increase within current level");he(i.start,r)}}if(r.PTSKnown===false&&t&&t.details){var a=t.details.programDateTime;var n=r.programDateTime;var s=(n-a)/1e3+t.details.fragments[0].start;if(!isNaN(s)){l["b"].log("adjusting PTS using programDateTime delta, sliding:"+s.toFixed(3));he(s,r)}}}var ve=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function ge(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function me(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function ye(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var be={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"};var _e=function(e){ye(t,e);function t(r){ge(this,t);var i=me(this,e.call(this,r,s["a"].MEDIA_ATTACHED,s["a"].MEDIA_DETACHING,s["a"].MANIFEST_LOADING,s["a"].MANIFEST_PARSED,s["a"].LEVEL_LOADED,s["a"].KEY_LOADED,s["a"].FRAG_LOADED,s["a"].FRAG_LOAD_EMERGENCY_ABORTED,s["a"].FRAG_PARSING_INIT_SEGMENT,s["a"].FRAG_PARSING_DATA,s["a"].FRAG_PARSED,s["a"].ERROR,s["a"].AUDIO_TRACK_SWITCHING,s["a"].AUDIO_TRACK_SWITCHED,s["a"].BUFFER_CREATED,s["a"].BUFFER_APPENDED,s["a"].BUFFER_FLUSHED));i.config=r.config;i.audioCodecSwap=false;i.ticks=0;i._state=be.STOPPED;i.ontick=i.tick.bind(i);return i}t.prototype.destroy=function e(){this.stopLoad();if(this.timer){clearInterval(this.timer);this.timer=null}c.prototype.destroy.call(this);this.state=be.STOPPED};t.prototype.startLoad=function e(t){if(this.levels){var r=this.lastCurrentTime,i=this.hls;this.stopLoad();if(!this.timer){this.timer=setInterval(this.ontick,100)}this.level=-1;this.fragLoadError=0;if(!this.startFragRequested){var a=i.startLevel;if(a===-1){a=0;this.bitrateTest=true}this.level=i.nextLoadLevel=a;this.loadedmetadata=false}if(r>0&&t===-1){l["b"].log("override startPosition with lastCurrentTime @"+r.toFixed(3));t=r}this.state=be.IDLE;this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t;this.tick()}else{this.forceStartLoad=true;this.state=be.STOPPED}};t.prototype.stopLoad=function e(){var t=this.fragCurrent;if(t){if(t.loader){t.loader.abort()}this.fragCurrent=null}this.fragPrevious=null;if(this.demuxer){this.demuxer.destroy();this.demuxer=null}this.state=be.STOPPED;this.forceStartLoad=false};t.prototype.tick=function e(){this.ticks++;if(this.ticks===1){this.doTick();if(this.ticks>1){setTimeout(this.tick,1)}this.ticks=0}};t.prototype.doTick=function e(){switch(this.state){case be.ERROR:break;case be.BUFFER_FLUSHING:this.fragLoadError=0;break;case be.IDLE:this._doTickIdle();break;case be.WAITING_LEVEL:var t=this.levels[this.level];if(t&&t.details){this.state=be.IDLE}break;case be.FRAG_LOADING_WAITING_RETRY:var r=performance.now();var i=this.retryDate;if(!i||r>=i||this.media&&this.media.seeking){l["b"].log("mediaController: retryDate reached, switch back to IDLE state");this.state=be.IDLE}break;case be.ERROR:case be.STOPPED:case be.FRAG_LOADING:case be.PARSING:case be.PARSED:case be.ENDED:break;default:break}this._checkBuffer();this._checkFragmentChanged()};t.prototype._doTickIdle=function e(){var t=this.hls,r=t.config,i=this.media;if(this.levelLastLoaded===undefined||!i&&(this.startFragRequested||!r.startFragPrefetch)){return}var a=void 0;if(this.loadedmetadata){a=i.currentTime}else{a=this.nextLoadPosition}var n=t.nextLoadLevel,o=this.levels[n];if(!o){return}var u=o.bitrate,f=void 0;if(u){f=Math.max(8*r.maxBufferSize/u,r.maxBufferLength)}else{f=r.maxBufferLength}f=Math.min(f,r.maxMaxBufferLength);var d=q.bufferInfo(this.mediaBuffer?this.mediaBuffer:i,a,r.maxBufferHole),c=d.len;if(c>=f){return}l["b"].trace("buffer length of "+c.toFixed(3)+" is below max of "+f.toFixed(3)+". checking for more payload ...");this.level=t.nextLoadLevel=n;var h=o.details;if(h===undefined||h.live===true&&this.levelLastLoaded!==n){this.state=be.WAITING_LEVEL;return}var p=this.fragPrevious;if(!h.live&&p&&!p.backtracked&&p.sn===h.endSN&&!d.nextStart){var v=Math.min(i.duration,p.start+p.duration);if(v-Math.max(d.end,p.start)<=Math.max(.2,p.duration)){var g={};if(this.altAudio){g.type="video"}this.hls.trigger(s["a"].BUFFER_EOS,g);this.state=be.ENDED;return}}this._fetchPayloadOrEos(a,d,h)};t.prototype._fetchPayloadOrEos=function e(t,r,i){var a=this.fragPrevious,n=this.level,s=i.fragments,o=s.length;if(o===0){return}var u=s[0].start,f=s[o-1].start+s[o-1].duration,d=r.end,c=void 0;if(i.initSegment&&!i.initSegment.data){c=i.initSegment}else{if(i.live){var h=this.config.initialLiveManifestSize;if(o<h){l["b"].warn("Can not start playback of a level, reason: not enough fragments "+o+" < "+h);return}c=this._ensureFragmentAtLivePoint(i,d,u,f,a,s,o);if(c===null){return}}else{if(d<u){c=s[0]}}}if(!c){c=this._findFragment(u,a,o,s,d,f,i)}if(c){this._loadFragmentOrKey(c,n,i,t,d)}return};t.prototype._ensureFragmentAtLivePoint=function e(t,r,i,a,n,s,o){var u=this.hls.config,f=this.media;var d=void 0;var c=u.liveMaxLatencyDuration!==undefined?u.liveMaxLatencyDuration:u.liveMaxLatencyDurationCount*t.targetduration;if(r<Math.max(i-u.maxFragLookUpTolerance,a-c)){var h=this.liveSyncPosition=this.computeLivePosition(i,t);l["b"].log("buffer end: "+r.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+h.toFixed(3));r=h;if(f&&f.readyState&&f.duration>h){f.currentTime=h}this.nextLoadPosition=h}if(t.PTSKnown&&r>a&&f&&f.readyState){return null}if(this.startFragRequested&&!t.PTSKnown){if(n){var p=n.sn+1;if(p>=t.startSN&&p<=t.endSN){var v=s[p-t.startSN];if(n.cc===v.cc){d=v;l["b"].log("live playlist, switching playlist, load frag with next SN: "+d.sn)}}if(!d){d=W.search(s,function(e){return n.cc-e.cc});if(d){l["b"].log("live playlist, switching playlist, load frag with same CC: "+d.sn)}}}if(!d){d=s[Math.min(o-1,Math.round(o/2))];l["b"].log("live playlist, switching playlist, unknown, load middle frag : "+d.sn)}}return d};t.prototype._findFragment=function e(t,r,i,a,n,s,o){var u=this.hls.config;var f=void 0;var d=void 0;var c=u.maxFragLookUpTolerance;var h=r?a[r.sn-a[0].sn+1]:undefined;var p=function e(t){var r=Math.min(c,t.duration+(t.deltaPTS?t.deltaPTS:0));if(t.start+t.duration-r<=n){return 1}else if(t.start-r>n&&t.start){return-1}return 0};if(n<s){if(n>s-c){c=0}if(h&&!p(h)){d=h}else{d=W.search(a,p)}}else{d=a[i-1]}if(d){f=d;var v=f.sn-o.startSN;var g=r&&f.level===r.level;var m=a[v-1];var y=a[v+1];if(r&&f.sn===r.sn){if(g&&!f.backtracked){if(f.sn<o.endSN){var b=r.deltaPTS;if(b&&b>u.maxBufferHole&&r.dropped&&v){f=m;l["b"].warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this");r.loadCounter--}else{f=y;l["b"].log("SN just loaded, load next one: "+f.sn)}}else{f=null}}else if(f.backtracked){if(y&&y.backtracked){l["b"].warn("Already backtracked from fragment "+y.sn+", will not backtrack to fragment "+f.sn+". Loading fragment "+y.sn);f=y}else{l["b"].warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe");f.dropped=0;if(m){if(m.loadCounter){m.loadCounter--}f=m;f.backtracked=true}else if(v){f=null}}}}}return f};t.prototype._loadFragmentOrKey=function e(t,r,i,a,n){var u=this.hls,f=u.config;if(t.decryptdata&&t.decryptdata.uri!=null&&t.decryptdata.key==null){l["b"].log("Loading key for "+t.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+r);this.state=be.KEY_LOADING;u.trigger(s["a"].KEY_LOADING,{frag:t})}else{l["b"].log("Loading "+t.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+r+", currentTime:"+a.toFixed(3)+",bufferEnd:"+n.toFixed(3));if(this.fragLoadIdx!==undefined){this.fragLoadIdx++}else{this.fragLoadIdx=0}if(t.loadCounter){t.loadCounter++;var d=f.fragLoadingLoopThreshold;if(t.loadCounter>d&&Math.abs(this.fragLoadIdx-t.loadIdx)<d){u.trigger(s["a"].ERROR,{type:o["b"].MEDIA_ERROR,details:o["a"].FRAG_LOOP_LOADING_ERROR,fatal:false,frag:t});return}}else{t.loadCounter=1}t.loadIdx=this.fragLoadIdx;t.autoLevel=u.autoLevelEnabled;t.bitrateTest=this.bitrateTest;this.fragCurrent=t;this.startFragRequested=true;if(!isNaN(t.sn)&&!t.bitrateTest){this.nextLoadPosition=t.start+t.duration}u.trigger(s["a"].FRAG_LOADING,{frag:t});if(!this.demuxer){this.demuxer=new ie(u,"main")}this.state=be.FRAG_LOADING;return}};t.prototype.getBufferedFrag=function e(t){return W.search(this._bufferedFrags,function(e){if(t<e.startPTS){return-1}else if(t>e.endPTS){return 1}return 0})};t.prototype.followingBufferedFrag=function e(t){if(t){return this.getBufferedFrag(t.endPTS+.5)}return null};t.prototype._checkFragmentChanged=function e(){var t,r,i=this.media;if(i&&i.readyState&&i.seeking===false){r=i.currentTime;if(r>i.playbackRate*this.lastCurrentTime){this.lastCurrentTime=r}if(q.isBuffered(i,r)){t=this.getBufferedFrag(r)}else if(q.isBuffered(i,r+.1)){t=this.getBufferedFrag(r+.1)}if(t){var a=t;if(a!==this.fragPlaying){this.hls.trigger(s["a"].FRAG_CHANGED,{frag:a});var n=a.level;if(!this.fragPlaying||this.fragPlaying.level!==n){this.hls.trigger(s["a"].LEVEL_SWITCHED,{level:n})}this.fragPlaying=a}}}};t.prototype.immediateLevelSwitch=function e(){l["b"].log("immediateLevelSwitch");if(!this.immediateSwitch){this.immediateSwitch=true;var t=this.media,r=void 0;if(t){r=t.paused;t.pause()}else{r=true}this.previouslyPaused=r}var i=this.fragCurrent;if(i&&i.loader){i.loader.abort()}this.fragCurrent=null;if(this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold}this.flushMainBuffer(0,Number.POSITIVE_INFINITY)};t.prototype.immediateLevelSwitchEnd=function e(){var t=this.media;if(t&&t.buffered.length){this.immediateSwitch=false;if(q.isBuffered(t,t.currentTime)){t.currentTime-=1e-4}if(!this.previouslyPaused){t.play()}}};t.prototype.nextLevelSwitch=function e(){var t=this.media;if(t&&t.readyState){var r=void 0,i=void 0,a=void 0;if(this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold}i=this.getBufferedFrag(t.currentTime);if(i&&i.startPTS>1){this.flushMainBuffer(0,i.startPTS-1)}if(!t.paused){var n=this.hls.nextLoadLevel,s=this.levels[n],o=this.fragLastKbps;if(o&&this.fragCurrent){r=this.fragCurrent.duration*s.bitrate/(1e3*o)+1}else{r=0}}else{r=0}a=this.getBufferedFrag(t.currentTime+r);if(a){a=this.followingBufferedFrag(a);if(a){var l=this.fragCurrent;if(l&&l.loader){l.loader.abort()}this.fragCurrent=null;this.flushMainBuffer(a.maxStartPTS,Number.POSITIVE_INFINITY)}}}};t.prototype.flushMainBuffer=function e(t,r){this.state=be.BUFFER_FLUSHING;var i={startOffset:t,endOffset:r};if(this.altAudio){i.type="video"}this.hls.trigger(s["a"].BUFFER_FLUSHING,i)};t.prototype.onMediaAttached=function e(t){var r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this);this.onvseeked=this.onMediaSeeked.bind(this);this.onvended=this.onMediaEnded.bind(this);r.addEventListener("seeking",this.onvseeking);r.addEventListener("seeked",this.onvseeked);r.addEventListener("ended",this.onvended);var i=this.config;if(this.levels&&i.autoStartLoad){this.hls.startLoad(i.startPosition)}};t.prototype.onMediaDetaching=function e(){var t=this.media;if(t&&t.ended){l["b"].log("MSE detaching and video ended, reset startPosition");this.startPosition=this.lastCurrentTime=0}var r=this.levels;if(r){r.forEach(function(e){if(e.details){e.details.fragments.forEach(function(e){e.loadCounter=undefined;e.backtracked=undefined})}})}if(t){t.removeEventListener("seeking",this.onvseeking);t.removeEventListener("seeked",this.onvseeked);t.removeEventListener("ended",this.onvended);this.onvseeking=this.onvseeked=this.onvended=null}this.media=this.mediaBuffer=null;this.loadedmetadata=false;this.stopLoad()};t.prototype.onMediaSeeking=function e(){var t=this.media,r=t?t.currentTime:undefined,i=this.config;if(!isNaN(r)){l["b"].log("media seeking to "+r.toFixed(3))}var a=this.mediaBuffer?this.mediaBuffer:t;var n=q.bufferInfo(a,r,this.config.maxBufferHole);if(this.state===be.FRAG_LOADING){var s=this.fragCurrent;if(n.len===0&&s){var o=i.maxFragLookUpTolerance,u=s.start-o,f=s.start+s.duration+o;if(r<u||r>f){if(s.loader){l["b"].log("seeking outside of buffer while fragment load in progress, cancel fragment load");s.loader.abort()}this.fragCurrent=null;this.fragPrevious=null;this.state=be.IDLE}else{l["b"].log("seeking outside of buffer but within currently loaded fragment range")}}}else if(this.state===be.ENDED){if(n.len===0){this.fragPrevious=0}this.state=be.IDLE}if(t){this.lastCurrentTime=r}if(this.state!==be.FRAG_LOADING&&this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*i.fragLoadingLoopThreshold}if(!this.loadedmetadata){this.nextLoadPosition=this.startPosition=r}this.tick()};t.prototype.onMediaSeeked=function e(){var t=this.media,r=t?t.currentTime:undefined;if(!isNaN(r)){l["b"].log("media seeked to "+r.toFixed(3))}this.tick()};t.prototype.onMediaEnded=function e(){l["b"].log("media ended");this.startPosition=this.lastCurrentTime=0};t.prototype.onManifestLoading=function e(){l["b"].log("trigger BUFFER_RESET");this.hls.trigger(s["a"].BUFFER_RESET);this._bufferedFrags=[];this.stalled=false;this.startPosition=this.lastCurrentTime=0};t.prototype.onManifestParsed=function e(t){var r=false,i=false,a;t.levels.forEach(function(e){a=e.audioCodec;if(a){if(a.indexOf("mp4a.40.2")!==-1){r=true}if(a.indexOf("mp4a.40.5")!==-1){i=true}}});this.audioCodecSwitch=r&&i;if(this.audioCodecSwitch){l["b"].log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC")}this.levels=t.levels;this.startFragRequested=false;var n=this.config;if(n.autoStartLoad||this.forceStartLoad){this.hls.startLoad(n.startPosition)}};t.prototype.onLevelLoaded=function e(t){var r=t.details;var i=t.level;var a=this.levels[this.levelLastLoaded];var n=this.levels[i];var o=r.totalduration;var u=0;l["b"].log("level "+i+" loaded ["+r.startSN+","+r.endSN+"],duration:"+o);if(r.live){var f=n.details;if(f&&r.fragments.length>0){se(f,r);u=r.fragments[0].start;this.liveSyncPosition=this.computeLivePosition(u,f);if(r.PTSKnown&&!isNaN(u)){l["b"].log("live playlist sliding:"+u.toFixed(3))}else{l["b"].log("live playlist - outdated PTS, unknown sliding");pe(this.fragPrevious,a,r)}}else{l["b"].log("live playlist - first load, unknown sliding");r.PTSKnown=false;pe(this.fragPrevious,a,r)}}else{r.PTSKnown=false}n.details=r;this.levelLastLoaded=i;this.hls.trigger(s["a"].LEVEL_UPDATED,{details:r,level:i});if(this.startFragRequested===false){if(this.startPosition===-1||this.lastCurrentTime===-1){var d=r.startTimeOffset;if(!isNaN(d)){if(d<0){l["b"].log("negative start time offset "+d+", count from end of last fragment");d=u+o+d}l["b"].log("start time offset found in playlist, adjust startPosition to "+d);this.startPosition=d}else{if(r.live){this.startPosition=this.computeLivePosition(u,r);l["b"].log("configure startPosition to "+this.startPosition)}else{this.startPosition=0}}this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}if(this.state===be.WAITING_LEVEL){this.state=be.IDLE}this.tick()};t.prototype.onKeyLoaded=function e(){if(this.state===be.KEY_LOADING){this.state=be.IDLE;this.tick()}};t.prototype.onFragLoaded=function e(t){var r=this.fragCurrent,i=t.frag;if(this.state===be.FRAG_LOADING&&r&&i.type==="main"&&i.level===r.level&&i.sn===r.sn){var a=t.stats,n=this.levels[r.level],o=n.details;l["b"].log("Loaded  "+r.sn+" of ["+o.startSN+" ,"+o.endSN+"],level "+r.level);this.bitrateTest=false;this.stats=a;if(i.bitrateTest===true&&this.hls.nextLoadLevel){this.state=be.IDLE;this.startFragRequested=false;a.tparsed=a.tbuffered=performance.now();this.hls.trigger(s["a"].FRAG_BUFFERED,{stats:a,frag:r,id:"main"});this.tick()}else if(i.sn==="initSegment"){this.state=be.IDLE;a.tparsed=a.tbuffered=performance.now();o.initSegment.data=t.payload;this.hls.trigger(s["a"].FRAG_BUFFERED,{stats:a,frag:r,id:"main"});this.tick()}else{this.state=be.PARSING;var u=o.totalduration,f=r.level,d=r.sn,c=this.config.defaultAudioCodec||n.audioCodec;if(this.audioCodecSwap){l["b"].log("swapping playlist audio codec");if(c===undefined){c=this.lastAudioCodec}if(c){if(c.indexOf("mp4a.40.5")!==-1){c="mp4a.40.2"}else{c="mp4a.40.5"}}}this.pendingBuffering=true;this.appended=false;l["b"].log("Parsing "+d+" of ["+o.startSN+" ,"+o.endSN+"],level "+f+", cc "+r.cc);var h=this.demuxer;if(!h){h=this.demuxer=new ie(this.hls,"main")}var p=this.media;var v=p&&p.seeking;var g=!v&&(o.PTSKnown||!o.live);var m=o.initSegment?o.initSegment.data:[];h.push(t.payload,m,c,n.videoCodec,r,u,g,undefined)}}this.fragLoadError=0};t.prototype.onFragParsingInitSegment=function e(t){var r=this.fragCurrent;var i=t.frag;if(r&&t.id==="main"&&i.sn===r.sn&&i.level===r.level&&this.state===be.PARSING){var a=t.tracks,n,o;if(a.audio&&this.altAudio){delete a.audio}o=a.audio;if(o){var u=this.levels[this.level].audioCodec,f=navigator.userAgent.toLowerCase();if(u&&this.audioCodecSwap){l["b"].log("swapping playlist audio codec");if(u.indexOf("mp4a.40.5")!==-1){u="mp4a.40.2"}else{u="mp4a.40.5"}}if(this.audioCodecSwitch){if(o.metadata.channelCount!==1&&f.indexOf("firefox")===-1){u="mp4a.40.5"}}if(f.indexOf("android")!==-1&&o.container!=="audio/mpeg"){u="mp4a.40.2";l["b"].log("Android: force audio codec to "+u)}o.levelCodec=u;o.id=t.id}o=a.video;if(o){o.levelCodec=this.levels[this.level].videoCodec;o.id=t.id}this.hls.trigger(s["a"].BUFFER_CODECS,a);for(n in a){o=a[n];l["b"].log("main track:"+n+",container:"+o.container+",codecs[level/parsed]=["+o.levelCodec+"/"+o.codec+"]");var d=o.initSegment;if(d){this.appended=true;this.pendingBuffering=true;this.hls.trigger(s["a"].BUFFER_APPENDING,{type:n,data:d,parent:"main",content:"initSegment"})}}this.tick()}};t.prototype.onFragParsingData=function e(t){var r=this;var i=this.fragCurrent;var a=t.frag;if(i&&t.id==="main"&&a.sn===i.sn&&a.level===i.level&&!(t.type==="audio"&&this.altAudio)&&this.state===be.PARSING){var n=this.levels[this.level],o=i;if(isNaN(t.endPTS)){t.endPTS=t.startPTS+i.duration;t.endDTS=t.startDTS+i.duration}l["b"].log("Parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb+",dropped:"+(t.dropped||0));if(t.type==="video"){o.dropped=t.dropped;if(o.dropped){if(!o.backtracked){var u=n.details;if(u&&o.sn===u.startSN){l["b"].warn("missing video frame(s) on first frag, appending with gap")}else{l["b"].warn("missing video frame(s), backtracking fragment");o.backtracked=true;this.nextLoadPosition=t.startPTS;this.state=be.IDLE;this.fragPrevious=o;this.tick();return}}else{l["b"].warn("Already backtracked on this fragment, appending with the gap")}}else{o.backtracked=false}}var f=ne(n.details,o,t.startPTS,t.endPTS,t.startDTS,t.endDTS),d=this.hls;d.trigger(s["a"].LEVEL_PTS_UPDATED,{details:n.details,level:this.level,drift:f,type:t.type,start:t.startPTS,end:t.endPTS});[t.data1,t.data2].forEach(function(e){if(e&&e.length&&r.state===be.PARSING){r.appended=true;r.pendingBuffering=true;d.trigger(s["a"].BUFFER_APPENDING,{type:t.type,data:e,parent:"main",content:"data"})}});this.tick()}};t.prototype.onFragParsed=function e(t){var r=this.fragCurrent;var i=t.frag;if(r&&t.id==="main"&&i.sn===r.sn&&i.level===r.level&&this.state===be.PARSING){this.stats.tparsed=performance.now();this.state=be.PARSED;this._checkAppendedParsed()}};t.prototype.onAudioTrackSwitching=function e(t){var r=!!t.url,i=t.id;if(!r){if(this.mediaBuffer!==this.media){l["b"].log("switching on main audio, use media.buffered to schedule main fragment loading");this.mediaBuffer=this.media;var a=this.fragCurrent;if(a.loader){l["b"].log("switching to main audio track, cancel main fragment load");a.loader.abort()}this.fragCurrent=null;this.fragPrevious=null;if(this.demuxer){this.demuxer.destroy();this.demuxer=null}this.state=be.IDLE}var n=this.hls;n.trigger(s["a"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"});n.trigger(s["a"].AUDIO_TRACK_SWITCHED,{id:i});this.altAudio=false}};t.prototype.onAudioTrackSwitched=function e(t){var r=t.id,i=!!this.hls.audioTracks[r].url;if(i){var a=this.videoBuffer;if(a&&this.mediaBuffer!==a){l["b"].log("switching on alternate audio, use video.buffered to schedule main fragment loading");this.mediaBuffer=a}}this.altAudio=i;this.tick()};t.prototype.onBufferCreated=function e(t){var r=t.tracks,i=void 0,a=void 0,n=false;for(var s in r){var o=r[s];if(o.id==="main"){a=s;i=o;if(s==="video"){this.videoBuffer=r[s].buffer}}else{n=true}}if(n&&i){l["b"].log("alternate track found, use "+a+".buffered to schedule main fragment loading");this.mediaBuffer=i.buffer}else{this.mediaBuffer=this.media}};t.prototype.onBufferAppended=function e(t){if(t.parent==="main"){var r=this.state;if(r===be.PARSING||r===be.PARSED){this.pendingBuffering=t.pending>0;this._checkAppendedParsed()}}};t.prototype._checkAppendedParsed=function e(){if(this.state===be.PARSED&&(!this.appended||!this.pendingBuffering)){var t=this.fragCurrent;if(t){var r=this.mediaBuffer?this.mediaBuffer:this.media;l["b"].log("main buffered : "+le.toString(r.buffered));var i=this._bufferedFrags.filter(function(e){return q.isBuffered(r,(e.startPTS+e.endPTS)/2)});i.push(t);this._bufferedFrags=i.sort(function(e,t){return e.startPTS-t.startPTS});this.fragPrevious=t;var a=this.stats;a.tbuffered=performance.now();this.fragLastKbps=Math.round(8*a.total/(a.tbuffered-a.tfirst));this.hls.trigger(s["a"].FRAG_BUFFERED,{stats:a,frag:t,id:"main"});this.state=be.IDLE}this.tick()}};t.prototype.onError=function e(t){var r=t.frag||this.fragCurrent;if(r&&r.type!=="main"){return}var i=!!this.media&&q.isBuffered(this.media,this.media.currentTime)&&q.isBuffered(this.media,this.media.currentTime+.5);switch(t.details){case o["a"].FRAG_LOAD_ERROR:case o["a"].FRAG_LOAD_TIMEOUT:case o["a"].KEY_LOAD_ERROR:case o["a"].KEY_LOAD_TIMEOUT:if(!t.fatal){if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var a=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);r.loadCounter=0;l["b"].warn("mediaController: frag loading failed, retry in "+a+" ms");this.retryDate=performance.now()+a;if(!this.loadedmetadata){this.startFragRequested=false;this.nextLoadPosition=this.startPosition}this.fragLoadError++;this.state=be.FRAG_LOADING_WAITING_RETRY}else{l["b"].error("mediaController: "+t.details+" reaches max retry, redispatch as fatal ...");t.fatal=true;this.state=be.ERROR}}break;case o["a"].FRAG_LOOP_LOADING_ERROR:if(!t.fatal){if(i){this._reduceMaxBufferLength(r.duration);this.state=be.IDLE}else{if(!r.autoLevel||r.level===0){t.fatal=true;this.state=be.ERROR}}}break;case o["a"].LEVEL_LOAD_ERROR:case o["a"].LEVEL_LOAD_TIMEOUT:if(this.state!==be.ERROR){if(t.fatal){this.state=be.ERROR;l["b"].warn("streamController: "+t.details+",switch to "+this.state+" state ...")}else{if(!t.levelRetry&&this.state===be.WAITING_LEVEL){this.state=be.IDLE}}}break;case o["a"].BUFFER_FULL_ERROR:if(t.parent==="main"&&(this.state===be.PARSING||this.state===be.PARSED)){if(i){this._reduceMaxBufferLength(this.config.maxBufferLength);this.state=be.IDLE}else{l["b"].warn("buffer full error also media.currentTime is not buffered, flush everything");this.fragCurrent=null;this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}}break;default:break}};t.prototype._reduceMaxBufferLength=function e(t){var r=this.config;if(r.maxMaxBufferLength>=t){r.maxMaxBufferLength/=2;l["b"].warn("main:reduce max buffer length to "+r.maxMaxBufferLength+"s");if(this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*r.fragLoadingLoopThreshold}}};t.prototype._checkBuffer=function e(){var t=this.media,r=this.config;if(t&&t.readyState){var i=t.currentTime,a=this.mediaBuffer?this.mediaBuffer:t,n=a.buffered;if(!this.loadedmetadata&&n.length){this.loadedmetadata=true;var u=t.seeking?i:this.startPosition,f=q.isBuffered(a,u),d=n.start(0),c=!f&&Math.abs(u-d)<r.maxSeekHole;if(i!==u||c){l["b"].log("target start position:"+u);if(c){u=d;l["b"].log("target start position not buffered, seek to buffered.start(0) "+u)}l["b"].log("adjust currentTime from "+i+" to "+u);t.currentTime=u}}else if(this.immediateSwitch){this.immediateLevelSwitchEnd()}else{var h=q.bufferInfo(t,i,0),p=!(t.paused||t.ended||t.buffered.length===0),v=.5,g=i!==this.lastCurrentTime;if(g){if(this.stallReported){l["b"].warn("playback not stuck anymore @"+i+", after "+Math.round(performance.now()-this.stalled)+"ms");this.stallReported=false}this.stalled=undefined;this.nudgeRetry=0}else{if(p){var m=performance.now();var y=this.hls;if(!this.stalled){this.stalled=m;this.stallReported=false}else{var b=m-this.stalled;var _=h.len;var E=this.nudgeRetry||0;if(_<=v&&b>r.lowBufferWatchdogPeriod*1e3){if(!this.stallReported){this.stallReported=true;l["b"].warn("playback stalling in low buffer @"+i);y.trigger(s["a"].ERROR,{type:o["b"].MEDIA_ERROR,details:o["a"].BUFFER_STALLED_ERROR,fatal:false,buffer:_})}var T=h.nextStart,S=T-i;if(T&&S<r.maxSeekHole&&S>0){this.nudgeRetry=++E;var w=E*r.nudgeOffset;l["b"].log("adjust currentTime from "+t.currentTime+" to next buffered @ "+T+" + nudge "+w);t.currentTime=T+w;this.stalled=undefined;y.trigger(s["a"].ERROR,{type:o["b"].MEDIA_ERROR,details:o["a"].BUFFER_SEEK_OVER_HOLE,fatal:false,hole:T+w-i})}}else if(_>v&&b>r.highBufferWatchdogPeriod*1e3){if(!this.stallReported){this.stallReported=true;l["b"].warn("playback stalling in high buffer @"+i);y.trigger(s["a"].ERROR,{type:o["b"].MEDIA_ERROR,details:o["a"].BUFFER_STALLED_ERROR,fatal:false,buffer:_})}this.stalled=undefined;this.nudgeRetry=++E;if(E<r.nudgeMaxRetry){var R=t.currentTime;var A=R+E*r.nudgeOffset;l["b"].log("adjust currentTime from "+R+" to "+A);t.currentTime=A;y.trigger(s["a"].ERROR,{type:o["b"].MEDIA_ERROR,details:o["a"].BUFFER_NUDGE_ON_STALL,fatal:false})}else{l["b"].error("still stuck in high buffer @"+i+" after "+r.nudgeMaxRetry+", raise fatal error");y.trigger(s["a"].ERROR,{type:o["b"].MEDIA_ERROR,details:o["a"].BUFFER_STALLED_ERROR,fatal:true})}}}}}}}};t.prototype.onFragLoadEmergencyAborted=function e(){this.state=be.IDLE;if(!this.loadedmetadata){this.startFragRequested=false;this.nextLoadPosition=this.startPosition}this.tick()};t.prototype.onBufferFlushed=function e(){var t=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(e){return q.isBuffered(t,(e.startPTS+e.endPTS)/2)});if(this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold}this.state=be.IDLE;this.fragPrevious=null};t.prototype.swapAudioCodec=function e(){this.audioCodecSwap=!this.audioCodecSwap};t.prototype.computeLivePosition=function e(t,r){var i=this.config.liveSyncDuration!==undefined?this.config.liveSyncDuration:this.config.liveSyncDurationCount*r.targetduration;return t+Math.max(0,r.totalduration-i)};ve(t,[{key:"state",set:function e(t){if(this.state!==t){var r=this.state;this._state=t;l["b"].log("main stream:"+r+"->"+t);this.hls.trigger(s["a"].STREAM_STATE_TRANSITION,{previousState:r,nextState:t})}},get:function e(){return this._state}},{key:"currentLevel",get:function e(){var t=this.media;if(t){var r=this.getBufferedFrag(t.currentTime);if(r){return r.level}}return-1}},{key:"nextBufferedFrag",get:function e(){var t=this.media;if(t){return this.followingBufferedFrag(this.getBufferedFrag(t.currentTime))}else{return null}}},{key:"nextLevel",get:function e(){var t=this.nextBufferedFrag;if(t){return t.level}else{return-1}}},{key:"liveSyncPosition",get:function e(){return this._liveSyncPosition},set:function e(t){this._liveSyncPosition=t}}]);return t}(c);var Ee=_e;var Te=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function Se(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function we(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function Re(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var Ae=function(e){Re(t,e);function t(r){Se(this,t);var i=we(this,e.call(this,r,s["a"].MANIFEST_LOADED,s["a"].LEVEL_LOADED,s["a"].FRAG_LOADED,s["a"].ERROR));i.canload=false;i.currentLevelIndex=null;i.manualLevelIndex=-1;i.timer=null;return i}t.prototype.destroy=function e(){this.cleanTimer();this.manualLevelIndex=-1};t.prototype.cleanTimer=function e(){if(this.timer!==null){clearTimeout(this.timer);this.timer=null}};t.prototype.startLoad=function e(){var t=this._levels;this.canload=true;this.levelRetryCount=0;if(t){t.forEach(function(e){e.loadError=0;var t=e.details;if(t&&t.live){e.details=undefined}})}if(this.timer!==null){this.loadLevel()}};t.prototype.stopLoad=function e(){this.canload=false};t.prototype.onManifestLoaded=function e(t){var r=[];var i=void 0;var a={};var n=null;var u=false;var f=false;var d=/chrome|firefox/.test(navigator.userAgent.toLowerCase());var c=[];t.levels.forEach(function(e){e.loadError=0;e.fragmentError=false;u=u||!!e.videoCodec;f=f||!!e.audioCodec||!!(e.attrs&&e.attrs.AUDIO);if(d===true&&e.audioCodec&&e.audioCodec.indexOf("mp4a.40.34")!==-1){e.audioCodec=undefined}n=a[e.bitrate];if(n===undefined){e.url=[e.url];e.urlId=0;a[e.bitrate]=e;r.push(e)}else{n.url.push(e.url)}});if(u===true&&f===true){r=r.filter(function(e){var t=e.videoCodec;return!!t})}r=r.filter(function(e){var t=e.audioCodec,r=e.videoCodec;return(!t||_(t))&&(!r||_(r))});if(t.audioTracks){c=t.audioTracks.filter(function(e){return!e.audioCodec||_(e.audioCodec,"audio")})}if(r.length>0){i=r[0].bitrate;r.sort(function(e,t){return e.bitrate-t.bitrate});this._levels=r;for(var h=0;h<r.length;h++){if(r[h].bitrate===i){this._firstLevel=h;l["b"].log("manifest loaded,"+r.length+" level(s) found, first bitrate:"+i);break}}this.hls.trigger(s["a"].MANIFEST_PARSED,{levels:r,audioTracks:c,firstLevel:this._firstLevel,stats:t.stats,audio:f,video:u,altAudio:c.length>0})}else{this.hls.trigger(s["a"].ERROR,{type:o["b"].MEDIA_ERROR,details:o["a"].MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:true,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})}};t.prototype.setLevelInternal=function e(t){var r=this._levels;var i=this.hls;if(t>=0&&t<r.length){this.cleanTimer();if(this.currentLevelIndex!==t){l["b"].log("switching to level "+t);this.currentLevelIndex=t;var a=r[t];a.level=t;i.trigger(s["a"].LEVEL_SWITCH,a);i.trigger(s["a"].LEVEL_SWITCHING,a)}var n=r[t],u=n.details;if(!u||u.live===true){var f=n.urlId;i.trigger(s["a"].LEVEL_LOADING,{url:n.url[f],level:t,id:f})}}else{i.trigger(s["a"].ERROR,{type:o["b"].OTHER_ERROR,details:o["a"].LEVEL_SWITCH_ERROR,level:t,fatal:false,reason:"invalid level idx"})}};t.prototype.onError=function e(t){if(t.fatal===true){if(t.type===o["b"].NETWORK_ERROR){this.cleanTimer()}return}var r=false,i=false;var a=void 0;switch(t.details){case o["a"].FRAG_LOAD_ERROR:case o["a"].FRAG_LOAD_TIMEOUT:case o["a"].FRAG_LOOP_LOADING_ERROR:case o["a"].KEY_LOAD_ERROR:case o["a"].KEY_LOAD_TIMEOUT:a=t.frag.level;i=true;break;case o["a"].LEVEL_LOAD_ERROR:case o["a"].LEVEL_LOAD_TIMEOUT:a=t.context.level;r=true;break;case o["a"].REMUX_ALLOC_ERROR:a=t.level;r=true;break}if(a!==undefined){this.recoverLevel(t,a,r,i)}};t.prototype.recoverLevel=function e(t,r,i,a){var n=this;var s=this.hls.config;var o=t.details;var u=this._levels[r];var f=void 0,d=void 0,c=void 0;u.loadError++;u.fragmentError=a;if(i===true){if(this.levelRetryCount+1<=s.levelLoadingMaxRetry){d=Math.min(Math.pow(2,this.levelRetryCount)*s.levelLoadingRetryDelay,s.levelLoadingMaxRetryTimeout);this.timer=setTimeout(function(){return n.loadLevel()},d);t.levelRetry=true;this.levelRetryCount++;l["b"].warn("level controller, "+o+", retry in "+d+" ms, current retry count is "+this.levelRetryCount)}else{l["b"].error("level controller, cannot recover from "+o+" error");this.currentLevelIndex=null;this.cleanTimer();t.fatal=true;return}}if(i===true||a===true){f=u.url.length;if(f>1&&u.loadError<f){l["b"].warn("level controller, "+o+" for level "+r+": switching to redundant stream id "+u.urlId);u.urlId=(u.urlId+1)%f;u.details=undefined}else{if(this.manualLevelIndex===-1){c=r===0?this._levels.length-1:r-1;l["b"].warn("level controller, "+o+": switch to "+c);this.hls.nextAutoLevel=this.currentLevelIndex=c}else if(a===true){l["b"].warn("level controller, "+o+": reload a fragment");this.currentLevelIndex=null}}}};t.prototype.onFragLoaded=function e(t){var r=t.frag;if(r!==undefined&&r.type==="main"){var i=this._levels[r.level];if(i!==undefined){i.fragmentError=false;i.loadError=0;this.levelRetryCount=0}}};t.prototype.onLevelLoaded=function e(t){var r=this;var i=t.level;if(i===this.currentLevelIndex){var a=this._levels[i];if(a.fragmentError===false){a.loadError=0;this.levelRetryCount=0}var n=t.details;if(n.live){var s=1e3*(n.averagetargetduration?n.averagetargetduration:n.targetduration),o=a.details;if(o&&n.endSN===o.endSN){s/=2;l["b"].log("same live playlist, reload twice faster")}s-=performance.now()-t.stats.trequest;s=Math.max(1e3,Math.round(s));l["b"].log("live playlist, reload in "+s+" ms");this.timer=setTimeout(function(){return r.loadLevel()},s)}else{this.cleanTimer()}}};t.prototype.loadLevel=function e(){var t=void 0,r=void 0;if(this.currentLevelIndex!==null&&this.canload===true){t=this._levels[this.currentLevelIndex];if(t!==undefined&&t.url.length>0){r=t.urlId;this.hls.trigger(s["a"].LEVEL_LOADING,{url:t.url[r],level:this.currentLevelIndex,id:r})}}};Te(t,[{key:"levels",get:function e(){return this._levels}},{key:"level",get:function e(){return this.currentLevelIndex},set:function e(t){var r=this._levels;if(r){t=Math.min(t,r.length-1);if(this.currentLevelIndex!==t||r[t].details===undefined){this.setLevelInternal(t)}}}},{key:"manualLevel",get:function e(){return this.manualLevelIndex},set:function e(t){this.manualLevelIndex=t;if(this._startLevel===undefined){this._startLevel=t}if(t!==-1){this.level=t}}},{key:"firstLevel",get:function e(){return this._firstLevel},set:function e(t){this._firstLevel=t}},{key:"startLevel",get:function e(){if(this._startLevel===undefined){var t=this.hls.config.startLevel;if(t!==undefined){return t}else{return this._firstLevel}}else{return this._startLevel}},set:function e(t){this._startLevel=t}},{key:"nextLoadLevel",get:function e(){if(this.manualLevelIndex!==-1){return this.manualLevelIndex}else{return this.hls.nextAutoLevel}},set:function e(t){this.level=t;if(this.manualLevelIndex===-1){this.hls.nextAutoLevel=t}}}]);return t}(c);var Le=Ae;var Ie=r(3);function De(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function ke(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function Oe(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var xe=function(e){Oe(t,e);function t(r){De(this,t);var i=ke(this,e.call(this,r,s["a"].MEDIA_ATTACHED,s["a"].MEDIA_DETACHING,s["a"].FRAG_PARSING_METADATA));i.id3Track=undefined;i.media=undefined;return i}t.prototype.destroy=function e(){c.prototype.destroy.call(this)};t.prototype.onMediaAttached=function e(t){this.media=t.media;if(!this.media){return}};t.prototype.onMediaDetaching=function e(){this.media=undefined};t.prototype.onFragParsingMetadata=function e(t){var r=t.frag;var i=t.samples;if(!this.id3Track){this.id3Track=this.media.addTextTrack("metadata","id3");this.id3Track.mode="hidden"}var a=window.WebKitDataCue||window.VTTCue||window.TextTrackCue;for(var n=0;n<i.length;n++){var s=Ie["a"].getID3Frames(i[n].data);if(s){var o=i[n].pts;var l=n<i.length-1?i[n+1].pts:r.endPTS;if(o===l){l+=1e-4}for(var u=0;u<s.length;u++){var f=s[u];if(!Ie["a"].isTimeStampFrame(f)){var d=new a(o,l,"");d.value=f;this.id3Track.addCue(d)}}}}};return t}(c);var Ce=xe;function Pe(){var e=Z();var t=window.SourceBuffer||window.WebKitSourceBuffer;var r=e&&typeof e.isTypeSupported==="function"&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');var i=!t||t.prototype&&typeof t.prototype.appendBuffer==="function"&&typeof t.prototype.remove==="function";return!!r&&!!i}function Fe(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var Ne=function(){function e(t){Fe(this,e);this.alpha_=t?Math.exp(Math.log(.5)/t):0;this.estimate_=0;this.totalWeight_=0}e.prototype.sample=function e(t,r){var i=Math.pow(this.alpha_,t);this.estimate_=r*(1-i)+i*this.estimate_;this.totalWeight_+=t};e.prototype.getTotalWeight=function e(){return this.totalWeight_};e.prototype.getEstimate=function e(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/t}else{return this.estimate_}};return e}();var Me=Ne;function Ue(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var Be=function(){function e(t,r,i,a){Ue(this,e);this.hls=t;this.defaultEstimate_=a;this.minWeight_=.001;this.minDelayMs_=50;this.slow_=new Me(r);this.fast_=new Me(i)}e.prototype.sample=function e(t,r){t=Math.max(t,this.minDelayMs_);var i=8e3*r/t,a=t/1e3;this.fast_.sample(a,i);this.slow_.sample(a,i)};e.prototype.canEstimate=function e(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_};e.prototype.getEstimate=function e(){if(this.canEstimate()){return Math.min(this.fast_.getEstimate(),this.slow_.getEstimate())}else{return this.defaultEstimate_}};e.prototype.destroy=function e(){};return e}();var Ge=Be;var He=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function je(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function $e(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function Ke(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var We=function(e){Ke(t,e);function t(r){je(this,t);var i=$e(this,e.call(this,r,s["a"].FRAG_LOADING,s["a"].FRAG_LOADED,s["a"].FRAG_BUFFERED,s["a"].ERROR));i.lastLoadedFragLevel=0;i._nextAutoLevel=-1;i.hls=r;i.timer=null;i._bwEstimator=null;i.onCheck=i._abandonRulesCheck.bind(i);return i}t.prototype.destroy=function e(){this.clearTimer();c.prototype.destroy.call(this)};t.prototype.onFragLoading=function e(t){var r=t.frag;if(r.type==="main"){if(!this.timer){this.timer=setInterval(this.onCheck,100)}if(!this._bwEstimator){var i=this.hls,a=t.frag.level,n=i.levels[a].details.live,s=i.config,o=void 0,l=void 0;if(n){o=s.abrEwmaFastLive;l=s.abrEwmaSlowLive}else{o=s.abrEwmaFastVoD;l=s.abrEwmaSlowVoD}this._bwEstimator=new Ge(i,l,o,s.abrEwmaDefaultEstimate)}this.fragCurrent=r}};t.prototype._abandonRulesCheck=function e(){var t=this.hls,r=t.media,i=this.fragCurrent,a=i.loader,n=t.minAutoLevel;if(!a||a.stats&&a.stats.aborted){l["b"].warn("frag loader destroy or aborted, disarm abandonRules");this.clearTimer();this._nextAutoLevel=-1;return}var o=a.stats;if(r&&o&&(!r.paused&&r.playbackRate!==0||!r.readyState)&&i.autoLevel&&i.level){var u=performance.now()-o.trequest,f=Math.abs(r.playbackRate);if(u>500*i.duration/f){var d=t.levels,c=Math.max(1,o.bw?o.bw/8:o.loaded*1e3/u),h=d[i.level],p=h.realBitrate?Math.max(h.realBitrate,h.bitrate):h.bitrate,v=o.total?o.total:Math.max(o.loaded,Math.round(i.duration*p/8)),g=r.currentTime,m=(v-o.loaded)/c,y=(q.bufferInfo(r,g,t.config.maxBufferHole).end-g)/f;if(y<2*i.duration/f&&m>y){var b=void 0,_=void 0;for(_=i.level-1;_>n;_--){var E=d[_].realBitrate?Math.max(d[_].realBitrate,d[_].bitrate):d[_].bitrate;b=i.duration*E/(8*.8*c);if(b<y){break}}if(b<m){l["b"].warn("loading too slow, abort fragment loading and switch to level "+_+":fragLoadedDelay["+_+"]<fragLoadedDelay["+(i.level-1)+"];bufferStarvationDelay:"+b.toFixed(1)+"<"+m.toFixed(1)+":"+y.toFixed(1));t.nextLoadLevel=_;this._bwEstimator.sample(u,o.loaded);a.abort();this.clearTimer();t.trigger(s["a"].FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,stats:o})}}}}};t.prototype.onFragLoaded=function e(t){var r=t.frag;if(r.type==="main"&&!isNaN(r.sn)){this.clearTimer();this.lastLoadedFragLevel=r.level;this._nextAutoLevel=-1;if(this.hls.config.abrMaxWithRealBitrate){var i=this.hls.levels[r.level];var a=(i.loaded?i.loaded.bytes:0)+t.stats.loaded;var n=(i.loaded?i.loaded.duration:0)+t.frag.duration;i.loaded={bytes:a,duration:n};i.realBitrate=Math.round(8*a/n)}if(t.frag.bitrateTest){var s=t.stats;s.tparsed=s.tbuffered=s.tload;this.onFragBuffered(t)}}};t.prototype.onFragBuffered=function e(t){var r=t.stats,i=t.frag;if(r.aborted!==true&&i.loadCounter===1&&i.type==="main"&&!isNaN(i.sn)&&(!i.bitrateTest||r.tload===r.tbuffered)){var a=r.tparsed-r.trequest;l["b"].log("latency/loading/parsing/append/kbps:"+Math.round(r.tfirst-r.trequest)+"/"+Math.round(r.tload-r.tfirst)+"/"+Math.round(r.tparsed-r.tload)+"/"+Math.round(r.tbuffered-r.tparsed)+"/"+Math.round(8*r.loaded/(r.tbuffered-r.trequest)));this._bwEstimator.sample(a,r.loaded);r.bwEstimate=this._bwEstimator.getEstimate();if(i.bitrateTest){this.bitrateTestDelay=a/1e3}else{this.bitrateTestDelay=0}}};t.prototype.onError=function e(t){switch(t.details){case o["a"].FRAG_LOAD_ERROR:case o["a"].FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}};t.prototype.clearTimer=function e(){clearInterval(this.timer);this.timer=null};t.prototype._findBestLevel=function e(t,r,i,a,n,s,o,u,f){for(var d=n;d>=a;d--){var c=f[d],h=c.details,p=h?h.totalduration/h.fragments.length:r,v=h?h.live:false,g=void 0;if(d<=t){g=o*i}else{g=u*i}var m=f[d].realBitrate?Math.max(f[d].realBitrate,f[d].bitrate):f[d].bitrate,y=m*p/g;l["b"].trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+d+"/"+Math.round(g)+"/"+m+"/"+p+"/"+s+"/"+y);if(g>m&&(!y||v&&!this.bitrateTestDelay||y<s)){return d}}return-1};He(t,[{key:"nextAutoLevel",get:function e(){var t=this._nextAutoLevel;var r=this._bwEstimator;if(t!==-1&&(!r||!r.canEstimate())){return t}var i=this._nextABRAutoLevel;if(t!==-1){i=Math.min(t,i)}return i},set:function e(t){this._nextAutoLevel=t}},{key:"_nextABRAutoLevel",get:function e(){var t=this.hls,r=t.maxAutoLevel,i=t.levels,a=t.config,n=t.minAutoLevel;var s=t.media,o=this.lastLoadedFragLevel,u=this.fragCurrent?this.fragCurrent.duration:0,f=s?s.currentTime:0,d=s&&s.playbackRate!==0?Math.abs(s.playbackRate):1,c=this._bwEstimator?this._bwEstimator.getEstimate():a.abrEwmaDefaultEstimate,h=(q.bufferInfo(s,f,a.maxBufferHole).end-f)/d;var p=this._findBestLevel(o,u,c,n,r,h,a.abrBandWidthFactor,a.abrBandWidthUpFactor,i);if(p>=0){return p}else{l["b"].trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var v=u?Math.min(u,a.maxStarvationDelay):a.maxStarvationDelay,g=a.abrBandWidthFactor,m=a.abrBandWidthUpFactor;if(h===0){var y=this.bitrateTestDelay;if(y){var b=u?Math.min(u,a.maxLoadingDelay):a.maxLoadingDelay;v=b-y;l["b"].trace("bitrate test took "+Math.round(1e3*y)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms");g=m=1}}p=this._findBestLevel(o,u,c,n,r,h+v,g,m,i);return Math.max(p,0)}}}]);return t}(c);var Ve=We;function qe(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function Ye(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function ze(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var Xe=Z();var Qe=function(e){ze(t,e);function t(r){qe(this,t);var i=Ye(this,e.call(this,r,s["a"].MEDIA_ATTACHING,s["a"].MEDIA_DETACHING,s["a"].MANIFEST_PARSED,s["a"].BUFFER_RESET,s["a"].BUFFER_APPENDING,s["a"].BUFFER_CODECS,s["a"].BUFFER_EOS,s["a"].BUFFER_FLUSHING,s["a"].LEVEL_PTS_UPDATED,s["a"].LEVEL_UPDATED));i._msDuration=null;i._levelDuration=null;i._live=null;i._objectUrl=null;i.onsbue=i.onSBUpdateEnd.bind(i);i.onsbe=i.onSBUpdateError.bind(i);i.pendingTracks={};i.tracks={};return i}t.prototype.destroy=function e(){c.prototype.destroy.call(this)};t.prototype.onLevelPtsUpdated=function e(t){var r=t.type;var i=this.tracks.audio;if(r==="audio"&&i&&i.container==="audio/mpeg"){var a=this.sourceBuffer.audio;var n=Math.abs(a.timestampOffset-t.start);if(n>.1){var s=a.updating;try{a.abort()}catch(e){s=true;l["b"].warn("can not abort audio buffer: "+e)}if(!s){l["b"].warn("change mpeg audio timestamp offset from "+a.timestampOffset+" to "+t.start);a.timestampOffset=t.start}else{this.audioTimestampOffset=t.start}}}};t.prototype.onManifestParsed=function e(t){var r=t.audio,i=t.video||t.levels.length&&t.audio,a=0;if(t.altAudio&&(r||i)){a=(r?1:0)+(i?1:0);l["b"].log(a+" sourceBuffer(s) expected")}this.sourceBufferNb=a};t.prototype.onMediaAttaching=function e(t){var r=this.media=t.media;if(r){var i=this.mediaSource=new Xe;this.onmso=this.onMediaSourceOpen.bind(this);this.onmse=this.onMediaSourceEnded.bind(this);this.onmsc=this.onMediaSourceClose.bind(this);i.addEventListener("sourceopen",this.onmso);i.addEventListener("sourceended",this.onmse);i.addEventListener("sourceclose",this.onmsc);r.src=URL.createObjectURL(i);this._objectUrl=r.src}};t.prototype.onMediaDetaching=function e(){l["b"].log("media source detaching");var t=this.mediaSource;if(t){if(t.readyState==="open"){try{t.endOfStream()}catch(e){l["b"].warn("onMediaDetaching:"+e.message+" while calling endOfStream")}}t.removeEventListener("sourceopen",this.onmso);t.removeEventListener("sourceended",this.onmse);t.removeEventListener("sourceclose",this.onmsc);if(this.media){URL.revokeObjectURL(this._objectUrl);if(this.media.src===this._objectUrl){this.media.removeAttribute("src");this.media.load()}else{l["b"].warn("media.src was changed by a third party - skip cleanup")}}this.mediaSource=null;this.media=null;this._objectUrl=null;this.pendingTracks={};this.tracks={};this.sourceBuffer={};this.flushRange=[];this.segments=[];this.appended=0}this.onmso=this.onmse=this.onmsc=null;this.hls.trigger(s["a"].MEDIA_DETACHED)};t.prototype.onMediaSourceOpen=function e(){l["b"].log("media source opened");this.hls.trigger(s["a"].MEDIA_ATTACHED,{media:this.media});var t=this.mediaSource;if(t){t.removeEventListener("sourceopen",this.onmso)}this.checkPendingTracks()};t.prototype.checkPendingTracks=function e(){var t=this.pendingTracks,r=Object.keys(t).length;if(r&&(this.sourceBufferNb<=r||this.sourceBufferNb===0)){this.createSourceBuffers(t);this.pendingTracks={};this.doAppending()}};t.prototype.onMediaSourceClose=function e(){l["b"].log("media source closed")};t.prototype.onMediaSourceEnded=function e(){l["b"].log("media source ended")};t.prototype.onSBUpdateEnd=function e(){if(this.audioTimestampOffset){var t=this.sourceBuffer.audio;l["b"].warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+this.audioTimestampOffset);t.timestampOffset=this.audioTimestampOffset;delete this.audioTimestampOffset}if(this._needsFlush){this.doFlush()}if(this._needsEos){this.checkEos()}this.appending=false;var r=this.parent;var i=this.segments.reduce(function(e,t){return t.parent===r?e+1:e},0);this.hls.trigger(s["a"].BUFFER_APPENDED,{parent:r,pending:i});if(!this._needsFlush){this.doAppending()}this.updateMediaElementDuration()};t.prototype.onSBUpdateError=function e(t){l["b"].error("sourceBuffer error:",t);this.hls.trigger(s["a"].ERROR,{type:o["b"].MEDIA_ERROR,details:o["a"].BUFFER_APPENDING_ERROR,fatal:false})};t.prototype.onBufferReset=function e(){var t=this.sourceBuffer;for(var r in t){var i=t[r];try{this.mediaSource.removeSourceBuffer(i);i.removeEventListener("updateend",this.onsbue);i.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={};this.flushRange=[];this.segments=[];this.appended=0};t.prototype.onBufferCodecs=function e(t){if(Object.keys(this.sourceBuffer).length===0){for(var r in t){this.pendingTracks[r]=t[r]}var i=this.mediaSource;if(i&&i.readyState==="open"){this.checkPendingTracks()}}};t.prototype.createSourceBuffers=function e(t){var r=this.sourceBuffer,i=this.mediaSource;for(var a in t){if(!r[a]){var n=t[a];var u=n.levelCodec||n.codec;var f=n.container+";codecs="+u;l["b"].log("creating sourceBuffer("+f+")");try{var d=r[a]=i.addSourceBuffer(f);d.addEventListener("updateend",this.onsbue);d.addEventListener("error",this.onsbe);this.tracks[a]={codec:u,container:n.container};n.buffer=d}catch(e){l["b"].error("error while trying to add sourceBuffer:"+e.message);this.hls.trigger(s["a"].ERROR,{type:o["b"].MEDIA_ERROR,details:o["a"].BUFFER_ADD_CODEC_ERROR,fatal:false,err:e,mimeType:f})}}}this.hls.trigger(s["a"].BUFFER_CREATED,{tracks:t})};t.prototype.onBufferAppending=function e(t){if(!this._needsFlush){if(!this.segments){this.segments=[t]}else{this.segments.push(t)}this.doAppending()}};t.prototype.onBufferAppendFail=function e(t){l["b"].error("sourceBuffer error:",t.event);this.hls.trigger(s["a"].ERROR,{type:o["b"].MEDIA_ERROR,details:o["a"].BUFFER_APPENDING_ERROR,fatal:false})};t.prototype.onBufferEos=function e(t){var r=this.sourceBuffer;var i=t.type;for(var a in r){if(!i||a===i){if(!r[a].ended){r[a].ended=true;l["b"].log(a+" sourceBuffer now EOS")}}}this.checkEos()};t.prototype.checkEos=function e(){var t=this.sourceBuffer,r=this.mediaSource;if(!r||r.readyState!=="open"){this._needsEos=false;return}for(var i in t){var a=t[i];if(!a.ended){return}if(a.updating){this._needsEos=true;return}}l["b"].log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{r.endOfStream()}catch(e){l["b"].warn("exception while calling mediaSource.endOfStream()")}this._needsEos=false};t.prototype.onBufferFlushing=function e(t){this.flushRange.push({start:t.startOffset,end:t.endOffset,type:t.type});this.flushBufferCounter=0;this.doFlush()};t.prototype.onLevelUpdated=function e(t){var r=t.details;if(r.fragments.length>0){this._levelDuration=r.totalduration+r.fragments[0].start;this._live=r.live;this.updateMediaElementDuration()}};t.prototype.updateMediaElementDuration=function e(){var t=this.hls.config;var r=void 0;if(this._levelDuration===null||!this.media||!this.mediaSource||!this.sourceBuffer||this.media.readyState===0||this.mediaSource.readyState!=="open"){return}for(var i in this.sourceBuffer){if(this.sourceBuffer[i].updating===true){return}}r=this.media.duration;if(this._msDuration===null){this._msDuration=this.mediaSource.duration}if(this._live===true&&t.liveDurationInfinity===true){l["b"].log("Media Source duration is set to Infinity");this._msDuration=this.mediaSource.duration=Infinity}else if(this._levelDuration>this._msDuration&&this._levelDuration>r||r===Infinity||isNaN(r)){l["b"].log("Updating Media Source duration to "+this._levelDuration.toFixed(3));this._msDuration=this.mediaSource.duration=this._levelDuration}};t.prototype.doFlush=function e(){while(this.flushRange.length){var t=this.flushRange[0];if(this.flushBuffer(t.start,t.end,t.type)){this.flushRange.shift();this.flushBufferCounter=0}else{this._needsFlush=true;return}}if(this.flushRange.length===0){this._needsFlush=false;var r=0;var i=this.sourceBuffer;try{for(var a in i){r+=i[a].buffered.length}}catch(e){l["b"].error("error while accessing sourceBuffer.buffered")}this.appended=r;this.hls.trigger(s["a"].BUFFER_FLUSHED)}};t.prototype.doAppending=function e(){var t=this.hls,r=this.sourceBuffer,i=this.segments;if(Object.keys(r).length){if(this.media.error){this.segments=[];l["b"].error("trying to append although a media error occured, flush segment and abort");return}if(this.appending){return}if(i&&i.length){var a=i.shift();try{var n=a.type,u=r[n];if(u){if(!u.updating){u.ended=false;this.parent=a.parent;u.appendBuffer(a.data);this.appendError=0;this.appended++;this.appending=true}else{i.unshift(a)}}else{this.onSBUpdateEnd()}}catch(e){l["b"].error("error while trying to append buffer:"+e.message);i.unshift(a);var f={type:o["b"].MEDIA_ERROR,parent:a.parent};if(e.code!==22){if(this.appendError){this.appendError++}else{this.appendError=1}f.details=o["a"].BUFFER_APPEND_ERROR;if(this.appendError>t.config.appendErrorMaxRetry){l["b"].log("fail "+t.config.appendErrorMaxRetry+" times to append segment in sourceBuffer");i=[];f.fatal=true;t.trigger(s["a"].ERROR,f);return}else{f.fatal=false;t.trigger(s["a"].ERROR,f)}}else{this.segments=[];f.details=o["a"].BUFFER_FULL_ERROR;f.fatal=false;t.trigger(s["a"].ERROR,f);return}}}}};t.prototype.flushBuffer=function e(t,r,i){var a,n,s,o,u,f,d=this.sourceBuffer;if(Object.keys(d).length){l["b"].log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+t+"/"+r);if(this.flushBufferCounter<this.appended){for(var c in d){if(i&&c!==i){continue}a=d[c];a.ended=false;if(!a.updating){try{for(n=0;n<a.buffered.length;n++){s=a.buffered.start(n);o=a.buffered.end(n);if(navigator.userAgent.toLowerCase().indexOf("firefox")!==-1&&r===Number.POSITIVE_INFINITY){u=t;f=r}else{u=Math.max(s,t);f=Math.min(o,r)}if(Math.min(f,o)-u>.5){this.flushBufferCounter++;l["b"].log("flush "+c+" ["+u+","+f+"], of ["+s+","+o+"], pos:"+this.media.currentTime);a.remove(u,f);return false}}}catch(e){l["b"].warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}else{l["b"].warn("cannot flush, sb updating in progress");return false}}}else{l["b"].warn("abort flushing too many retries")}l["b"].log("buffer flushed")}return true};return t}(c);var Je=Qe;var Ze=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function et(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function tt(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function rt(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var it=function(e){rt(t,e);function t(r){et(this,t);return tt(this,e.call(this,r,s["a"].FPS_DROP_LEVEL_CAPPING,s["a"].MEDIA_ATTACHING,s["a"].MANIFEST_PARSED))}t.prototype.destroy=function e(){if(this.hls.config.capLevelToPlayerSize){this.media=this.restrictedLevels=null;this.autoLevelCapping=Number.POSITIVE_INFINITY;if(this.timer){this.timer=clearInterval(this.timer)}}};t.prototype.onFpsDropLevelCapping=function e(r){if(t.isLevelAllowed(r.droppedLevel,this.restrictedLevels)){this.restrictedLevels.push(r.droppedLevel)}};t.prototype.onMediaAttaching=function e(t){this.media=t.media instanceof HTMLVideoElement?t.media:null};t.prototype.onManifestParsed=function e(t){var r=this.hls;this.restrictedLevels=[];if(r.config.capLevelToPlayerSize){this.autoLevelCapping=Number.POSITIVE_INFINITY;this.levels=t.levels;r.firstLevel=this.getMaxLevel(t.firstLevel);clearInterval(this.timer);this.timer=setInterval(this.detectPlayerSize.bind(this),1e3);this.detectPlayerSize()}};t.prototype.detectPlayerSize=function e(){if(this.media){var t=this.levels?this.levels.length:0;if(t){var r=this.hls;r.autoLevelCapping=this.getMaxLevel(t-1);if(r.autoLevelCapping>this.autoLevelCapping){r.streamController.nextLevelSwitch()}this.autoLevelCapping=r.autoLevelCapping}}};t.prototype.getMaxLevel=function e(r){var i=this;if(!this.levels){return-1}var a=this.levels.filter(function(e,a){return t.isLevelAllowed(a,i.restrictedLevels)&&a<=r});return t.getMaxLevelByMediaSize(a,this.mediaWidth,this.mediaHeight)};t.isLevelAllowed=function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return r.indexOf(t)===-1};t.getMaxLevelByMediaSize=function e(t,r,i){if(!t||t&&!t.length){return-1}var a=function e(t,r){if(!r){return true}return t.width!==r.width||t.height!==r.height};var n=t.length-1;for(var s=0;s<t.length;s+=1){var o=t[s];if((o.width>=r||o.height>=i)&&a(o,t[s+1])){n=s;break}}return n};Ze(t,[{key:"mediaWidth",get:function e(){var r=void 0;var i=this.media;if(i){r=i.width||i.clientWidth||i.offsetWidth;r*=t.contentScaleFactor}return r}},{key:"mediaHeight",get:function e(){var r=void 0;var i=this.media;if(i){r=i.height||i.clientHeight||i.offsetHeight;r*=t.contentScaleFactor}return r}}],[{key:"contentScaleFactor",get:function e(){var t=1;try{t=window.devicePixelRatio}catch(e){}return t}}]);return t}(c);var at=it;function nt(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function st(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function ot(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var lt=function(e){ot(t,e);function t(r){nt(this,t);return st(this,e.call(this,r,s["a"].MEDIA_ATTACHING))}t.prototype.destroy=function e(){if(this.timer){clearInterval(this.timer)}this.isVideoPlaybackQualityAvailable=false};t.prototype.onMediaAttaching=function e(t){var r=this.hls.config;if(r.capLevelOnFPSDrop){var i=this.video=t.media instanceof HTMLVideoElement?t.media:null;if(typeof i.getVideoPlaybackQuality==="function"){this.isVideoPlaybackQualityAvailable=true}clearInterval(this.timer);this.timer=setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}};t.prototype.checkFPS=function e(t,r,i){var a=performance.now();if(r){if(this.lastTime){var n=a-this.lastTime,o=i-this.lastDroppedFrames,u=r-this.lastDecodedFrames,f=1e3*o/n,d=this.hls;d.trigger(s["a"].FPS_DROP,{currentDropped:o,currentDecoded:u,totalDroppedFrames:i});if(f>0){if(o>d.config.fpsDroppedMonitoringThreshold*u){var c=d.currentLevel;l["b"].warn("drop FPS ratio greater than max allowed value for currentLevel: "+c);if(c>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=c)){c=c-1;d.trigger(s["a"].FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:d.currentLevel});d.autoLevelCapping=c;d.streamController.nextLevelSwitch()}}}}this.lastTime=a;this.lastDroppedFrames=i;this.lastDecodedFrames=r}};t.prototype.checkFPSInterval=function e(){var t=this.video;if(t){if(this.isVideoPlaybackQualityAvailable){var r=t.getVideoPlaybackQuality();this.checkFPS(t,r.totalVideoFrames,r.droppedVideoFrames)}else{this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)}}};return t}(c);var ut=lt;function ft(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var dt=function(){function e(t){ft(this,e);if(t&&t.xhrSetup){this.xhrSetup=t.xhrSetup}}e.prototype.destroy=function e(){this.abort();this.loader=null};e.prototype.abort=function e(){var t=this.loader;if(t&&t.readyState!==4){this.stats.aborted=true;t.abort()}window.clearTimeout(this.requestTimeout);this.requestTimeout=null;window.clearTimeout(this.retryTimeout);this.retryTimeout=null};e.prototype.load=function e(t,r,i){this.context=t;this.config=r;this.callbacks=i;this.stats={trequest:performance.now(),retry:0};this.retryDelay=r.retryDelay;this.loadInternal()};e.prototype.loadInternal=function e(){var t,r=this.context;t=this.loader=new XMLHttpRequest;var i=this.stats;i.tfirst=0;i.loaded=0;var a=this.xhrSetup;try{if(a){try{a(t,r.url)}catch(e){t.open("GET",r.url,true);a(t,r.url)}}if(!t.readyState){t.open("GET",r.url,true)}}catch(e){this.callbacks.onError({code:t.status,text:e.message},r,t);return}if(r.rangeEnd){t.setRequestHeader("Range","bytes="+r.rangeStart+"-"+(r.rangeEnd-1))}t.onreadystatechange=this.readystatechange.bind(this);t.onprogress=this.loadprogress.bind(this);t.responseType=r.responseType;this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout);t.send()};e.prototype.readystatechange=function e(t){var r=t.currentTarget,i=r.readyState,a=this.stats,n=this.context,s=this.config;if(a.aborted){return}if(i>=2){window.clearTimeout(this.requestTimeout);if(a.tfirst===0){a.tfirst=Math.max(performance.now(),a.trequest)}if(i===4){var o=r.status;if(o>=200&&o<300){a.tload=Math.max(a.tfirst,performance.now());var u=void 0,f=void 0;if(n.responseType==="arraybuffer"){u=r.response;f=u.byteLength}else{u=r.responseText;f=u.length}a.loaded=a.total=f;var d={url:r.responseURL,data:u};this.callbacks.onSuccess(d,a,n,r)}else{if(a.retry>=s.maxRetry||o>=400&&o<499){l["b"].error(o+" while loading "+n.url);this.callbacks.onError({code:o,text:r.statusText},n,r)}else{l["b"].warn(o+" while loading "+n.url+", retrying in "+this.retryDelay+"...");this.destroy();this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay);this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay);a.retry++}}}else{this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),s.timeout)}}};e.prototype.loadtimeout=function e(){l["b"].warn("timeout while loading "+this.context.url);this.callbacks.onTimeout(this.stats,this.context,null)};e.prototype.loadprogress=function e(t){var r=t.currentTarget,i=this.stats;i.loaded=t.loaded;if(t.lengthComputable){i.total=t.total}var a=this.callbacks.onProgress;if(a){a(i,this.context,null,r)}};return e}();var ct=dt;var ht=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function pt(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function vt(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function gt(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var mt=function(e){gt(t,e);function t(r){pt(this,t);var i=vt(this,e.call(this,r,s["a"].MANIFEST_LOADING,s["a"].MANIFEST_PARSED,s["a"].AUDIO_TRACK_LOADED,s["a"].ERROR));i.ticks=0;i.ontick=i.tick.bind(i);return i}t.prototype.destroy=function e(){this.cleanTimer();c.prototype.destroy.call(this)};t.prototype.cleanTimer=function e(){if(this.timer){clearTimeout(this.timer);this.timer=null}};t.prototype.tick=function e(){this.ticks++;if(this.ticks===1){this.doTick();if(this.ticks>1){setTimeout(this.tick,1)}this.ticks=0}};t.prototype.doTick=function e(){this.updateTrack(this.trackId)};t.prototype.onError=function e(t){if(t.fatal&&t.type===o["b"].NETWORK_ERROR){this.cleanTimer()}};t.prototype.onManifestLoading=function e(){this.tracks=[];this.trackId=-1};t.prototype.onManifestParsed=function e(t){var r=this;var i=t.audioTracks||[];var a=false;this.tracks=i;this.hls.trigger(s["a"].AUDIO_TRACKS_UPDATED,{audioTracks:i});var n=0;i.forEach(function(e){if(e.default&&!a){r.audioTrack=n;a=true;return}n++});if(a===false&&i.length){l["b"].log("no default audio track defined, use first audio track as default");this.audioTrack=0}};t.prototype.onAudioTrackLoaded=function e(t){if(t.id<this.tracks.length){l["b"].log("audioTrack "+t.id+" loaded");this.tracks[t.id].details=t.details;if(t.details.live&&!this.timer){this.timer=setInterval(this.ontick,1e3*t.details.targetduration)}if(!t.details.live&&this.timer){this.cleanTimer()}}};t.prototype.setAudioTrackInternal=function e(t){if(t>=0&&t<this.tracks.length){this.cleanTimer();this.trackId=t;l["b"].log("switching to audioTrack "+t);var r=this.tracks[t],i=this.hls,a=r.type,n=r.url,o={id:t,type:a,url:n};i.trigger(s["a"].AUDIO_TRACK_SWITCH,o);i.trigger(s["a"].AUDIO_TRACK_SWITCHING,o);var u=r.details;if(n&&(u===undefined||u.live===true)){l["b"].log("(re)loading playlist for audioTrack "+t);i.trigger(s["a"].AUDIO_TRACK_LOADING,{url:n,id:t})}}};t.prototype.updateTrack=function e(t){if(t>=0&&t<this.tracks.length){this.cleanTimer();this.trackId=t;l["b"].log("updating audioTrack "+t);var r=this.tracks[t],i=r.url;var a=r.details;if(i&&(a===undefined||a.live===true)){l["b"].log("(re)loading playlist for audioTrack "+t);this.hls.trigger(s["a"].AUDIO_TRACK_LOADING,{url:i,id:t})}}};ht(t,[{key:"audioTracks",get:function e(){return this.tracks}},{key:"audioTrack",get:function e(){return this.trackId},set:function e(t){if(this.trackId!==t||this.tracks[t].details===undefined){this.setAudioTrackInternal(t)}}}]);return t}(c);var yt=mt;var bt=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function _t(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function Et(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function Tt(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var St={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"};var wt=function(e){Tt(t,e);function t(r){_t(this,t);var i=Et(this,e.call(this,r,s["a"].MEDIA_ATTACHED,s["a"].MEDIA_DETACHING,s["a"].AUDIO_TRACKS_UPDATED,s["a"].AUDIO_TRACK_SWITCHING,s["a"].AUDIO_TRACK_LOADED,s["a"].KEY_LOADED,s["a"].FRAG_LOADED,s["a"].FRAG_PARSING_INIT_SEGMENT,s["a"].FRAG_PARSING_DATA,s["a"].FRAG_PARSED,s["a"].ERROR,s["a"].BUFFER_RESET,s["a"].BUFFER_CREATED,s["a"].BUFFER_APPENDED,s["a"].BUFFER_FLUSHED,s["a"].INIT_PTS_FOUND));i.config=r.config;i.audioCodecSwap=false;i.ticks=0;i._state=St.STOPPED;i.ontick=i.tick.bind(i);i.initPTS=[];i.waitingFragment=null;i.videoTrackCC=null;return i}t.prototype.destroy=function e(){this.stopLoad();if(this.timer){clearInterval(this.timer);this.timer=null}c.prototype.destroy.call(this);this.state=St.STOPPED};t.prototype.onInitPtsFound=function e(t){var r=t.id,i=t.frag.cc,a=t.initPTS;if(r==="main"){this.initPTS[i]=a;this.videoTrackCC=i;l["b"].log("InitPTS for cc:"+i+" found from video track:"+a);if(this.state===St.WAITING_INIT_PTS){this.tick()}}};t.prototype.startLoad=function e(t){if(this.tracks){var r=this.lastCurrentTime;this.stopLoad();if(!this.timer){this.timer=setInterval(this.ontick,100)}this.fragLoadError=0;if(r>0&&t===-1){l["b"].log("audio:override startPosition with lastCurrentTime @"+r.toFixed(3));this.state=St.IDLE}else{this.lastCurrentTime=this.startPosition?this.startPosition:t;this.state=St.STARTING}this.nextLoadPosition=this.startPosition=this.lastCurrentTime;this.tick()}else{this.startPosition=t;this.state=St.STOPPED}};t.prototype.stopLoad=function e(){var t=this.fragCurrent;if(t){if(t.loader){t.loader.abort()}this.fragCurrent=null}this.fragPrevious=null;if(this.demuxer){this.demuxer.destroy();this.demuxer=null}this.state=St.STOPPED};t.prototype.tick=function e(){this.ticks++;if(this.ticks===1){this.doTick();if(this.ticks>1){setTimeout(this.tick,1)}this.ticks=0}};t.prototype.doTick=function e(){var t,r,i,a=this.hls,n=a.config;switch(this.state){case St.ERROR:case St.PAUSED:case St.BUFFER_FLUSHING:break;case St.STARTING:this.state=St.WAITING_TRACK;this.loadedmetadata=false;break;case St.IDLE:var u=this.tracks;if(!u){break}if(!this.media&&(this.startFragRequested||!n.startFragPrefetch)){break}if(this.loadedmetadata){t=this.media.currentTime}else{t=this.nextLoadPosition;if(t===undefined){break}}var f=this.mediaBuffer?this.mediaBuffer:this.media,d=this.videoBuffer?this.videoBuffer:this.media,c=q.bufferInfo(f,t,n.maxBufferHole),h=q.bufferInfo(d,t,n.maxBufferHole),p=c.len,v=c.end,g=this.fragPrevious,m=Math.max(n.maxBufferLength,h.len),y=this.audioSwitch,b=this.trackId;if((p<m||y)&&b<u.length){i=u[b].details;if(typeof i==="undefined"){this.state=St.WAITING_TRACK;break}if(!y&&!i.live&&g&&g.sn===i.endSN&&!c.nextStart){if(!this.media.seeking||this.media.duration-v<g.duration/2){this.hls.trigger(s["a"].BUFFER_EOS,{type:"audio"});this.state=St.ENDED;break}}var _=i.fragments,E=_.length,T=_[0].start,S=_[E-1].start+_[E-1].duration,w=void 0;if(y){if(i.live&&!i.PTSKnown){l["b"].log("switching audiotrack, live stream, unknown PTS,load first fragment");v=0}else{v=t;if(i.PTSKnown&&t<T){if(c.end>T||c.nextStart){l["b"].log("alt audio track ahead of main track, seek to start of alt audio track");this.media.currentTime=T+.05}else{return}}}}if(i.initSegment&&!i.initSegment.data){w=i.initSegment}else if(v<=T){w=_[0];if(this.videoTrackCC!==null&&w.cc!==this.videoTrackCC){w=fe(_,this.videoTrackCC)}if(i.live&&w.loadIdx&&w.loadIdx===this.fragLoadIdx){var R=c.nextStart?c.nextStart:T;l["b"].log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(R+.05));this.media.currentTime=R+.05;return}}else{var A=void 0;var L=n.maxFragLookUpTolerance;var I=g?_[g.sn-_[0].sn+1]:undefined;var D=function e(t){var r=Math.min(L,t.duration);if(t.start+t.duration-r<=v){return 1}else if(t.start-r>v&&t.start){return-1}return 0};if(v<S){if(v>S-L){L=0}if(I&&!D(I)){A=I}else{A=W.search(_,D)}}else{A=_[E-1]}if(A){w=A;T=A.start;if(g&&w.level===g.level&&w.sn===g.sn){if(w.sn<i.endSN){w=_[w.sn+1-i.startSN];l["b"].log("SN just loaded, load next one: "+w.sn)}else{w=null}}}}if(w){if(w.decryptdata&&w.decryptdata.uri!=null&&w.decryptdata.key==null){l["b"].log("Loading key for "+w.sn+" of ["+i.startSN+" ,"+i.endSN+"],track "+b);this.state=St.KEY_LOADING;a.trigger(s["a"].KEY_LOADING,{frag:w})}else{l["b"].log("Loading "+w.sn+", cc: "+w.cc+" of ["+i.startSN+" ,"+i.endSN+"],track "+b+", currentTime:"+t+",bufferEnd:"+v.toFixed(3));if(this.fragLoadIdx!==undefined){this.fragLoadIdx++}else{this.fragLoadIdx=0}if(w.loadCounter){w.loadCounter++;var k=n.fragLoadingLoopThreshold;if(w.loadCounter>k&&Math.abs(this.fragLoadIdx-w.loadIdx)<k){a.trigger(s["a"].ERROR,{type:o["b"].MEDIA_ERROR,details:o["a"].FRAG_LOOP_LOADING_ERROR,fatal:false,frag:w});return}}else{w.loadCounter=1}w.loadIdx=this.fragLoadIdx;this.fragCurrent=w;this.startFragRequested=true;if(!isNaN(w.sn)){this.nextLoadPosition=w.start+w.duration}a.trigger(s["a"].FRAG_LOADING,{frag:w});this.state=St.FRAG_LOADING}}}break;case St.WAITING_TRACK:r=this.tracks[this.trackId];if(r&&r.details){this.state=St.IDLE}break;case St.FRAG_LOADING_WAITING_RETRY:var O=performance.now();var x=this.retryDate;f=this.media;var C=f&&f.seeking;if(!x||O>=x||C){l["b"].log("audioStreamController: retryDate reached, switch back to IDLE state");this.state=St.IDLE}break;case St.WAITING_INIT_PTS:var P=this.videoTrackCC;if(this.initPTS[P]===undefined){break}var F=this.waitingFragment;if(F){var N=F.frag.cc;if(P!==N){r=this.tracks[this.trackId];if(r.details&&r.details.live){l["b"].warn("Waiting fragment CC ("+N+") does not match video track CC ("+P+")");this.waitingFragment=null;this.state=St.IDLE}}else{this.state=St.FRAG_LOADING;this.onFragLoaded(this.waitingFragment);this.waitingFragment=null}}else{this.state=St.IDLE}break;case St.STOPPED:case St.FRAG_LOADING:case St.PARSING:case St.PARSED:case St.ENDED:break;default:break}};t.prototype.onMediaAttached=function e(t){var r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this);this.onvended=this.onMediaEnded.bind(this);r.addEventListener("seeking",this.onvseeking);r.addEventListener("ended",this.onvended);var i=this.config;if(this.tracks&&i.autoStartLoad){this.startLoad(i.startPosition)}};t.prototype.onMediaDetaching=function e(){var t=this.media;if(t&&t.ended){l["b"].log("MSE detaching and video ended, reset startPosition");this.startPosition=this.lastCurrentTime=0}var r=this.tracks;if(r){r.forEach(function(e){if(e.details){e.details.fragments.forEach(function(e){e.loadCounter=undefined})}})}if(t){t.removeEventListener("seeking",this.onvseeking);t.removeEventListener("ended",this.onvended);this.onvseeking=this.onvseeked=this.onvended=null}this.media=this.mediaBuffer=this.videoBuffer=null;this.loadedmetadata=false;this.stopLoad()};t.prototype.onMediaSeeking=function e(){if(this.state===St.ENDED){this.state=St.IDLE}if(this.media){this.lastCurrentTime=this.media.currentTime}if(this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold}this.tick()};t.prototype.onMediaEnded=function e(){this.startPosition=this.lastCurrentTime=0};t.prototype.onAudioTracksUpdated=function e(t){l["b"].log("audio tracks updated");this.tracks=t.audioTracks};t.prototype.onAudioTrackSwitching=function e(t){var r=!!t.url;this.trackId=t.id;this.fragCurrent=null;this.state=St.PAUSED;this.waitingFragment=null;if(!r){if(this.demuxer){this.demuxer.destroy();this.demuxer=null}}else{if(!this.timer){this.timer=setInterval(this.ontick,100)}}if(r){this.audioSwitch=true;this.state=St.IDLE;if(this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold}}this.tick()};t.prototype.onAudioTrackLoaded=function e(t){var r=t.details,i=t.id,a=this.tracks[i],n=r.totalduration,s=0;l["b"].log("track "+i+" loaded ["+r.startSN+","+r.endSN+"],duration:"+n);if(r.live){var o=a.details;if(o&&r.fragments.length>0){se(o,r);s=r.fragments[0].start;if(r.PTSKnown){l["b"].log("live audio playlist sliding:"+s.toFixed(3))}else{l["b"].log("live audio playlist - outdated PTS, unknown sliding")}}else{r.PTSKnown=false;l["b"].log("live audio playlist - first load, unknown sliding")}}else{r.PTSKnown=false}a.details=r;if(!this.startFragRequested){if(this.startPosition===-1){var u=r.startTimeOffset;if(!isNaN(u)){l["b"].log("start time offset found in playlist, adjust startPosition to "+u);this.startPosition=u}else{this.startPosition=0}}this.nextLoadPosition=this.startPosition}if(this.state===St.WAITING_TRACK){this.state=St.IDLE}this.tick()};t.prototype.onKeyLoaded=function e(){if(this.state===St.KEY_LOADING){this.state=St.IDLE;this.tick()}};t.prototype.onFragLoaded=function e(t){var r=this.fragCurrent,i=t.frag;if(this.state===St.FRAG_LOADING&&r&&i.type==="audio"&&i.level===r.level&&i.sn===r.sn){var a=this.tracks[this.trackId],n=a.details,o=n.totalduration,u=r.level,f=r.sn,d=r.cc,c=this.config.defaultAudioCodec||a.audioCodec||"mp4a.40.2",h=this.stats=t.stats;if(f==="initSegment"){this.state=St.IDLE;h.tparsed=h.tbuffered=performance.now();n.initSegment.data=t.payload;this.hls.trigger(s["a"].FRAG_BUFFERED,{stats:h,frag:r,id:"audio"});this.tick()}else{this.state=St.PARSING;this.appended=false;if(!this.demuxer){this.demuxer=new ie(this.hls,"audio")}var p=this.initPTS[d];var v=n.initSegment?n.initSegment.data:[];if(n.initSegment||p!==undefined){this.pendingBuffering=true;l["b"].log("Demuxing "+f+" of ["+n.startSN+" ,"+n.endSN+"],track "+u);var g=false;this.demuxer.push(t.payload,v,c,null,r,o,g,p)}else{l["b"].log("unknown video PTS for continuity counter "+d+", waiting for video PTS before demuxing audio frag "+f+" of ["+n.startSN+" ,"+n.endSN+"],track "+u);this.waitingFragment=t;this.state=St.WAITING_INIT_PTS}}}this.fragLoadError=0};t.prototype.onFragParsingInitSegment=function e(t){var r=this.fragCurrent;var i=t.frag;if(r&&t.id==="audio"&&i.sn===r.sn&&i.level===r.level&&this.state===St.PARSING){var a=t.tracks,n=void 0;if(a.video){delete a.video}n=a.audio;if(n){n.levelCodec=n.codec;n.id=t.id;this.hls.trigger(s["a"].BUFFER_CODECS,a);l["b"].log("audio track:audio,container:"+n.container+",codecs[level/parsed]=["+n.levelCodec+"/"+n.codec+"]");var o=n.initSegment;if(o){var u={type:"audio",data:o,parent:"audio",content:"initSegment"};if(this.audioSwitch){this.pendingData=[u]}else{this.appended=true;this.pendingBuffering=true;this.hls.trigger(s["a"].BUFFER_APPENDING,u)}}this.tick()}}};t.prototype.onFragParsingData=function e(t){var r=this;var i=this.fragCurrent;var a=t.frag;if(i&&t.id==="audio"&&t.type==="audio"&&a.sn===i.sn&&a.level===i.level&&this.state===St.PARSING){var n=this.trackId,o=this.tracks[n],u=this.hls;if(isNaN(t.endPTS)){t.endPTS=t.startPTS+i.duration;t.endDTS=t.startDTS+i.duration}l["b"].log("parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb);ne(o.details,i,t.startPTS,t.endPTS);var f=this.audioSwitch,d=this.media,c=false;if(f&&d){if(d.readyState){var h=d.currentTime;l["b"].log("switching audio track : currentTime:"+h);if(h>=t.startPTS){l["b"].log("switching audio track : flushing all audio");this.state=St.BUFFER_FLUSHING;u.trigger(s["a"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"});c=true;this.audioSwitch=false;u.trigger(s["a"].AUDIO_TRACK_SWITCHED,{id:n})}}else{this.audioSwitch=false;u.trigger(s["a"].AUDIO_TRACK_SWITCHED,{id:n})}}var p=this.pendingData;if(!this.audioSwitch){[t.data1,t.data2].forEach(function(e){if(e&&e.length){p.push({type:t.type,data:e,parent:"audio",content:"data"})}});if(!c&&p.length){p.forEach(function(e){if(r.state===St.PARSING){r.pendingBuffering=true;r.hls.trigger(s["a"].BUFFER_APPENDING,e)}});this.pendingData=[];this.appended=true}}this.tick()}};t.prototype.onFragParsed=function e(t){var r=this.fragCurrent;var i=t.frag;if(r&&t.id==="audio"&&i.sn===r.sn&&i.level===r.level&&this.state===St.PARSING){this.stats.tparsed=performance.now();this.state=St.PARSED;this._checkAppendedParsed()}};t.prototype.onBufferReset=function e(){this.mediaBuffer=this.videoBuffer=null;this.loadedmetadata=false};t.prototype.onBufferCreated=function e(t){var r=t.tracks.audio;if(r){this.mediaBuffer=r.buffer;this.loadedmetadata=true}if(t.tracks.video){this.videoBuffer=t.tracks.video.buffer}};t.prototype.onBufferAppended=function e(t){if(t.parent==="audio"){var r=this.state;if(r===St.PARSING||r===St.PARSED){this.pendingBuffering=t.pending>0;this._checkAppendedParsed()}}};t.prototype._checkAppendedParsed=function e(){if(this.state===St.PARSED&&(!this.appended||!this.pendingBuffering)){var t=this.fragCurrent,r=this.stats,i=this.hls;if(t){this.fragPrevious=t;r.tbuffered=performance.now();i.trigger(s["a"].FRAG_BUFFERED,{stats:r,frag:t,id:"audio"});var a=this.mediaBuffer?this.mediaBuffer:this.media;l["b"].log("audio buffered : "+le.toString(a.buffered));if(this.audioSwitch&&this.appended){this.audioSwitch=false;i.trigger(s["a"].AUDIO_TRACK_SWITCHED,{id:this.trackId})}this.state=St.IDLE}this.tick()}};t.prototype.onError=function e(t){var r=t.frag;if(r&&r.type!=="audio"){return}switch(t.details){case o["a"].FRAG_LOAD_ERROR:case o["a"].FRAG_LOAD_TIMEOUT:if(!t.fatal){var i=this.fragLoadError;if(i){i++}else{i=1}var a=this.config;if(i<=a.fragLoadingMaxRetry){this.fragLoadError=i;r.loadCounter=0;var n=Math.min(Math.pow(2,i-1)*a.fragLoadingRetryDelay,a.fragLoadingMaxRetryTimeout);l["b"].warn("audioStreamController: frag loading failed, retry in "+n+" ms");this.retryDate=performance.now()+n;this.state=St.FRAG_LOADING_WAITING_RETRY}else{l["b"].error("audioStreamController: "+t.details+" reaches max retry, redispatch as fatal ...");t.fatal=true;this.state=St.ERROR}}break;case o["a"].FRAG_LOOP_LOADING_ERROR:case o["a"].AUDIO_TRACK_LOAD_ERROR:case o["a"].AUDIO_TRACK_LOAD_TIMEOUT:case o["a"].KEY_LOAD_ERROR:case o["a"].KEY_LOAD_TIMEOUT:if(this.state!==St.ERROR){this.state=t.fatal?St.ERROR:St.IDLE;l["b"].warn("audioStreamController: "+t.details+" while loading frag,switch to "+this.state+" state ...")}break;case o["a"].BUFFER_FULL_ERROR:if(t.parent==="audio"&&(this.state===St.PARSING||this.state===St.PARSED)){var u=this.mediaBuffer,f=this.media.currentTime,d=u&&q.isBuffered(u,f)&&q.isBuffered(u,f+.5);if(d){var c=this.config;if(c.maxMaxBufferLength>=c.maxBufferLength){c.maxMaxBufferLength/=2;l["b"].warn("audio:reduce max buffer length to "+c.maxMaxBufferLength+"s");this.fragLoadIdx+=2*c.fragLoadingLoopThreshold}this.state=St.IDLE}else{l["b"].warn("buffer full error also media.currentTime is not buffered, flush audio buffer");this.fragCurrent=null;this.state=St.BUFFER_FLUSHING;this.hls.trigger(s["a"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}break;default:break}};t.prototype.onBufferFlushed=function e(){var t=this;var r=this.pendingData;if(r&&r.length){l["b"].log("appending pending audio data on Buffer Flushed");r.forEach(function(e){t.hls.trigger(s["a"].BUFFER_APPENDING,e)});this.appended=true;this.pendingData=[];this.state=St.PARSED}else{this.state=St.IDLE;this.fragPrevious=null;this.tick()}};bt(t,[{key:"state",set:function e(t){if(this.state!==t){var r=this.state;this._state=t;l["b"].log("audio stream:"+r+"->"+t)}},get:function e(){return this._state}}]);return t}(c);var Rt=wt;var At=function(){if(typeof window!=="undefined"&&window.VTTCue){return window.VTTCue}var e="auto";var t={"":true,lr:true,rl:true};var r={start:true,middle:true,end:true,left:true,right:true};function i(e){if(typeof e!=="string"){return false}var r=t[e.toLowerCase()];return r?e.toLowerCase():false}function a(e){if(typeof e!=="string"){return false}var t=r[e.toLowerCase()];return t?e.toLowerCase():false}function n(e){var t=1;for(;t<arguments.length;t++){var r=arguments[t];for(var i in r){e[i]=r[i]}}return e}function s(t,r,s){var o=this;var l=function(){if(typeof navigator==="undefined"){return}return/MSIE\s8\.0/.test(navigator.userAgent)}();var u={};if(l){o=document.createElement("custom")}else{u.enumerable=true}o.hasBeenReset=false;var f="";var d=false;var c=t;var h=r;var p=s;var v=null;var g="";var m=true;var y="auto";var b="start";var _=50;var E="middle";var T=50;var S="middle";Object.defineProperty(o,"id",n({},u,{get:function e(){return f},set:function e(t){f=""+t}}));Object.defineProperty(o,"pauseOnExit",n({},u,{get:function e(){return d},set:function e(t){d=!!t}}));Object.defineProperty(o,"startTime",n({},u,{get:function e(){return c},set:function e(t){if(typeof t!=="number"){throw new TypeError("Start time must be set to a number.")}c=t;this.hasBeenReset=true}}));Object.defineProperty(o,"endTime",n({},u,{get:function e(){return h},set:function e(t){if(typeof t!=="number"){throw new TypeError("End time must be set to a number.")}h=t;this.hasBeenReset=true}}));Object.defineProperty(o,"text",n({},u,{get:function e(){return p},set:function e(t){p=""+t;this.hasBeenReset=true}}));Object.defineProperty(o,"region",n({},u,{get:function e(){return v},set:function e(t){v=t;this.hasBeenReset=true}}));Object.defineProperty(o,"vertical",n({},u,{get:function e(){return g},set:function e(t){var r=i(t);if(r===false){throw new SyntaxError("An invalid or illegal string was specified.")}g=r;this.hasBeenReset=true}}));Object.defineProperty(o,"snapToLines",n({},u,{get:function e(){return m},set:function e(t){m=!!t;this.hasBeenReset=true}}));Object.defineProperty(o,"line",n({},u,{get:function e(){return y},set:function t(r){if(typeof r!=="number"&&r!==e){throw new SyntaxError("An invalid number or illegal string was specified.")}y=r;this.hasBeenReset=true}}));Object.defineProperty(o,"lineAlign",n({},u,{get:function e(){return b},set:function e(t){var r=a(t);if(!r){throw new SyntaxError("An invalid or illegal string was specified.")}b=r;this.hasBeenReset=true}}));Object.defineProperty(o,"position",n({},u,{get:function e(){return _},set:function e(t){if(t<0||t>100){throw new Error("Position must be between 0 and 100.")}_=t;this.hasBeenReset=true}}));Object.defineProperty(o,"positionAlign",n({},u,{get:function e(){return E},set:function e(t){var r=a(t);if(!r){throw new SyntaxError("An invalid or illegal string was specified.")}E=r;this.hasBeenReset=true}}));Object.defineProperty(o,"size",n({},u,{get:function e(){return T},set:function e(t){if(t<0||t>100){throw new Error("Size must be between 0 and 100.")}T=t;this.hasBeenReset=true}}));Object.defineProperty(o,"align",n({},u,{get:function e(){return S},set:function e(t){var r=a(t);if(!r){throw new SyntaxError("An invalid or illegal string was specified.")}S=r;this.hasBeenReset=true}}));o.displayState=undefined;if(l){return o}}s.prototype.getCueAsHTML=function(){var e=window.WebVTT;return e.convertCueToDOMTree(window,this.text)};return s}();var Lt=function e(){return{decode:function e(t){if(!t){return""}if(typeof t!=="string"){throw new Error("Error - expected string data.")}return decodeURIComponent(encodeURIComponent(t))}}};function It(){this.window=window;this.state="INITIAL";this.buffer="";this.decoder=new Lt;this.regionList=[]}function Dt(e){function t(e,t,r,i){return(e|0)*3600+(t|0)*60+(r|0)+(i|0)/1e3}var r=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);if(!r){return null}if(r[3]){return t(r[1],r[2],r[3].replace(":",""),r[4])}else if(r[1]>59){return t(r[1],r[2],0,r[4])}else{return t(0,r[1],r[2],r[4])}}function kt(){this.values=Object.create(null)}kt.prototype={set:function e(t,r){if(!this.get(t)&&r!==""){this.values[t]=r}},get:function e(t,r,i){if(i){return this.has(t)?this.values[t]:r[i]}return this.has(t)?this.values[t]:r},has:function e(t){return t in this.values},alt:function e(t,r,i){for(var a=0;a<i.length;++a){if(r===i[a]){this.set(t,r);break}}},integer:function e(t,r){if(/^-?\d+$/.test(r)){this.set(t,parseInt(r,10))}},percent:function e(t,r){var i;if(i=r.match(/^([\d]{1,3})(\.[\d]*)?%$/)){r=parseFloat(r);if(r>=0&&r<=100){this.set(t,r);return true}}return false}};function Ot(e,t,r,i){var a=i?e.split(i):[e];for(var n in a){if(typeof a[n]!=="string"){continue}var s=a[n].split(r);if(s.length!==2){continue}var o=s[0];var l=s[1];t(o,l)}}var xt=new At(0,0,0);var Ct=xt.align==="middle"?"middle":"center";function Pt(e,t,r){var i=e;function a(){var t=Dt(e);if(t===null){throw new Error("Malformed timestamp: "+i)}e=e.replace(/^[^\sa-zA-Z-]+/,"");return t}function n(e,t){var i=new kt;Ot(e,function(e,t){switch(e){case"region":for(var a=r.length-1;a>=0;a--){if(r[a].id===t){i.set(e,r[a].region);break}}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":var n=t.split(","),s=n[0];i.integer(e,s);if(i.percent(e,s)){i.set("snapToLines",false)}i.alt(e,s,["auto"]);if(n.length===2){i.alt("lineAlign",n[1],["start",Ct,"end"])}break;case"position":n=t.split(",");i.percent(e,n[0]);if(n.length===2){i.alt("positionAlign",n[1],["start",Ct,"end","line-left","line-right","auto"])}break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start",Ct,"end","left","right"]);break}},/:/,/\s/);t.region=i.get("region",null);t.vertical=i.get("vertical","");var a=i.get("line","auto");if(a==="auto"&&xt.line===-1){a=-1}t.line=a;t.lineAlign=i.get("lineAlign","start");t.snapToLines=i.get("snapToLines",true);t.size=i.get("size",100);t.align=i.get("align",Ct);var n=i.get("position","auto");if(n==="auto"&&xt.position===50){n=t.align==="start"||t.align==="left"?0:t.align==="end"||t.align==="right"?100:50}t.position=n}function s(){e=e.replace(/^\s+/,"")}s();t.startTime=a();s();if(e.substr(0,3)!=="--\x3e"){throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i)}e=e.substr(3);s();t.endTime=a();s();n(e,t)}function Ft(e){return e.replace(/<br(?: \/)?>/gi,"\n")}It.prototype={parse:function e(t){var r=this;if(t){r.buffer+=r.decoder.decode(t,{stream:true})}function i(){var e=r.buffer;var t=0;e=Ft(e);while(t<e.length&&e[t]!=="\r"&&e[t]!=="\n"){++t}var i=e.substr(0,t);if(e[t]==="\r"){++t}if(e[t]==="\n"){++t}r.buffer=e.substr(t);return i}function a(e){Ot(e,function(e,t){switch(e){case"Region":console.log("parse region",t);break}},/:/)}try{var n;if(r.state==="INITIAL"){if(!/\r\n|\n/.test(r.buffer)){return this}n=i();var s=n.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!s||!s[0]){throw new Error("Malformed WebVTT signature.")}r.state="HEADER"}var o=false;while(r.buffer){if(!/\r\n|\n/.test(r.buffer)){return this}if(!o){n=i()}else{o=false}switch(r.state){case"HEADER":if(/:/.test(n)){a(n)}else if(!n){r.state="ID"}continue;case"NOTE":if(!n){r.state="ID"}continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){r.state="NOTE";break}if(!n){continue}r.cue=new At(0,0,"");r.state="CUE";if(n.indexOf("--\x3e")===-1){r.cue.id=n;continue}case"CUE":try{Pt(n,r.cue,r.regionList)}catch(e){r.cue=null;r.state="BADCUE";continue}r.state="CUETEXT";continue;case"CUETEXT":var l=n.indexOf("--\x3e")!==-1;if(!n||l&&(o=true)){if(r.oncue){r.oncue(r.cue)}r.cue=null;r.state="ID";continue}if(r.cue.text){r.cue.text+="\n"}r.cue.text+=n;continue;case"BADCUE":if(!n){r.state="ID"}continue}}}catch(e){if(r.state==="CUETEXT"&&r.cue&&r.oncue){r.oncue(r.cue)}r.cue=null;r.state=r.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function e(){var t=this;try{t.buffer+=t.decoder.decode();if(t.cue||t.state==="HEADER"){t.buffer+="\n\n";t.parse()}if(t.state==="INITIAL"){throw new Error("Malformed WebVTT signature.")}}catch(e){throw e}if(t.onflush){t.onflush()}return this}};var Nt=It;function Mt(e,t,r,i){var a;var n;var s;var o;var l;var u=window.VTTCue||window.TextTrackCue;for(var f=0;f<i.rows.length;f++){a=i.rows[f];s=true;o=0;l="";if(!a.isEmpty()){for(var d=0;d<a.chars.length;d++){if(a.chars[d].uchar.match(/\s/)&&s){o++}else{l+=a.chars[d].uchar;s=false}}a.cueStartTime=t;if(t===r){r+=1e-4}n=new u(t,r,Ft(l.trim()));if(o>=16){o--}else{o++}if(navigator.userAgent.match(/Firefox\//)){n.line=f+1}else{n.line=f>7?f-2:f+1}n.align="left";n.position=Math.max(0,Math.min(100,100*(o/32)+(navigator.userAgent.match(/Firefox\//)?50:0)));e.addCue(n)}}}function Ut(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var Bt={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499};var Gt=function e(t){var r=t;if(Bt.hasOwnProperty(t)){r=Bt[t]}return String.fromCharCode(r)};var Ht=15,jt=100;var $t={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14};var Kt={17:2,18:4,21:6,22:8,23:10,19:13,20:15};var Wt={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14};var Vt={25:2,26:4,29:6,30:8,31:10,27:13,28:15};var qt=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];var Yt={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function e(t){this.time=t},log:function e(t,r){var i=this.verboseFilter[t];if(this.verboseLevel>=i){console.log(this.time+" ["+t+"] "+r)}}};var zt=function e(t){var r=[];for(var i=0;i<t.length;i++){r.push(t[i].toString(16))}return r};var Xt=function(){function e(t,r,i,a,n){Ut(this,e);this.foreground=t||"white";this.underline=r||false;this.italics=i||false;this.background=a||"black";this.flash=n||false}e.prototype.reset=function e(){this.foreground="white";this.underline=false;this.italics=false;this.background="black";this.flash=false};e.prototype.setStyles=function e(t){var r=["foreground","underline","italics","background","flash"];for(var i=0;i<r.length;i++){var a=r[i];if(t.hasOwnProperty(a)){this[a]=t[a]}}};e.prototype.isDefault=function e(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash};e.prototype.equals=function e(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash};e.prototype.copy=function e(t){this.foreground=t.foreground;this.underline=t.underline;this.italics=t.italics;this.background=t.background;this.flash=t.flash};e.prototype.toString=function e(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash};return e}();var Qt=function(){function e(t,r,i,a,n,s){Ut(this,e);this.uchar=t||" ";this.penState=new Xt(r,i,a,n,s)}e.prototype.reset=function e(){this.uchar=" ";this.penState.reset()};e.prototype.setChar=function e(t,r){this.uchar=t;this.penState.copy(r)};e.prototype.setPenState=function e(t){this.penState.copy(t)};e.prototype.equals=function e(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)};e.prototype.copy=function e(t){this.uchar=t.uchar;this.penState.copy(t.penState)};e.prototype.isEmpty=function e(){return this.uchar===" "&&this.penState.isDefault()};return e}();var Jt=function(){function e(){Ut(this,e);this.chars=[];for(var t=0;t<jt;t++){this.chars.push(new Qt)}this.pos=0;this.currPenState=new Xt}e.prototype.equals=function e(t){var r=true;for(var i=0;i<jt;i++){if(!this.chars[i].equals(t.chars[i])){r=false;break}}return r};e.prototype.copy=function e(t){for(var r=0;r<jt;r++){this.chars[r].copy(t.chars[r])}};e.prototype.isEmpty=function e(){var t=true;for(var r=0;r<jt;r++){if(!this.chars[r].isEmpty()){t=false;break}}return t};e.prototype.setCursor=function e(t){if(this.pos!==t){this.pos=t}if(this.pos<0){Yt.log("ERROR","Negative cursor position "+this.pos);this.pos=0}else if(this.pos>jt){Yt.log("ERROR","Too large cursor position "+this.pos);this.pos=jt}};e.prototype.moveCursor=function e(t){var r=this.pos+t;if(t>1){for(var i=this.pos+1;i<r+1;i++){this.chars[i].setPenState(this.currPenState)}}this.setCursor(r)};e.prototype.backSpace=function e(){this.moveCursor(-1);this.chars[this.pos].setChar(" ",this.currPenState)};e.prototype.insertChar=function e(t){if(t>=144){this.backSpace()}var r=Gt(t);if(this.pos>=jt){Yt.log("ERROR","Cannot insert "+t.toString(16)+" ("+r+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(r,this.currPenState);this.moveCursor(1)};e.prototype.clearFromPos=function e(t){var r;for(r=t;r<jt;r++){this.chars[r].reset()}};e.prototype.clear=function e(){this.clearFromPos(0);this.pos=0;this.currPenState.reset()};e.prototype.clearToEndOfRow=function e(){this.clearFromPos(this.pos)};e.prototype.getTextString=function e(){var t=[];var r=true;for(var i=0;i<jt;i++){var a=this.chars[i].uchar;if(a!==" "){r=false}t.push(a)}if(r){return""}else{return t.join("")}};e.prototype.setPenStyles=function e(t){this.currPenState.setStyles(t);var r=this.chars[this.pos];r.setPenState(this.currPenState)};return e}();var Zt=function(){function e(){Ut(this,e);this.rows=[];for(var t=0;t<Ht;t++){this.rows.push(new Jt)}this.currRow=Ht-1;this.nrRollUpRows=null;this.reset()}e.prototype.reset=function e(){for(var t=0;t<Ht;t++){this.rows[t].clear()}this.currRow=Ht-1};e.prototype.equals=function e(t){var r=true;for(var i=0;i<Ht;i++){if(!this.rows[i].equals(t.rows[i])){r=false;break}}return r};e.prototype.copy=function e(t){for(var r=0;r<Ht;r++){this.rows[r].copy(t.rows[r])}};e.prototype.isEmpty=function e(){var t=true;for(var r=0;r<Ht;r++){if(!this.rows[r].isEmpty()){t=false;break}}return t};e.prototype.backSpace=function e(){var t=this.rows[this.currRow];t.backSpace()};e.prototype.clearToEndOfRow=function e(){var t=this.rows[this.currRow];t.clearToEndOfRow()};e.prototype.insertChar=function e(t){var r=this.rows[this.currRow];r.insertChar(t)};e.prototype.setPen=function e(t){var r=this.rows[this.currRow];r.setPenStyles(t)};e.prototype.moveCursor=function e(t){var r=this.rows[this.currRow];r.moveCursor(t)};e.prototype.setCursor=function e(t){Yt.log("INFO","setCursor: "+t);var r=this.rows[this.currRow];r.setCursor(t)};e.prototype.setPAC=function e(t){Yt.log("INFO","pacData = "+JSON.stringify(t));var r=t.row-1;if(this.nrRollUpRows&&r<this.nrRollUpRows-1){r=this.nrRollUpRows-1}if(this.nrRollUpRows&&this.currRow!==r){for(var i=0;i<Ht;i++){this.rows[i].clear()}var a=this.currRow+1-this.nrRollUpRows;var n=this.lastOutputScreen;if(n){var s=n.rows[a].cueStartTime;if(s&&s<Yt.time){for(var o=0;o<this.nrRollUpRows;o++){this.rows[r-this.nrRollUpRows+o+1].copy(n.rows[a+o])}}}}this.currRow=r;var l=this.rows[this.currRow];if(t.indent!==null){var u=t.indent;var f=Math.max(u-1,0);l.setCursor(t.indent);t.color=l.chars[f].penState.foreground}var d={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:false};this.setPen(d)};e.prototype.setBkgData=function e(t){Yt.log("INFO","bkgData = "+JSON.stringify(t));this.backSpace();this.setPen(t);this.insertChar(32)};e.prototype.setRollUpRows=function e(t){this.nrRollUpRows=t};e.prototype.rollUp=function e(){if(this.nrRollUpRows===null){Yt.log("DEBUG","roll_up but nrRollUpRows not set yet");return}Yt.log("TEXT",this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows;var r=this.rows.splice(t,1)[0];r.clear();this.rows.splice(this.currRow,0,r);Yt.log("INFO","Rolling up")};e.prototype.getDisplayText=function e(t){t=t||false;var r=[];var i="";var a=-1;for(var n=0;n<Ht;n++){var s=this.rows[n].getTextString();if(s){a=n+1;if(t){r.push("Row "+a+": '"+s+"'")}else{r.push(s.trim())}}}if(r.length>0){if(t){i="["+r.join(" | ")+"]"}else{i=r.join("\n")}}return i};e.prototype.getTextAndFormat=function e(){return this.rows};return e}();var er=function(){function e(t,r){Ut(this,e);this.chNr=t;this.outputFilter=r;this.mode=null;this.verbose=0;this.displayedMemory=new Zt;this.nonDisplayedMemory=new Zt;this.lastOutputScreen=new Zt;this.currRollUpRow=this.displayedMemory.rows[Ht-1];this.writeScreen=this.displayedMemory;this.mode=null;this.cueStartTime=null}e.prototype.reset=function e(){this.mode=null;this.displayedMemory.reset();this.nonDisplayedMemory.reset();this.lastOutputScreen.reset();this.currRollUpRow=this.displayedMemory.rows[Ht-1];this.writeScreen=this.displayedMemory;this.mode=null;this.cueStartTime=null;this.lastCueEndTime=null};e.prototype.getHandler=function e(){return this.outputFilter};e.prototype.setHandler=function e(t){this.outputFilter=t};e.prototype.setPAC=function e(t){this.writeScreen.setPAC(t)};e.prototype.setBkgData=function e(t){this.writeScreen.setBkgData(t)};e.prototype.setMode=function e(t){if(t===this.mode){return}this.mode=t;Yt.log("INFO","MODE="+t);if(this.mode==="MODE_POP-ON"){this.writeScreen=this.nonDisplayedMemory}else{this.writeScreen=this.displayedMemory;this.writeScreen.reset()}if(this.mode!=="MODE_ROLL-UP"){this.displayedMemory.nrRollUpRows=null;this.nonDisplayedMemory.nrRollUpRows=null}this.mode=t};e.prototype.insertChars=function e(t){for(var r=0;r<t.length;r++){this.writeScreen.insertChar(t[r])}var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";Yt.log("INFO",i+": "+this.writeScreen.getDisplayText(true));if(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP"){Yt.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(true));this.outputDataUpdate()}};e.prototype.ccRCL=function e(){Yt.log("INFO","RCL - Resume Caption Loading");this.setMode("MODE_POP-ON")};e.prototype.ccBS=function e(){Yt.log("INFO","BS - BackSpace");if(this.mode==="MODE_TEXT"){return}this.writeScreen.backSpace();if(this.writeScreen===this.displayedMemory){this.outputDataUpdate()}};e.prototype.ccAOF=function e(){return};e.prototype.ccAON=function e(){return};e.prototype.ccDER=function e(){Yt.log("INFO","DER- Delete to End of Row");this.writeScreen.clearToEndOfRow();this.outputDataUpdate()};e.prototype.ccRU=function e(t){Yt.log("INFO","RU("+t+") - Roll Up");this.writeScreen=this.displayedMemory;this.setMode("MODE_ROLL-UP");this.writeScreen.setRollUpRows(t)};e.prototype.ccFON=function e(){Yt.log("INFO","FON - Flash On");this.writeScreen.setPen({flash:true})};e.prototype.ccRDC=function e(){Yt.log("INFO","RDC - Resume Direct Captioning");this.setMode("MODE_PAINT-ON")};e.prototype.ccTR=function e(){Yt.log("INFO","TR");this.setMode("MODE_TEXT")};e.prototype.ccRTD=function e(){Yt.log("INFO","RTD");this.setMode("MODE_TEXT")};e.prototype.ccEDM=function e(){Yt.log("INFO","EDM - Erase Displayed Memory");this.displayedMemory.reset();this.outputDataUpdate(true)};e.prototype.ccCR=function e(){Yt.log("CR - Carriage Return");this.writeScreen.rollUp();this.outputDataUpdate(true)};e.prototype.ccENM=function e(){Yt.log("INFO","ENM - Erase Non-displayed Memory");this.nonDisplayedMemory.reset()};e.prototype.ccEOC=function e(){Yt.log("INFO","EOC - End Of Caption");if(this.mode==="MODE_POP-ON"){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory;this.nonDisplayedMemory=t;this.writeScreen=this.nonDisplayedMemory;Yt.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(true)};e.prototype.ccTO=function e(t){Yt.log("INFO","TO("+t+") - Tab Offset");this.writeScreen.moveCursor(t)};e.prototype.ccMIDROW=function e(t){var r={flash:false};r.underline=t%2===1;r.italics=t>=46;if(!r.italics){var i=Math.floor(t/2)-16;var a=["white","green","blue","cyan","red","yellow","magenta"];r.foreground=a[i]}else{r.foreground="white"}Yt.log("INFO","MIDROW: "+JSON.stringify(r));this.writeScreen.setPen(r)};e.prototype.outputDataUpdate=function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var r=Yt.time;if(r===null){return}if(this.outputFilter){if(this.cueStartTime===null&&!this.displayedMemory.isEmpty()){this.cueStartTime=r}else{if(!this.displayedMemory.equals(this.lastOutputScreen)){if(this.outputFilter.newCue){this.outputFilter.newCue(this.cueStartTime,r,this.lastOutputScreen);if(t===true&&this.outputFilter.dispatchCue){this.outputFilter.dispatchCue()}}this.cueStartTime=this.displayedMemory.isEmpty()?null:r}}this.lastOutputScreen.copy(this.displayedMemory)}};e.prototype.cueSplitAtTime=function e(t){if(this.outputFilter){if(!this.displayedMemory.isEmpty()){if(this.outputFilter.newCue){this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory)}this.cueStartTime=t}}};return e}();var tr=function(){function e(t,r,i){Ut(this,e);this.field=t||1;this.outputs=[r,i];this.channels=[new er(1,r),new er(2,i)];this.currChNr=-1;this.lastCmdA=null;this.lastCmdB=null;this.bufferedData=[];this.startTime=null;this.lastTime=null;this.dataCounters={padding:0,char:0,cmd:0,other:0}}e.prototype.getHandler=function e(t){return this.channels[t].getHandler()};e.prototype.setHandler=function e(t,r){this.channels[t].setHandler(r)};e.prototype.addData=function e(t,r){var i,a,n,s=false;this.lastTime=t;Yt.setTime(t);for(var o=0;o<r.length;o+=2){a=r[o]&127;n=r[o+1]&127;if(a===0&&n===0){this.dataCounters.padding+=2;continue}else{Yt.log("DATA","["+zt([r[o],r[o+1]])+"] -> ("+zt([a,n])+")")}i=this.parseCmd(a,n);if(!i){i=this.parseMidrow(a,n)}if(!i){i=this.parsePAC(a,n)}if(!i){i=this.parseBackgroundAttributes(a,n)}if(!i){s=this.parseChars(a,n);if(s){if(this.currChNr&&this.currChNr>=0){var l=this.channels[this.currChNr-1];l.insertChars(s)}else{Yt.log("WARNING","No channel found yet. TEXT-MODE?")}}}if(i){this.dataCounters.cmd+=2}else if(s){this.dataCounters.char+=2}else{this.dataCounters.other+=2;Yt.log("WARNING","Couldn't parse cleaned data "+zt([a,n])+" orig: "+zt([r[o],r[o+1]]))}}};e.prototype.parseCmd=function e(t,r){var i=null;var a=(t===20||t===28)&&32<=r&&r<=47;var n=(t===23||t===31)&&33<=r&&r<=35;if(!(a||n)){return false}if(t===this.lastCmdA&&r===this.lastCmdB){this.lastCmdA=null;this.lastCmdB=null;Yt.log("DEBUG","Repeated command ("+zt([t,r])+") is dropped");return true}if(t===20||t===23){i=1}else{i=2}var s=this.channels[i-1];if(t===20||t===28){if(r===32){s.ccRCL()}else if(r===33){s.ccBS()}else if(r===34){s.ccAOF()}else if(r===35){s.ccAON()}else if(r===36){s.ccDER()}else if(r===37){s.ccRU(2)}else if(r===38){s.ccRU(3)}else if(r===39){s.ccRU(4)}else if(r===40){s.ccFON()}else if(r===41){s.ccRDC()}else if(r===42){s.ccTR()}else if(r===43){s.ccRTD()}else if(r===44){s.ccEDM()}else if(r===45){s.ccCR()}else if(r===46){s.ccENM()}else if(r===47){s.ccEOC()}}else{s.ccTO(r-32)}this.lastCmdA=t;this.lastCmdB=r;this.currChNr=i;return true};e.prototype.parseMidrow=function e(t,r){var i=null;if((t===17||t===25)&&32<=r&&r<=47){if(t===17){i=1}else{i=2}if(i!==this.currChNr){Yt.log("ERROR","Mismatch channel in midrow parsing");return false}var a=this.channels[i-1];a.ccMIDROW(r);Yt.log("DEBUG","MIDROW ("+zt([t,r])+")");return true}return false};e.prototype.parsePAC=function e(t,r){var i=null;var a=null;var n=(17<=t&&t<=23||25<=t&&t<=31)&&64<=r&&r<=127;var s=(t===16||t===24)&&64<=r&&r<=95;if(!(n||s)){return false}if(t===this.lastCmdA&&r===this.lastCmdB){this.lastCmdA=null;this.lastCmdB=null;return true}i=t<=23?1:2;if(64<=r&&r<=95){a=i===1?$t[t]:Wt[t]}else{a=i===1?Kt[t]:Vt[t]}var o=this.interpretPAC(a,r);var l=this.channels[i-1];l.setPAC(o);this.lastCmdA=t;this.lastCmdB=r;this.currChNr=i;return true};e.prototype.interpretPAC=function e(t,r){var i=r;var a={color:null,italics:false,indent:null,underline:false,row:t};if(r>95){i=r-96}else{i=r-64}a.underline=(i&1)===1;if(i<=13){a.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]}else if(i<=15){a.italics=true;a.color="white"}else{a.indent=Math.floor((i-16)/2)*4}return a};e.prototype.parseChars=function e(t,r){var i=null,a=null,n=null;if(t>=25){i=2;n=t-8}else{i=1;n=t}if(17<=n&&n<=19){var s=r;if(n===17){s=r+80}else if(n===18){s=r+112}else{s=r+144}Yt.log("INFO","Special char '"+Gt(s)+"' in channel "+i);a=[s]}else if(32<=t&&t<=127){a=r===0?[t]:[t,r]}if(a){var o=zt(a);Yt.log("DEBUG","Char codes =  "+o.join(","));this.lastCmdA=null;this.lastCmdB=null}return a};e.prototype.parseBackgroundAttributes=function e(t,r){var i,a,n,s;var o=(t===16||t===24)&&32<=r&&r<=47;var l=(t===23||t===31)&&45<=r&&r<=47;if(!(o||l)){return false}i={};if(t===16||t===24){a=Math.floor((r-32)/2);i.background=qt[a];if(r%2===1){i.background=i.background+"_semi"}}else if(r===45){i.background="transparent"}else{i.foreground="black";if(r===47){i.underline=true}}n=t<24?1:2;s=this.channels[n-1];s.setBkgData(i);this.lastCmdA=null;this.lastCmdB=null;return true};e.prototype.reset=function e(){for(var t=0;t<this.channels.length;t++){if(this.channels[t]){this.channels[t].reset()}}this.lastCmdA=null;this.lastCmdB=null};e.prototype.cueSplitAtTime=function e(t){for(var r=0;r<this.channels.length;r++){if(this.channels[r]){this.channels[r].cueSplitAtTime(t)}}};return e}();var rr=tr;function ir(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var ar=function(){function e(t,r){ir(this,e);this.timelineController=t;this.track=r;this.startTime=null;this.endTime=null;this.screen=null}e.prototype.dispatchCue=function e(){if(this.startTime===null){return}this.timelineController.addCues("textTrack"+this.track,this.startTime,this.endTime,this.screen);this.startTime=null};e.prototype.newCue=function e(t,r,i){if(this.startTime===null||this.startTime>t){this.startTime=t}this.endTime=r;this.screen=i;this.timelineController.createCaptionsTrack(this.track)};return e}();var nr=ar;var sr=function e(t,r,i){return t.substr(i||0,r.length)===r};var or=function e(t){var r=parseInt(t.substr(-3));var i=parseInt(t.substr(-6,2));var a=parseInt(t.substr(-9,2));var n=t.length>9?parseInt(t.substr(0,t.indexOf(":"))):0;if(isNaN(r)||isNaN(i)||isNaN(a)||isNaN(n)){return-1}r+=1e3*i;r+=60*1e3*a;r+=60*60*1e3*n;return r};var lr=function e(t){var e=5381;var r=t.length;while(r){e=e*33^t.charCodeAt(--r)}return(e>>>0).toString()};var ur=function e(t,r,i){var a=t[r];var n=t[a.prevCC];if(!n||!n.new&&a.new){t.ccOffset=t.presentationOffset=a.start;a.new=false;return}while(n&&n.new){t.ccOffset+=a.start-n.start;a.new=false;a=n;n=t[a.prevCC]}t.presentationOffset=i};var fr={parse:function e(t,r,i,a,n,s){var o=/\r\n|\n\r|\n|\r/g;var l=Object(Ie["b"])(new Uint8Array(t)).trim().replace(o,"\n").split("\n");var u="00:00.000";var f=0;var d=0;var c=0;var h=[];var p=void 0;var v=true;var g=new Nt;g.oncue=function(e){var t=i[a];var r=i.ccOffset;if(t&&t.new){if(d!==undefined){r=i.ccOffset=t.start}else{ur(i,a,c)}}if(c){r=c+i.ccOffset-i.presentationOffset}e.startTime+=r-d;e.endTime+=r-d;e.id=lr(e.startTime.toString())+lr(e.endTime.toString())+lr(e.text);e.text=decodeURIComponent(encodeURIComponent(e.text));if(e.endTime>0){h.push(e)}};g.onparsingerror=function(e){p=e};g.onflush=function(){if(p&&s){s(p);return}n(h)};l.forEach(function(e){if(v){if(sr(e,"X-TIMESTAMP-MAP=")){v=false;e.substr(16).split(",").forEach(function(e){if(sr(e,"LOCAL:")){u=e.substr(6)}else if(sr(e,"MPEGTS:")){f=parseInt(e.substr(7))}});try{r=r<0?r+8589934592:r;f-=r;d=or(u)/1e3;c=f/9e4;if(d===-1){p=new Error("Malformed X-TIMESTAMP-MAP: "+e)}}catch(t){p=new Error("Malformed X-TIMESTAMP-MAP: "+e)}return}else if(e===""){v=false}}g.parse(e+"\n")});g.flush()}};var dr=fr;function cr(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function hr(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function pr(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}function vr(e){if(e&&e.cues){while(e.cues.length>0){e.removeCue(e.cues[0])}}}function gr(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}function mr(e,t,r,i){return Math.min(t,i)-Math.max(e,r)}var yr=function(e){pr(t,e);function t(r){cr(this,t);var i=hr(this,e.call(this,r,s["a"].MEDIA_ATTACHING,s["a"].MEDIA_DETACHING,s["a"].FRAG_PARSING_USERDATA,s["a"].FRAG_DECRYPTED,s["a"].MANIFEST_LOADING,s["a"].MANIFEST_LOADED,s["a"].FRAG_LOADED,s["a"].LEVEL_SWITCHING,s["a"].INIT_PTS_FOUND));i.hls=r;i.config=r.config;i.enabled=true;i.Cues=r.config.cueHandler;i.textTracks=[];i.tracks=[];i.unparsedVttFrags=[];i.initPTS=undefined;i.cueRanges=[];if(i.config.enableCEA708Captions){var a=new nr(i,1);var n=new nr(i,2);i.cea608Parser=new rr(0,a,n)}return i}t.prototype.addCues=function e(t,r,i,a){var n=this.cueRanges;var s=false;for(var o=n.length;o--;){var l=n[o];var u=mr(l[0],l[1],r,i);if(u>=0){l[0]=Math.min(l[0],r);l[1]=Math.max(l[1],i);s=true;if(u/(i-r)>.5){return}}}if(!s){n.push([r,i])}this.Cues.newCue(this[t],r,i,a)};t.prototype.onInitPtsFound=function e(t){var r=this;if(typeof this.initPTS==="undefined"){this.initPTS=t.initPTS}if(this.unparsedVttFrags.length){this.unparsedVttFrags.forEach(function(e){r.onFragLoaded(e)});this.unparsedVttFrags=[]}};t.prototype.getExistingTrack=function e(t){var r=this.media;if(r){for(var i=0;i<r.textTracks.length;i++){var a=r.textTracks[i];var n="textTrack"+t;if(a[n]===true){return a}}}return null};t.prototype.sendAddTrackEvent=function e(t,r){var i=null;try{i=new window.Event("addtrack")}catch(e){i=document.createEvent("Event");i.initEvent("addtrack",false,false)}i.track=t;r.dispatchEvent(i)};t.prototype.createCaptionsTrack=function e(t){var r="textTrack"+t;if(!this[r]){var i=this.getExistingTrack(t);if(!i){var a=this.createTextTrack("captions",this.config["captionsTextTrack"+t+"Label"],this.config.captionsTextTrack1LanguageCode);if(a){a[r]=true;this[r]=a}}else{this[r]=i;vr(this[r]);this.sendAddTrackEvent(this[r],this.media)}}};t.prototype.createTextTrack=function e(t,r,i){var a=this.media;if(a){return a.addTextTrack(t,r,i)}};t.prototype.destroy=function e(){c.prototype.destroy.call(this)};t.prototype.onMediaAttaching=function e(t){this.media=t.media;this._cleanTracks()};t.prototype.onMediaDetaching=function e(){vr(this.textTrack1);vr(this.textTrack2)};t.prototype.onManifestLoading=function e(){this.lastSn=-1;this.prevCC=-1;this.vttCCs={ccOffset:0,presentationOffset:0};this._cleanTracks()};t.prototype._cleanTracks=function e(){var t=this.media;if(t){var r=t.textTracks;if(r){for(var i=0;i<r.length;i++){vr(r[i])}}}};t.prototype.onManifestLoaded=function e(t){var r=this;this.textTracks=[];this.unparsedVttFrags=this.unparsedVttFrags||[];this.initPTS=undefined;this.cueRanges=[];if(this.config.enableWebVTT){this.tracks=t.subtitles||[];var i=this.media?this.media.textTracks:[];this.tracks.forEach(function(e,t){var a=void 0;if(t<i.length){var n=i[t];if(gr(n,e)){a=n}}if(!a){a=r.createTextTrack("subtitles",e.name,e.lang)}a.mode=e.default?"showing":"hidden";r.textTracks.push(a)})}};t.prototype.onLevelSwitching=function e(){this.enabled=this.hls.currentLevel.closedCaptions!=="NONE"};t.prototype.onFragLoaded=function e(t){var r=t.frag,i=t.payload;if(r.type==="main"){var a=r.sn;if(a!==this.lastSn+1){var n=this.cea608Parser;if(n){n.reset()}}this.lastSn=a}else if(r.type==="subtitle"){if(i.byteLength){if(typeof this.initPTS==="undefined"){this.unparsedVttFrags.push(t);return}var o=r.decryptdata;if(o==null||o.key==null||o.method!=="AES-128"){this._parseVTTs(r,i)}}else{this.hls.trigger(s["a"].SUBTITLE_FRAG_PROCESSED,{success:false,frag:r})}}};t.prototype._parseVTTs=function e(t,r){var i=this.vttCCs;if(!i[t.cc]){i[t.cc]={start:t.start,prevCC:this.prevCC,new:true};this.prevCC=t.cc}var a=this.textTracks,n=this.hls;dr.parse(r,this.initPTS,i,t.cc,function(e){var r=a[t.trackId];e.forEach(function(e){if(!r.cues.getCueById(e.id)){try{r.addCue(e)}catch(i){var t=new window.TextTrackCue(e.startTime,e.endTime,e.text);t.id=e.id;r.addCue(t)}}});n.trigger(s["a"].SUBTITLE_FRAG_PROCESSED,{success:true,frag:t})},function(e){l["b"].log("Failed to parse VTT cue: "+e);n.trigger(s["a"].SUBTITLE_FRAG_PROCESSED,{success:false,frag:t})})};t.prototype.onFragDecrypted=function e(t){var r=t.payload,i=t.frag;if(i.type==="subtitle"){if(typeof this.initPTS==="undefined"){this.unparsedVttFrags.push(t);return}this._parseVTTs(i,r)}};t.prototype.onFragParsingUserdata=function e(t){if(this.enabled&&this.config.enableCEA708Captions){for(var r=0;r<t.samples.length;r++){var i=this.extractCea608Data(t.samples[r].bytes);this.cea608Parser.addData(t.samples[r].pts,i)}}};t.prototype.extractCea608Data=function e(t){var r=t[0]&31;var i=2;var a,n,s,o,l;var u=[];for(var f=0;f<r;f++){a=t[i++];n=127&t[i++];s=127&t[i++];o=(4&a)!==0;l=3&a;if(n===0&&s===0){continue}if(o){if(l===0){u.push(n);u.push(s)}}}return u};return t}(c);var br=yr;var _r=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function Er(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function Tr(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function Sr(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}function wr(e){var t=[];for(var r=0;r<e.length;r++){if(e[r].kind==="subtitles"){t.push(e[r])}}return t}var Rr=function(e){Sr(t,e);function t(r){Er(this,t);var i=Tr(this,e.call(this,r,s["a"].MEDIA_ATTACHED,s["a"].MEDIA_DETACHING,s["a"].MANIFEST_LOADING,s["a"].MANIFEST_LOADED,s["a"].SUBTITLE_TRACK_LOADED));i.tracks=[];i.trackId=-1;i.media=undefined;i.subtitleDisplay=false;return i}t.prototype._onTextTracksChanged=function e(){if(!this.media){return}var t=-1;var r=wr(this.media.textTracks);for(var i=0;i<r.length;i++){if(r[i].mode==="showing"){t=i}}this.subtitleTrack=t};t.prototype.destroy=function e(){c.prototype.destroy.call(this)};t.prototype.onMediaAttached=function e(t){var r=this;this.media=t.media;if(!this.media){return}if(this.queuedDefaultTrack!==undefined){this.subtitleTrack=this.queuedDefaultTrack;delete this.queuedDefaultTrack}this.trackChangeListener=this._onTextTracksChanged.bind(this);this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks);if(this.useTextTrackPolling){this.subtitlePollingInterval=setInterval(function(){r.trackChangeListener()},500)}else{this.media.textTracks.addEventListener("change",this.trackChangeListener)}};t.prototype.onMediaDetaching=function e(){if(!this.media){return}if(this.useTextTrackPolling){clearInterval(this.subtitlePollingInterval)}else{this.media.textTracks.removeEventListener("change",this.trackChangeListener)}this.media=undefined};t.prototype.onManifestLoading=function e(){this.tracks=[];this.trackId=-1};t.prototype.onManifestLoaded=function e(t){var r=this;var i=t.subtitles||[];this.tracks=i;this.trackId=-1;this.hls.trigger(s["a"].SUBTITLE_TRACKS_UPDATED,{subtitleTracks:i});i.forEach(function(e){if(e.default){if(r.media){r.subtitleTrack=e.id}else{r.queuedDefaultTrack=e.id}}})};t.prototype.onTick=function e(){var t=this.trackId;var r=this.tracks[t];if(!r){return}var i=r.details;if(i===undefined||i.live===true){l["b"].log("(re)loading playlist for subtitle track "+t);this.hls.trigger(s["a"].SUBTITLE_TRACK_LOADING,{url:r.url,id:t})}};t.prototype.onSubtitleTrackLoaded=function e(t){var r=this;if(t.id<this.tracks.length){l["b"].log("subtitle track "+t.id+" loaded");this.tracks[t.id].details=t.details;if(t.details.live&&!this.timer){this.timer=setInterval(function(){r.onTick()},1e3*t.details.targetduration,this)}if(!t.details.live&&this.timer){clearInterval(this.timer);this.timer=null}}};t.prototype.setSubtitleTrackInternal=function e(t){if(t<-1||t>=this.tracks.length){return}if(this.timer){clearInterval(this.timer);this.timer=null}var r=wr(this.media.textTracks);if(this.trackId!==-1&&this.subtitleDisplay){r[this.trackId].mode="hidden"}this.trackId=t;l["b"].log("switching to subtitle track "+t);this.hls.trigger(s["a"].SUBTITLE_TRACK_SWITCH,{id:t});if(t===-1){return}var i=this.tracks[t];if(this.subtitleDisplay){r[t].mode="showing"}var a=i.details;if(a===undefined||a.live===true){l["b"].log("(re)loading playlist for subtitle track "+t);this.hls.trigger(s["a"].SUBTITLE_TRACK_LOADING,{url:i.url,id:t})}};_r(t,[{key:"subtitleTracks",get:function e(){return this.tracks}},{key:"subtitleTrack",get:function e(){return this.trackId},set:function e(t){if(this.trackId!==t){this.setSubtitleTrackInternal(t)}}}]);return t}(c);var Ar=Rr;var Lr=r(4);function Ir(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function Dr(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function kr(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var Or={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING"};var xr=function(e){kr(t,e);function t(r){Ir(this,t);var i=Dr(this,e.call(this,r,s["a"].MEDIA_ATTACHED,s["a"].ERROR,s["a"].KEY_LOADED,s["a"].FRAG_LOADED,s["a"].SUBTITLE_TRACKS_UPDATED,s["a"].SUBTITLE_TRACK_SWITCH,s["a"].SUBTITLE_TRACK_LOADED,s["a"].SUBTITLE_FRAG_PROCESSED));i.config=r.config;i.vttFragSNsProcessed={};i.vttFragQueues=undefined;i.currentlyProcessing=null;i.state=Or.STOPPED;i.currentTrackId=-1;i.ticks=0;i.decrypter=new Lr["a"](r.observer,r.config);return i}t.prototype.destroy=function e(){c.prototype.destroy.call(this);this.state=Or.STOPPED};t.prototype.clearVttFragQueues=function e(){var t=this;this.vttFragQueues={};this.tracks.forEach(function(e){t.vttFragQueues[e.id]=[]})};t.prototype.nextFrag=function e(){if(this.currentlyProcessing===null&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var t=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.fragCurrent=t;this.hls.trigger(s["a"].FRAG_LOADING,{frag:t});this.state=Or.FRAG_LOADING}};t.prototype.onSubtitleFragProcessed=function e(t){if(t.success){this.vttFragSNsProcessed[t.frag.trackId].push(t.frag.sn)}this.currentlyProcessing=null;this.state=Or.IDLE;this.nextFrag()};t.prototype.onMediaAttached=function e(){this.state=Or.IDLE};t.prototype.onError=function e(t){var r=t.frag;if(r&&r.type!=="subtitle"){return}if(this.currentlyProcessing){this.currentlyProcessing=null;this.nextFrag()}};t.prototype.tick=function e(){var t=this;this.ticks++;if(this.ticks===1){this.doTick();if(this.ticks>1){setTimeout(function(){t.tick()},1)}this.ticks=0}};t.prototype.doTick=function e(){var t=this;switch(this.state){case Or.IDLE:var r=this.tracks;var i=this.currentTrackId;var a=this.vttFragSNsProcessed[i],n=this.vttFragQueues[i],o=!!this.currentlyProcessing?this.currentlyProcessing.sn:-1;var u=function e(t){return a.indexOf(t.sn)>-1};var f=function e(t){return n.some(function(e){return e.sn===t.sn})};if(!r){break}var d;if(i<r.length){d=r[i].details}if(typeof d==="undefined"){break}d.fragments.forEach(function(e){if(!(u(e)||e.sn===o||f(e))){if(e.decryptdata&&e.decryptdata.uri!=null&&e.decryptdata.key==null){l["b"].log("Loading key for "+e.sn);t.state=Or.KEY_LOADING;t.hls.trigger(s["a"].KEY_LOADING,{frag:e})}else{e.trackId=i;n.push(e);t.nextFrag()}}})}};t.prototype.onSubtitleTracksUpdated=function e(t){var r=this;l["b"].log("subtitle tracks updated");this.tracks=t.subtitleTracks;this.clearVttFragQueues();this.vttFragSNsProcessed={};this.tracks.forEach(function(e){r.vttFragSNsProcessed[e.id]=[]})};t.prototype.onSubtitleTrackSwitch=function e(t){this.currentTrackId=t.id;this.clearVttFragQueues()};t.prototype.onSubtitleTrackLoaded=function e(){this.tick()};t.prototype.onKeyLoaded=function e(){if(this.state===Or.KEY_LOADING){this.state=Or.IDLE;this.tick()}};t.prototype.onFragLoaded=function e(t){var r=this.fragCurrent,i=t.frag.decryptdata;var a=t.frag,n=this.hls;if(this.state===Or.FRAG_LOADING&&r&&t.frag.type==="subtitle"&&r.sn===t.frag.sn){if(t.payload.byteLength>0&&i!=null&&i.key!=null&&i.method==="AES-128"){var o;try{o=performance.now()}catch(e){o=Date.now()}this.decrypter.decrypt(t.payload,i.key.buffer,i.iv.buffer,function(e){var t;try{t=performance.now()}catch(e){t=Date.now()}n.trigger(s["a"].FRAG_DECRYPTED,{frag:a,payload:e,stats:{tstart:o,tdecrypt:t}})})}}};return t}(c);var Cr=xr;var Pr={autoStartLoad:true,startPosition:-1,defaultAudioCodec:undefined,debug:false,capLevelOnFPSDrop:false,capLevelToPlayerSize:false,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:60*1e3*1e3,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:Infinity,liveSyncDuration:undefined,liveMaxLatencyDuration:undefined,liveDurationInfinity:false,maxMaxBufferLength:600,enableWorker:true,enableSoftwareAES:true,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:undefined,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:false,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:ct,fLoader:undefined,pLoader:undefined,xhrSetup:undefined,fetchSetup:undefined,abrController:Ve,bufferController:Je,capLevelController:at,fpsController:ut,stretchShortVideoTrack:false,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:true,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:false,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0};if(true){Pr.subtitleStreamController=Cr;Pr.subtitleTrackController=Ar;Pr.timelineController=br;Pr.cueHandler=i;Pr.enableCEA708Captions=true;Pr.enableWebVTT=true;Pr.captionsTextTrack1Label="English";Pr.captionsTextTrack1LanguageCode="en";Pr.captionsTextTrack2Label="Spanish";Pr.captionsTextTrack2LanguageCode="es"}if(true){Pr.audioStreamController=Rt;Pr.audioTrackController=yt}var Fr=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function Nr(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var Mr=function(){e.isSupported=function e(){return Pe()};Fr(e,null,[{key:"version",get:function e(){return"0.8.9"}},{key:"Events",get:function e(){return s["a"]}},{key:"ErrorTypes",get:function e(){return o["b"]}},{key:"ErrorDetails",get:function e(){return o["a"]}},{key:"DefaultConfig",get:function t(){if(!e.defaultConfig){return Pr}return e.defaultConfig},set:function t(r){e.defaultConfig=r}}]);function e(){var t=this;var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};Nr(this,e);var i=e.DefaultConfig;if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration)){throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration")}for(var a in i){if(a in r){continue}r[a]=i[a]}if(r.liveMaxLatencyDurationCount!==undefined&&r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount){throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"')}if(r.liveMaxLatencyDuration!==undefined&&(r.liveMaxLatencyDuration<=r.liveSyncDuration||r.liveSyncDuration===undefined)){throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"')}Object(l["a"])(r.debug);this.config=r;this._autoLevelCapping=-1;var n=this.observer=new X.a;n.trigger=function e(t){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++){i[a-1]=arguments[a]}n.emit.apply(n,[t,t].concat(i))};n.off=function e(t){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++){i[a-1]=arguments[a]}n.removeListener.apply(n,[t].concat(i))};this.on=n.on.bind(n);this.off=n.off.bind(n);this.trigger=n.trigger.bind(n);var s=this.abrController=new r.abrController(this);var o=new r.bufferController(this);var u=new r.capLevelController(this);var f=new r.fpsController(this);var d=new C(this);var c=new U(this);var h=new $(this);var p=new Ce(this);var v=this.levelController=new Le(this);var g=this.streamController=new Ee(this);var m=[v,g];var y=r.audioStreamController;if(y){m.push(new y(this))}this.networkControllers=m;var b=[d,c,h,s,o,u,f,p];y=r.audioTrackController;if(y){var _=new y(this);this.audioTrackController=_;b.push(_)}y=r.subtitleTrackController;if(y){var E=new y(this);this.subtitleTrackController=E;b.push(E)}[r.subtitleStreamController,r.timelineController].forEach(function(e){if(e){b.push(new e(t))}});this.coreComponents=b}e.prototype.destroy=function e(){l["b"].log("destroy");this.trigger(s["a"].DESTROYING);this.detachMedia();this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()});this.url=null;this.observer.removeAllListeners();this._autoLevelCapping=-1};e.prototype.attachMedia=function e(t){l["b"].log("attachMedia");this.media=t;this.trigger(s["a"].MEDIA_ATTACHING,{media:t})};e.prototype.detachMedia=function e(){l["b"].log("detachMedia");this.trigger(s["a"].MEDIA_DETACHING);this.media=null};e.prototype.loadSource=function e(t){t=n.a.buildAbsoluteURL(window.location.href,t,{alwaysNormalize:true});l["b"].log("loadSource:"+t);this.url=t;this.trigger(s["a"].MANIFEST_LOADING,{url:t})};e.prototype.startLoad=function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:-1;l["b"].log("startLoad("+t+")");this.networkControllers.forEach(function(e){e.startLoad(t)})};e.prototype.stopLoad=function e(){l["b"].log("stopLoad");this.networkControllers.forEach(function(e){e.stopLoad()})};e.prototype.swapAudioCodec=function e(){l["b"].log("swapAudioCodec");this.streamController.swapAudioCodec()};e.prototype.recoverMediaError=function e(){l["b"].log("recoverMediaError");var t=this.media;this.detachMedia();this.attachMedia(t)};Fr(e,[{key:"levels",get:function e(){return this.levelController.levels}},{key:"currentLevel",get:function e(){return this.streamController.currentLevel},set:function e(t){l["b"].log("set currentLevel:"+t);this.loadLevel=t;this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function e(){return this.streamController.nextLevel},set:function e(t){l["b"].log("set nextLevel:"+t);this.levelController.manualLevel=t;this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function e(){return this.levelController.level},set:function e(t){l["b"].log("set loadLevel:"+t);this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function e(){return this.levelController.nextLoadLevel},set:function e(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function e(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function e(t){l["b"].log("set firstLevel:"+t);this.levelController.firstLevel=t}},{key:"startLevel",get:function e(){return this.levelController.startLevel},set:function e(t){l["b"].log("set startLevel:"+t);var r=this;if(t!==-1){t=Math.max(t,r.minAutoLevel)}r.levelController.startLevel=t}},{key:"autoLevelCapping",get:function e(){return this._autoLevelCapping},set:function e(t){l["b"].log("set autoLevelCapping:"+t);this._autoLevelCapping=t}},{key:"autoLevelEnabled",get:function e(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function e(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function e(){var t=this,r=t.levels,i=t.config.minAutoBitrate,a=r?r.length:0;for(var n=0;n<a;n++){var s=r[n].realBitrate?Math.max(r[n].realBitrate,r[n].bitrate):r[n].bitrate;if(s>i){return n}}return 0}},{key:"maxAutoLevel",get:function e(){var t=this;var r=t.levels;var i=t.autoLevelCapping;var a=void 0;if(i===-1&&r&&r.length){a=r.length-1}else{a=i}return a}},{key:"nextAutoLevel",get:function e(){var t=this;return Math.min(Math.max(t.abrController.nextAutoLevel,t.minAutoLevel),t.maxAutoLevel)},set:function e(t){var r=this;r.abrController.nextAutoLevel=Math.max(r.minAutoLevel,t)}},{key:"audioTracks",get:function e(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function e(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function e(t){var r=this.audioTrackController;if(r){r.audioTrack=t}}},{key:"liveSyncPosition",get:function e(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function e(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function e(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function e(t){var r=this.subtitleTrackController;if(r){r.subtitleTrack=t}}},{key:"subtitleDisplay",get:function e(){var t=this.subtitleTrackController;return t?t.subtitleDisplay:false},set:function e(t){var r=this.subtitleTrackController;if(r){r.subtitleDisplay=t}}}]);return e}();var Ur=t["default"]=Mr},function(e,t,r){function i(e){var t={};function r(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:false,exports:{}};e[i].call(a.exports,a,a.exports,r);a.l=true;return a.exports}r.m=e;r.c=t;r.i=function(e){return e};r.d=function(e,t,i){if(!r.o(e,t)){Object.defineProperty(e,t,{configurable:false,enumerable:true,get:i})}};r.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};r.d(t,"a",t);return t};r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};r.p="/";r.oe=function(e){console.error(e);throw e};var i=r(r.s=ENTRY_MODULE);return i.default||i}function a(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function n(e){var t=[];var r=e.toString();var i=r.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!i)return t;var n=i[1];var s=new RegExp("(\\\\n|\\W)"+a(n)+"\\((/\\*.*?\\*/)?s?.*?([\\.|\\-|\\w|/|@]+).*?\\)","g");var o;while(o=s.exec(r)){t.push(o[3])}return t}function s(e,t){var r=[t];var i=[];var a={};while(r.length){var s=r.pop();if(a[s]||!e[s])continue;a[s]=true;i.push(s);var o=n(e[s]);r=r.concat(o)}return i}e.exports=function(e,t){t=t||{};var a=r.m;var n=t.all?Object.keys(a):s(a,e);var o="("+i.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n.map(function(e){return""+JSON.stringify(e)+": "+a[e].toString()}).join(",")+"})(self);";var l=new window.Blob([o],{type:"text/javascript"});if(t.bare){return l}var u=window.URL||window.webkitURL||window.mozURL||window.msURL;var f=u.createObjectURL(l);var d=new window.Worker(f);d.objectURL=f;return d}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=r(7);var a=r(1);var n=r(0);var s=r(5);var o=r.n(s);var l=function e(t){var r=new o.a;r.trigger=function e(t){for(var i=arguments.length,a=Array(i>1?i-1:0),n=1;n<i;n++){a[n-1]=arguments[n]}r.emit.apply(r,[t,t].concat(a))};r.off=function e(t){for(var i=arguments.length,a=Array(i>1?i-1:0),n=1;n<i;n++){a[n-1]=arguments[n]}r.removeListener.apply(r,[t].concat(a))};var s=function e(r,i){t.postMessage({event:r,data:i})};t.addEventListener("message",function(e){var a=e.data;switch(a.cmd){case"init":var o=JSON.parse(a.config);t.demuxer=new i["a"](r,a.typeSupported,o,a.vendor);try{Object(n["a"])(o.debug===true)}catch(e){console.warn("demuxerWorker: unable to enable logs")}s("init",null);break;case"demux":t.demuxer.push(a.data,a.decryptdata,a.initSegment,a.audioCodec,a.videoCodec,a.timeOffset,a.discontinuity,a.trackSwitch,a.contiguous,a.duration,a.accurateTimeOffset,a.defaultInitPTS);break;default:break}});r.on(a["a"].FRAG_DECRYPTED,s);r.on(a["a"].FRAG_PARSING_INIT_SEGMENT,s);r.on(a["a"].FRAG_PARSED,s);r.on(a["a"].ERROR,s);r.on(a["a"].FRAG_PARSING_METADATA,s);r.on(a["a"].FRAG_PARSING_USERDATA,s);r.on(a["a"].INIT_PTS_FOUND,s);r.on(a["a"].FRAG_PARSING_DATA,function(e,r){var i=[];var a={event:e,data:r};if(r.data1){a.data1=r.data1.buffer;i.push(r.data1.buffer);delete r.data1}if(r.data2){a.data2=r.data2.buffer;i.push(r.data2.buffer);delete r.data2}t.postMessage(a,i)})};t["default"]=l}])["default"]});window.client=function(){var e=window.navigator&&window.navigator.userAgent||"";var t=/AppleWebKit\/([\d.]+)/i.exec(e);var r=t?parseFloat(t.pop()):null;var i=/iPad/i.test(e);var a=/iPhone/i.test(e)&&!i;var n=/iPod/i.test(e);var s=a||i||n;var o=function(){var t=e.match(/OS (\d+)_/i);if(t&&t[1]){return t[1]}return null}();var l=/Android/i.test(e);var u=function(){var t=e.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!t){return null}var r=t[1]&&parseFloat(t[1]);var i=t[2]&&parseFloat(t[2]);if(r&&i){return parseFloat(t[1]+"."+t[2])}else if(r){return r}return null}();var f=l&&/webkit/i.test(e)&&u<2.3;var d=l&&u<5&&r<537;var c=/Firefox/i.test(e);var h=/Edge/i.test(e);var p=!h&&/Chrome/i.test(e);var v=function(){var t=e.match(/Chrome\/(\d+)/);if(t&&t[1]){return parseFloat(t[1])}return null}();var g=/MSIE\s8\.0/.test(e);var m=function(){var t=/MSIE\s(\d+)\.\d/.exec(e);var r=t&&parseFloat(t[1]);if(!r&&/Trident\/7.0/i.test(e)&&/rv:11.0/.test(e)){r=11}return r}();var y=/Safari/i.test(e)&&!p&&!l&&!h;var b=y||s;var _="ontouchstart"in window||window.DocumentTouch&&window.document instanceof window.DocumentTouch;var E="backgroundSize"in window.document.createElement("video").style;var T=e.toLowerCase().match(/micromessenger/i)=="micromessenger";var S=function(e){var t=e.toLowerCase(),r=t.match(/ipad/i)=="ipad",i=t.match(/iphone os/i)=="iphone os",a=t.match(/midp/i)=="midp",n=t.match(/rv:1.2.3.4/i)=="rv:1.2.3.4",s=t.match(/ucweb/i)=="ucweb",o=t.match(/android/i)=="android",l=t.match(/windows ce/i)=="windows ce",u=t.match(/windows mobile/i)=="windows mobile",f=t.match(/micromessenger/i)=="micromessenger",d=t.match(/webview/i)=="webview";return r||i||a||n||s||o||l||u||f||d}(e);return{IS_IPAD:i,IS_IPHONE:a,IS_IPOD:n,IS_IOS:s,IOS_VERSION:o,IS_ANDROID:l,ANDROID_VERSION:u,IS_OLD_ANDROID:f,IS_NATIVE_ANDROID:d,IS_FIREFOX:c,IS_EDGE:h,IS_CHROME:p,CHROME_VERSION:v,IS_IE8:g,IE_VERSION:m,IS_SAFARI:y,IS_ANY_SAFARI:b,TOUCH_ENABLED:_,BACKGROUND_SIZE_SUPPORTED:E,ISWECHAT:T,ISMOBILE:S}}();(function(e){e.fn.tclick=function(e,t,r,i){var a=this;a.on("touchstart.ctb",function(n){n=n.originalEvent;var s=false;var o=n.touches[0];var l={x:o.pageX,y:o.pageY,time:(new Date).getTime()};var u=null;if(e&&typeof e=="function"){e(n,l)}function f(e){e=e.originalEvent;if(e.touches.length>1||e.scale&&e.scale!==1)return;var r=e.touches[0];u={x:r.pageX,y:r.pageY};var i=Math.sqrt(Math.pow(u.x-l.x,2)+Math.pow(u.y-l.y,2));if(i>10){s=true}if(s){if(t&&typeof t=="function"){t(e,u)}}}function d(e){e=e.originalEvent;if(s&&r&&typeof r=="function"){r(e,u)}else{if(i&&typeof i=="function"){i(e,l)}}a.off("touchmove.ctb",f);a.off("touchend.ctb",d)}a.off("touchmove.ctb",f);a.off("touchend.ctb",d);a.on("touchmove.ctb",f);a.on("touchend.ctb",d)})}})(window.jQuery?window.jQuery:{});(function(e){var t=function(t,r){this.defaultOptions={};this.options=e.extend({position:null,startTime:null,endTime:null,autoplay:true,server:"vod",logo:"",speed:{show:true,speedValue:[2.5,2,1.5,1,.5]},poster:"",audioposter:"",controls:true,bigPlayButton:true,urls:{}},this.defaultOptions,r||{});this.video=null;this.$video=null;this.currentUrl="url";this.$wrap=null;this.$container=null;this.$poster=null;this.$audioposter=null;this.$audioButton=null;this.$logo=null;this.$controls=null;this.$topControls=null;this.$parent=t;this.recordCurrent=0;this.hls=null;this.eventArr={};this.eventList={clickType:window.client.ISMOBILE?"touchend":"click",mousedownType:window.client.ISMOBILE?"touchstart":"mousedown",mouseupType:window.client.ISMOBILE?"touchend":"mouseup",mousemoveType:window.client.ISMOBILE?"touchmove":"mousemove"};this.init()};t.prototype.init=function(){var r=this;if(this.options.server=="live"&&this.options.urls.hlsUrl&&this.options.urls.hlsUrl.url){this.options.sourceUrls=this.options.urls.hlsUrl}if(this.options.server=="vod"&&this.options.urls.vodUrl&&this.options.urls.vodUrl.url){this.options.sourceUrls=this.options.urls.vodUrl}this.$video=e('<video src="'+this.options.sourceUrls[this.currentUrl]+'" x5-playsinline="" webkit-playsinline="" x-webkit-airplay="true"  playsinline="" x5-video-player-type="h5" x5-video-player-fullscreen="false" preload="auto"></video>').appendTo(this.$parent);this.video=this.$video.get(0);this.setSrc();var i=this.util.dprAndScale();this.$video.wrap('<div class="xt_video_player_container" style="font-size:'+i.dpr*12+'px"><div class="xt_video_player_wrap"></div></div>').addClass("xt_video_player");function a(){r.$wrap=r.$video.parent().css({height:"100%",width:"100%"})}e(window).on("resize.MultiPlayer",function(){a()});a();this.$container=this.$wrap.parent().css({height:"100%"});this.$video.removeAttr("controls");if(this.options.poster){this.$poster=e('<div class="xt_video_player_poster cf" style="background: url('+this.options.poster+') center center no-repeat;background-size:100% auto"><div class="xt_video_big_play_icon cf"></div></div>').appendTo(this.$wrap)}if(this.options.audioposter){this.$audioposter=e('<div class="xt_video_player_audioposter cf" style="background: url('+this.options.audioposter+') center center no-repeat;background-size:100% auto"></div>').appendTo(this.$wrap);this.$video.on("quality.showhide",function(e,t){if(t.audio){this.$audioposter.show()}else{this.$audioposter.hide()}}.bind(this))}if(this.options.controls)this.$controls=e('<div class="xt_video_player_controls cf"></div>').appendTo(this.$wrap);else this.$controls=e('<div class="xt_video_player_controls cf" style="display: none;opacity: 0;"></div>').appendTo(this.$wrap);if(this.options.sourceUrls.url_audio){this.$topControls=e('<div class="xt_video_player_topcontrols cf"></div>').appendTo(this.$wrap)}if(this.options.logo)this.$logo=e('<div class="xt_video_player_logo cf"><img src="'+this.options.logo+'" /></div>').appendTo(this.$wrap);var n="mousemove";if(window.client.ISMOBILE){n="touchend"}else{n="mousemove";this.$wrap.on({mouseover:function(){this.$video.trigger("video.mouseover")}.bind(this),mouseout:function(){this.$video.trigger("video.mouseout")}.bind(this)})}this.$wrap.on(n,function(){var e=null;return function(){this.$controls.addClass("xt_video_player_controls_show");this.$topControls.addClass("xt_video_player_topcontrols_show");clearTimeout(e);e=setTimeout(function(){if(this.video.paused){return false}this.trigger("hidelist.quality");this.trigger("hidelist.speed");this.$controls.removeClass("xt_video_player_controls_show");this.$topControls.removeClass("xt_video_player_topcontrols_show")}.bind(this),3e3)}.bind(this)}.bind(this)());setTimeout(function(){if(client.ISMOBILE&&client.IS_IOS&&client.ISWECHAT&&this.$poster){this.$poster.show();this.$video.trigger("hideloader");this.$poster.on(this.eventList.clickType,function(){this.$video.trigger("playBtn.toggle");this.$poster.remove()}.bind(this))}}.bind(this),500);this.$video.on("loadedmetadata.init",function(){if(this.$poster){if((client.ISMOBILE||client.IS_SAFARI||!this.options.autoplay)&&(!client.IS_IOS||client.IS_SAFARI)){this.$poster.show();this.$poster.on(this.eventList.clickType,function(){this.$video.trigger("playBtn.toggle");this.$poster.remove()}.bind(this))}}}.bind(this));for(var s in t.prototype){if(t.prototype.hasOwnProperty(s)&&s!=="init"&&s!=="setSrc"&&s!=="on"&&s!=="trigger"&&this[s]instanceof Function){this[s]()}}};t.prototype.util={loadScript:function(e,t){var r=document.createElement("script");r.type="text/javascript";if(r.readyState){r.onreadystatechange=function(){if(r.readyState=="loaded"||r.readyState=="complete"){r.onreadystatechange=null;t()}}}else{r.onload=function(){t()}}r.src=e;document.getElementsByTagName("head")[0].appendChild(r)},loadStyle:function(t){e('<link rel="stylesheet" href="'+t+'"></link>').appendTo(e("head"))},fullScreenApi:function(){(function(){"use strict";var e=typeof window!=="undefined"&&typeof window.document!=="undefined"?window.document:{};var t=typeof module!=="undefined"&&module.exports;var r=typeof Element!=="undefined"&&"ALLOW_KEYBOARD_INPUT"in Element;var i=function(){var t;var r=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]];var i=0;var a=r.length;var n={};for(;i<a;i++){t=r[i];if(t&&t[1]in e){for(i=0;i<t.length;i++){n[r[0][i]]=t[i]}return n}}return false}();var a={change:i.fullscreenchange,error:i.fullscreenerror};var n={request:function(t){var a=i.requestFullscreen;t=t||e.documentElement;if(/ Version\/5\.1(?:\.\d+)? Safari\//.test(navigator.userAgent)){t[a]()}else{t[a](r&&Element.ALLOW_KEYBOARD_INPUT)}},exit:function(){e[i.exitFullscreen]()},toggle:function(e){if(this.isFullscreen){this.exit()}else{this.request(e)}},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(t,r){var i=a[t];if(i){e.addEventListener(i,r,false)}},off:function(t,r){var i=a[t];if(i){e.removeEventListener(i,r,false)}},raw:i};if(!i){if(t){module.exports=false}else{window.screenfull=false}return}Object.defineProperties(n,{isFullscreen:{get:function(){return Boolean(e[i.fullscreenElement])}},element:{enumerable:true,get:function(){return e[i.fullscreenElement]}},enabled:{enumerable:true,get:function(){return Boolean(e[i.fullscreenEnabled])}}});if(t){module.exports=n}else{window.screenfull=n}})()},fullScreenApi2:function(){(function(e){e.fullscreen=function(t,r){var i={support:true,supportcallback:function(){}};var a=this;a.settings={};var n=function(){a.settings=e.extend({},i,r);a.$el=t;a.el=t[0];s()};a.enableFullScreen=function(){var e=a.el;if(e.requestFullScreen){e.requestFullScreen()}else if(e.mozRequestFullScreen){e.mozRequestFullScreen()}else if(e.webkitRequestFullScreen){e.webkitRequestFullScreen()}};a.disableFullScreen=function(){if(document.cancelFullScreen){document.cancelFullScreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}};var s=function(){};n()}})(jQuery)},fullScreenApi1:function(){(function(e,t){if(false){t(require("jquery"))}else{t(window.jQuery)}})(this,function(e){function t(e){return typeof e!=="undefined"}function r(t,r,i){var a=function(){};a.prototype=r.prototype;t.prototype=new a;t.prototype.constructor=t;r.prototype.constructor=r;t._super=r.prototype;if(i){e.extend(t.prototype,i)}}var i=[["",""],["exit","cancel"],["screen","Screen"]];var a=["","o","ms","moz","webkit","webkitCurrent"];function n(e,r){var n;if(typeof e==="string"){r=e;e=document}for(var s=0;s<i.length;++s){r=r.replace(i[s][0],i[s][1]);for(var o=0;o<a.length;++o){n=a[o];n+=o===0?r:r.charAt(0).toUpperCase()+r.substr(1);if(t(e[n])){return e[n]}}}return void 0}var s=navigator.userAgent;var o=n("fullscreenEnabled");var l=s.match(/Android.*Chrome\/(\d+)\./);var u=!!l;var f;if(u){ANDROID_CHROME_VERSION=parseInt(l[1])}var d=(!u||ANDROID_CHROME_VERSION>37)&&t(n("fullscreenElement"))&&(!t(o)||o===true);var c=e.fn.jquery.split(".");var h=parseInt(c[0])<2&&parseInt(c[1])<7;var p=function(){this.__options=null;this._fullScreenElement=null;this.__savedStyles={}};p.prototype={native:n,_DEFAULT_OPTIONS:{styles:{boxSizing:"border-box",MozBoxSizing:"border-box",WebkitBoxSizing:"border-box"},toggleClass:null},__documentOverflow:"",__htmlOverflow:"",_preventDocumentScroll:function(){this.__documentOverflow=document.body.style.overflow;this.__htmlOverflow=document.documentElement.style.overflow;if(!e(this._fullScreenElement).is("body, html")){e("body, html").css("overflow","hidden")}},_allowDocumentScroll:function(){document.body.style.overflow=this.__documentOverflow;document.documentElement.style.overflow=this.__htmlOverflow},_fullScreenChange:function(){if(!this.__options){return}if(!this.isFullScreen()){this._allowDocumentScroll();this._revertStyles();this._triggerEvents();this._fullScreenElement=null}else{this._preventDocumentScroll();this._triggerEvents()}},_fullScreenError:function(t){if(!this.__options){return}this._revertStyles();this._fullScreenElement=null;if(t){e(document).trigger("fscreenerror",[t])}},_triggerEvents:function(){e(this._fullScreenElement).trigger(this.isFullScreen()?"fscreenopen":"fscreenclose");e(document).trigger("fscreenchange",[this.isFullScreen(),this._fullScreenElement])},_saveAndApplyStyles:function(){var t=e(this._fullScreenElement);this.__savedStyles={};for(var r in this.__options.styles){this.__savedStyles[r]=this._fullScreenElement.style[r];this._fullScreenElement.style[r]=this.__options.styles[r]}if(t.is("body")){document.documentElement.style.overflow=this.__options.styles.overflow}if(this.__options.toggleClass){t.addClass(this.__options.toggleClass)}},_revertStyles:function(){var t=e(this._fullScreenElement);for(var r in this.__options.styles){this._fullScreenElement.style[r]=this.__savedStyles[r]}if(t.is("body")){document.documentElement.style.overflow=this.__savedStyles.overflow}if(this.__options.toggleClass){t.removeClass(this.__options.toggleClass)}},open:function(t,r){if(t===this._fullScreenElement){return}if(this.isFullScreen()){this.exit()}this._fullScreenElement=t;this.__options=e.extend(true,{},this._DEFAULT_OPTIONS,r);this._saveAndApplyStyles()},exit:null,isFullScreen:null,isNativelySupported:function(){return d}};var v=function(){v._super.constructor.apply(this,arguments);this.exit=e.proxy(n("exitFullscreen"),document);this._DEFAULT_OPTIONS=e.extend(true,{},this._DEFAULT_OPTIONS,{styles:{width:"100%",height:"100%"}});e(document).bind(this._prefixedString("fullscreenchange")+" MSFullscreenChange",e.proxy(this._fullScreenChange,this)).bind(this._prefixedString("fullscreenerror")+" MSFullscreenError",e.proxy(this._fullScreenError,this))};r(v,p,{VENDOR_PREFIXES:["","o","moz","webkit"],_prefixedString:function(t){return e.map(this.VENDOR_PREFIXES,function(e){return e+t}).join(" ")},open:function(e,t){v._super.open.apply(this,arguments);var r=n(e,"requestFullscreen");r.call(e)},exit:e.noop,isFullScreen:function(){return n("fullscreenElement")!==null},element:function(){return n("fullscreenElement")}});var g=function(){g._super.constructor.apply(this,arguments);this._DEFAULT_OPTIONS=e.extend({},this._DEFAULT_OPTIONS,{styles:{position:"fixed",zIndex:"2147483647",left:0,top:0,bottom:0,right:0}});this.__delegateKeydownHandler()};r(g,p,{__isFullScreen:false,__delegateKeydownHandler:function(){var t=e(document);t.delegate("*","keydown.fullscreen",e.proxy(this.__keydownHandler,this));var r=h?t.data("events"):e._data(document).events;var i=r["keydown"];if(!h){i.splice(0,0,i.splice(i.delegateCount-1,1)[0])}else{r.live.unshift(r.live.pop())}},__keydownHandler:function(e){if(this.isFullScreen()&&e.which===27){this.exit();return false}return true},_revertStyles:function(){g._super._revertStyles.apply(this,arguments);this._fullScreenElement.offsetHeight},open:function(e){g._super.open.apply(this,arguments);this.__isFullScreen=true;this._fullScreenChange()},exit:function(){if(!this.__isFullScreen){return}this.__isFullScreen=false;this._fullScreenChange()},isFullScreen:function(){return this.__isFullScreen},element:function(){return this.__isFullScreen?this._fullScreenElement:null}});e.fullscreen=d?new v:new g;e.fn.fullscreen=function(t){var r=this[0];t=e.extend({toggleClass:null,overflow:"hidden"},t);t.styles={overflow:t.overflow};delete t.overflow;if(r){e.fullscreen.open(r,t);typeof t.xmcalback=="function"&&t.xmcalback()}return this};return e.fullscreen})},timeFull:function(e){var t,r,i;var a=function(e){if(e<10){return"0"+e}else{return""+e}};if(e<0){e=0}i=Math.floor(e);r=Math.floor(i/60);t=Math.floor(r/60);i=i%60;r=r%60;return""+a(t)+":"+a(r)+":"+a(i%60)},dprAndScale:function(){var e=window.document;var t=e.documentElement;var r=e.querySelector('meta[name="viewport"]');var i=e.querySelector('meta[name="flexible"]');var a=0;var n=0;if(r){var s=r.getAttribute("content").match(/initial\-scale=([\d\.]+)/);if(s){n=parseFloat(s[1]);a=parseInt(1/n)}}else if(i){var o=i.getAttribute("content");if(o){var l=o.match(/initial\-dpr=([\d\.]+)/);var u=o.match(/maximum\-dpr=([\d\.]+)/);if(l){a=parseFloat(l[1]);n=parseFloat((1/a).toFixed(2))}if(u){a=parseFloat(u[1]);n=parseFloat((1/a).toFixed(2))}}}if(!a&&!n){var f=window.navigator.appVersion.match(/android/gi);var d=window.navigator.appVersion.match(/iphone/gi);var c=window.devicePixelRatio;if(d){if(c>=3&&(!a||a>=3)){a=3}else if(c>=2&&(!a||a>=2)){a=2}else{a=1}}else{a=1}n=1/a}return{dpr:a,scale:n}},md5:function(){(function(e){"use strict";function t(e,t){var r=(e&65535)+(t&65535),i=(e>>16)+(t>>16)+(r>>16);return i<<16|r&65535}function r(e,t){return e<<t|e>>>32-t}function i(e,i,a,n,s,o){return t(r(t(t(i,e),t(n,o)),s),a)}function a(e,t,r,a,n,s,o){return i(t&r|~t&a,e,t,n,s,o)}function n(e,t,r,a,n,s,o){return i(t&a|r&~a,e,t,n,s,o)}function s(e,t,r,a,n,s,o){return i(t^r^a,e,t,n,s,o)}function o(e,t,r,a,n,s,o){return i(r^(t|~a),e,t,n,s,o)}function l(e,r){e[r>>5]|=128<<r%32;e[(r+64>>>9<<4)+14]=r;var i,l,u,f,d,c=1732584193,h=-271733879,p=-1732584194,v=271733878;for(i=0;i<e.length;i+=16){l=c;u=h;f=p;d=v;c=a(c,h,p,v,e[i],7,-680876936);v=a(v,c,h,p,e[i+1],12,-389564586);p=a(p,v,c,h,e[i+2],17,606105819);h=a(h,p,v,c,e[i+3],22,-1044525330);c=a(c,h,p,v,e[i+4],7,-176418897);v=a(v,c,h,p,e[i+5],12,1200080426);p=a(p,v,c,h,e[i+6],17,-1473231341);h=a(h,p,v,c,e[i+7],22,-45705983);c=a(c,h,p,v,e[i+8],7,1770035416);v=a(v,c,h,p,e[i+9],12,-1958414417);p=a(p,v,c,h,e[i+10],17,-42063);h=a(h,p,v,c,e[i+11],22,-1990404162);c=a(c,h,p,v,e[i+12],7,1804603682);v=a(v,c,h,p,e[i+13],12,-40341101);p=a(p,v,c,h,e[i+14],17,-1502002290);h=a(h,p,v,c,e[i+15],22,1236535329);c=n(c,h,p,v,e[i+1],5,-165796510);v=n(v,c,h,p,e[i+6],9,-1069501632);p=n(p,v,c,h,e[i+11],14,643717713);h=n(h,p,v,c,e[i],20,-373897302);c=n(c,h,p,v,e[i+5],5,-701558691);v=n(v,c,h,p,e[i+10],9,38016083);p=n(p,v,c,h,e[i+15],14,-660478335);h=n(h,p,v,c,e[i+4],20,-405537848);c=n(c,h,p,v,e[i+9],5,568446438);v=n(v,c,h,p,e[i+14],9,-1019803690);p=n(p,v,c,h,e[i+3],14,-187363961);h=n(h,p,v,c,e[i+8],20,1163531501);c=n(c,h,p,v,e[i+13],5,-1444681467);v=n(v,c,h,p,e[i+2],9,-51403784);p=n(p,v,c,h,e[i+7],14,1735328473);h=n(h,p,v,c,e[i+12],20,-1926607734);c=s(c,h,p,v,e[i+5],4,-378558);v=s(v,c,h,p,e[i+8],11,-2022574463);p=s(p,v,c,h,e[i+11],16,1839030562);h=s(h,p,v,c,e[i+14],23,-35309556);c=s(c,h,p,v,e[i+1],4,-1530992060);v=s(v,c,h,p,e[i+4],11,1272893353);p=s(p,v,c,h,e[i+7],16,-155497632);h=s(h,p,v,c,e[i+10],23,-1094730640);c=s(c,h,p,v,e[i+13],4,681279174);v=s(v,c,h,p,e[i],11,-358537222);p=s(p,v,c,h,e[i+3],16,-722521979);h=s(h,p,v,c,e[i+6],23,76029189);c=s(c,h,p,v,e[i+9],4,-640364487);v=s(v,c,h,p,e[i+12],11,-421815835);p=s(p,v,c,h,e[i+15],16,530742520);h=s(h,p,v,c,e[i+2],23,-995338651);c=o(c,h,p,v,e[i],6,-198630844);v=o(v,c,h,p,e[i+7],10,1126891415);p=o(p,v,c,h,e[i+14],15,-1416354905);h=o(h,p,v,c,e[i+5],21,-57434055);c=o(c,h,p,v,e[i+12],6,1700485571);v=o(v,c,h,p,e[i+3],10,-1894986606);p=o(p,v,c,h,e[i+10],15,-1051523);h=o(h,p,v,c,e[i+1],21,-2054922799);c=o(c,h,p,v,e[i+8],6,1873313359);v=o(v,c,h,p,e[i+15],10,-30611744);p=o(p,v,c,h,e[i+6],15,-1560198380);h=o(h,p,v,c,e[i+13],21,1309151649);c=o(c,h,p,v,e[i+4],6,-145523070);v=o(v,c,h,p,e[i+11],10,-1120210379);p=o(p,v,c,h,e[i+2],15,718787259);h=o(h,p,v,c,e[i+9],21,-343485551);c=t(c,l);h=t(h,u);p=t(p,f);v=t(v,d)}return[c,h,p,v]}function u(e){var t,r="";for(t=0;t<e.length*32;t+=8){r+=String.fromCharCode(e[t>>5]>>>t%32&255)}return r}function f(e){var t,r=[];r[(e.length>>2)-1]=undefined;for(t=0;t<r.length;t+=1){r[t]=0}for(t=0;t<e.length*8;t+=8){r[t>>5]|=(e.charCodeAt(t/8)&255)<<t%32}return r}function d(e){return u(l(f(e),e.length*8))}function c(e,t){var r,i=f(e),a=[],n=[],s;a[15]=n[15]=undefined;if(i.length>16){i=l(i,e.length*8)}for(r=0;r<16;r+=1){a[r]=i[r]^909522486;n[r]=i[r]^1549556828}s=l(a.concat(f(t)),512+t.length*8);return u(l(n.concat(s),512+128))}function h(e){var t="0123456789abcdef",r="",i,a;for(a=0;a<e.length;a+=1){i=e.charCodeAt(a);r+=t.charAt(i>>>4&15)+t.charAt(i&15)}return r}function p(e){return unescape(encodeURIComponent(e))}function v(e){return d(p(e))}function g(e){return h(v(e))}function m(e,t){return c(p(e),p(t))}function y(e,t){return h(m(e,t))}function b(e,t,r){if(!t){if(!r){return g(e)}return v(e)}if(!r){return y(t,e)}return m(t,e)}e.md5=b})(e)},timeFormat:function(e){var t=e.split(":");return t[0]*60*60+t[1]*60+t[2]*1}};t.prototype.beforeunload=function(){e(window).on("beforeunload",function(){}.bind(this))};t.prototype.setSrc=function(t,r){var i=this;this.video.pause();i.hls=null;var a=this.options.sourceUrls[this.currentUrl];if(t)a=this.options.sourceUrls[t];if(a.indexOf(".m3u8")!=-1&&!client.ISMOBILE&&!client.IS_SAFARI){e("#debug").html(a);i.hls=new Hls;i.hls.loadSource(a);i.hls.attachMedia(i.video);i.hls.on(Hls.Events.MANIFEST_PARSED,function(){this.video.currentTime=this.recordCurrent}.bind(i))}else{this.$video.attr({src:a})}};t.prototype.continued=function(){if(this.options.position){this.$video.on("loadedmetadata.continued",function(){if(this.video.duration-this.options.position>5){this.video.currentTime=this.options.position}}.bind(this))}};t.prototype.autoplay=function(){this.$video.on("loadedmetadata.autoplay",function(){if(!client.ISMOBILE&&!client.IS_SAFARI&&(this.$video.prop("autoplay")||this.options.autoplay)){this.$video.trigger("playBtn.toggle")}else{this.$controls.addClass("xt_video_player_controls_show");this.$topControls.addClass("xt_video_player_topcontrols_show")}}.bind(this))};t.prototype.playBtn=function(){var t="";if(this.$video.prop("autoplay")){t="xt_video_player_play_btn_pause"}else{t=""}var r=e('<div class="xt_video_player_play_btn fl '+t+'"></div>').on(this.eventList.clickType,function(e){this.$video.trigger("playBtn.toggle")}.bind(this)).appendTo(this.$controls);if(!window.client.ISMOBILE){this.$video.on("click",function(){this.$video.trigger("playBtn.toggle")}.bind(this))}this.$video.on("ended",function(){r.removeClass("xt_video_player_play_btn_pause")});this.$video.on("play",function(){r.addClass("xt_video_player_play_btn_pause")});this.$video.on("pause",function(){r.removeClass("xt_video_player_play_btn_pause")}.bind(this));this.$video.on("playBtn.toggle",function(){if(this.video.paused){this.video.play()}else{this.video.pause()}if(this.$poster){this.$poster.hide();this.$poster.off(this.eventList.clickType)}}.bind(this))};t.prototype.loader=function(){var t='<div class="spinner"> <div class="rect1"></div> <div class="rect2"></div> <div class="rect3"></div> <div class="rect4"></div> <div class="rect5"></div> </div>';var r=e(t).appendTo(this.$wrap);this.$video.on("loadstart waiting",function(){r.show()});this.$video.on("loadedmetadata.loader canplay loadeddata playing hideloader",function(e){r.hide()});this.$video.on("loader.isShow",function(e,t){t.isShow=r.is(":visible")})};t.prototype.currentTimeDisplay=function(){var t=this;if(t.options.server=="live"&&this.options.sourceUrls.url.indexOf(".m3u8")!=-1){t.options.server="live"}else{t.options.server="vod"}var r=function(e){if(e<10){e="0"+e.toString()}return e};var i=e('<div class="xt_video_player_current_time_display fl"></div>').appendTo(this.$controls);var a=null,n=null;if(this.options.server=="live"){this.$video.on("loadedmetadata.currenttime",function(){if(this.video.duration==1/0){i.html("直播")}else{i.html("<span>0:00</span> / <span>0:00</span>");a=i.find("span").eq(0);n=i.find("span").eq(1);var e=parseInt(this.video.duration/60);var t=parseInt(this.video.duration%60);n.html(e+":"+r(t))}}.bind(this));this.$video.on("durationchange.currenttime",function(){if(this.video.duration==1/0){i.html("直播")}else{i.html("<span>0:00</span> / <span>0:00</span>");a=i.find("span").eq(0);n=i.find("span").eq(1);var e=parseInt(this.video.duration/60);var t=parseInt(this.video.duration%60);n.html(e+":"+r(t))}}.bind(this))}else{this.$video.on("loadedmetadata.currenttime",function(){if(this.video.duration==1/0){i.html("回看")}else{i.html("<span>0:00</span> / <span>0:00</span>");a=i.find("span").eq(0);n=i.find("span").eq(1);var e=parseInt(this.video.duration/60);var t=parseInt(this.video.duration%60);n.html(e+":"+r(t))}}.bind(this));this.$video.on("durationchange.currenttime",function(){if(this.video.duration==1/0){i.html("回看")}else{i.html("<span>0:00</span> / <span>0:00</span>");a=i.find("span").eq(0);n=i.find("span").eq(1);var e=parseInt(this.video.duration/60);var t=parseInt(this.video.duration%60);n.html(e+":"+r(t))}}.bind(this))}this.$video.on("timeupdate.currenttime",function(e){var t=parseInt(this.video.currentTime/60);var i=parseInt(this.video.currentTime%60);if(a)a.html(t+":"+r(i))}.bind(this))};t.prototype.volume=function(){this.video.volume=1;if(window.client.ISMOBILE)return false;var t=e('<div class="xt_video_player_volume fl cf"> <div class="xt_video_player_volume_icon fl"></div> <div class="xt_video_player_volume_wrap fl"> <div class="xt_video_player_volume_progress"> <div class="xt_video_player_volume_block"> </div> <div class="xt_video_player_volume_seek"></div> </div> </div> </div>').appendTo(this.$controls);var r=t.find(".xt_video_player_volume_progress");var i=t.find(".xt_video_player_volume_seek").css({left:this.video.volume*100+"%"});var a=t.find(".xt_video_player_volume_block").css({width:this.video.volume*100+"%"});var n=t.find(".xt_video_player_volume_icon");var s=e(document);var o=0;var l=parseInt(r.width());var u=null;var f=.8;var d=function(e){var t=e.pageX-o;if(t<0){t=0}if(t>l){t=l}i.css({left:t});a.css({width:t});var r=t/l;this.video.volume=r;f=r;if(r<=0){n.addClass("xt_video_player_volume_muted")}else{n.removeClass("xt_video_player_volume_muted")}}.bind(this);i.on("mousedown",function(){u=true;o=r.offset().left;s.on("mousemove",d)});s.on("mouseup",function(){if(u){u=false;s.off("mousemove",d)}});r.on("click",function(e){o=r.offset().left;var t=e.pageX-o;if(t<0){t=0}if(t>l){t=l}a.css({width:t});i.css({left:t});var s=t/l;this.video.volume=s;f=s;if(s<=0){n.addClass("xt_video_player_volume_muted")}else{n.removeClass("xt_video_player_volume_muted")}}.bind(this));var c=null;var h=t.find(".xt_video_player_volume_wrap");n.on("click",function(t){var r=e(t.target);if(r.hasClass("xt_video_player_volume_muted")){this.video.volume=f;var n=l*f;i.css("left",n);a.css("width",n);r.removeClass("xt_video_player_volume_muted")}else{this.video.volume=0;i.css("left",0);a.css("width",0);r.addClass("xt_video_player_volume_muted")}}.bind(this)).on({mouseover:function(){clearTimeout(c);h.css("width",100)},mouseout:function(){c=setTimeout(function(){h.css("width",0)},100)}});h.on("mouseover",function(){clearTimeout(c)}).on("mouseout",function(){c=setTimeout(function(){h.css("width",0)},100)})};t.prototype.fullScreen=function(){this.util.fullScreenApi();if(!screenfull.enabled||window.client.ISWECHAT&&(window.client.IS_ANDROID||window.client.IS_OLD_ANDROID)){return false}var t=e('<div class="xt_video_player_fullscreen fr"></div>').appendTo(this.$controls);t.on(this.eventList.clickType,function(){if(t.hasClass("xt_video_player_fullscreen_cancel")){this.$wrap.add(this.$video).removeClass("xt_video_player_full_screen");t.removeClass("xt_video_player_fullscreen_cancel")}else{this.$wrap.add(this.$video).addClass("xt_video_player_full_screen");t.addClass("xt_video_player_fullscreen_cancel")}screenfull.toggle(this.$wrap[0])}.bind(this))};t.prototype.progress=function(){var t=this;var r=true;if(t.options.server=="live"&&this.options.sourceUrls.url.indexOf(".m3u8")!=-1){r=false}if(r){var i=e('<div class="xt_video_player_progress"><div class="xt_video_player_progress_bufferTime"></div><div class="xt_video_player_progress_currentTime"></div><div class="xt_video_player_seek_handle_wrap"><div class="xt_video_player_seek_handle"><div class="xt_video_player_seek_handle_inner"></div></div></div></div>').appendTo(this.$controls);var a=i.find(".xt_video_player_progress_currentTime");var n=i.find(".xt_video_player_progress_bufferTime");var s=this.$seekHandleWrap=i.find(".xt_video_player_seek_handle_wrap");var o=i.find(".xt_video_player_seek_handle");var l=0;var u=0;var f=0,d=0,c=1;if(window.client.ISMOBILE){i.tclick(function(e,r){l=t.$video.offset().left;o.css({left:r.x-l});a.css({width:r.x-l})},null,null,function(e,r){var i=(r.x-l)/t.$video.width();var a=t.video.duration*i;t.video.currentTime=a;t.video.play()});o.tclick(function(e,r){e.stopPropagation();t.video.pause();u=true;l=s.offset().left},function(e,t){var r=t.x-l;if(r>0){if(r>parseInt(s.width())){d=parseInt(s.width())}else{d=r}}o.css({left:d});a.css({width:d})},function(e,r){e.stopPropagation();if(u){c=(r.x-l)/parseInt(s.width());if(c>1){c=1}var i=c*t.video.duration;t.video.currentTime=i;t.video.play();u=false}},null)}else{i.on("click",function(e){l=this.$video.offset().left;o.css({left:e.pageX-l});a.css({width:e.pageX-l});var t=(e.pageX-l)/this.$video.width();var r=this.video.duration*t;this.video.currentTime=r;this.video.play()}.bind(this));var h=function(e){var t=0;var r=e.pageX-l;if(r>0){if(r>parseInt(s.width())){t=parseInt(s.width())}else{t=r}}o.css({left:t});a.css({width:t})}.bind(this);o.on("mousedown",function(t){t.stopPropagation();this.video.pause();u=true;l=s.offset().left;e(document).on("mousemove",h)}.bind(this));e(document).on("mouseup",function(t){t.stopPropagation();if(u){e(document).off(this.eventList.mousemoveType,h);var r=(t.pageX-l)/parseInt(s.width());if(r>1){r=1}var i=r*this.video.duration;this.video.currentTime=i;this.video.play();u=false}}.bind(this))}this.$video.on("timeupdate.progress",function(e){var t=this.currentTime/this.duration*100+"%";a.css({width:t});o.css({left:t})});this.$video.on("progress",function(e){if(this.buffered.length<1){return false}var t=this.buffered.end(0)/this.duration*100+"%";n.css({width:t})});this.$video.on("loadedmetadata.progress durationchange.progress",function(){if(this.video.duration==1/0){e(".xt_video_player_progress").hide()}else{e(".xt_video_player_progress").show()}}.bind(this))}};t.prototype.share=function(){if(client.ISMOBILE&&!client.ISWECHAT){this.$share=e('<div class="xt_video_share"></div>').appendTo(this.$topControls);this.$share.on(this.eventList.clickType,function(e){this.trigger("share",e)}.bind(this))}};t.prototype.audioOrvideo=function(){var t=this;if(this.options.sourceUrls.url_audio){t.$audioButton=e('<div class="xt_video_audio_switch"><span class="video">观看视频</span><span class="audio xt_video_player_show">收听音频</span></div>').appendTo(t.$topControls).css({right:(this.$share?3:1)+"em"});t.$audioButton.on(this.eventList.clickType,function(){var e=this.currentUrl;if(this.$audioButton.find("span.xt_video_player_show").hasClass("audio")){this.$audioButton.find("span").removeClass("xt_video_player_show");this.$audioButton.find("span.video").addClass("xt_video_player_show");e="url_audio"}else{this.$audioButton.find("span").removeClass("xt_video_player_show");this.$audioButton.find("span.audio").addClass("xt_video_player_show");e=this.currentUrl}this.recordCurrent=this.video.currentTime;this.$wrap.css({height:this.$video.height()});this.setSrc(e,true);this.$video.trigger("quality.changed");this.$video.trigger("quality.showhide",{audio:e=="url_audio"?true:false});var t=function(e){if(this.options.sourceUrls[this.currentUrl].indexOf(".m3u8")!=-1&&!client.ISMOBILE&&!client.IS_SAFARI){}else{setTimeout(function(){this.video.currentTime=this.recordCurrent;this.video.play()}.bind(this),200)}if(this.video.pause)this.video.play();this.$video.off("loadedmetadata.audio",t)}.bind(this);this.$video.on("loadedmetadata.audio",t)}.bind(t))}},t.prototype.title=function(){if(this.options.title){this.$title=e('<div class="xt_video_title">'+this.options.title+"</div>").appendTo(this.$topControls).css({"padding-right":(this.$share?9.5:6.5)+"em"})}};t.prototype.quality=function(){if(!this.options||!this.options.sourceUrls||!this.options.sourceUrls.url){return false}var t=0;for(var r in this.options.sourceUrls){if(!!this.options.sourceUrls[r]){if(r.indexOf("url_")!=-1&&r.indexOf("_audio")==-1){t=1}}}if(!t){return false}var i="";for(var r in this.options.sourceUrls){if(r!="url_audio"&&r!="server"&&r!="type"){if(r=="url"){i+='<li class="xt_video_player_common_active" key="'+r+'">标清</li>'}else if(r=="url_high"&&!!this.options.sourceUrls[r]){i+='<li key="'+r+'">高清</li>'}else if(!!this.options.sourceUrls[r]){i+='<li key="'+r+'">'+r.replace("url_","")+"P</li>"}}}var a=e('<div class="xt_video_player_quality xt_video_player_common fr"><div class="xt_video_player_common_value">标清</div><ul class="xt_video_player_common_list">'+i+"</ul></div>").appendTo(this.$controls);var n=a.find(".xt_video_player_common_list");var s=a.find(".xt_video_player_common_value");if(window.client.ISMOBILE){a.on({touchend:function(){if(n.hasClass("xt_video_player_show")){n.removeClass("xt_video_player_show");a.removeClass("hover")}else{n.addClass("xt_video_player_show");a.addClass("hover")}}})}else{a.on({mouseover:function(){n.addClass("xt_video_player_show");a.addClass("hover")},mouseout:function(){n.removeClass("xt_video_player_show");a.removeClass("hover")}})}this.on("hidelist.quality",function(){n.removeClass("xt_video_player_show");a.removeClass("hover")}.bind(this));n.find("li").on(this.eventList.clickType,function(t){t.stopPropagation();a.removeClass("hover");var r=e(t.target);if(r.hasClass("xt_video_player_common_active")){return false}s.html(r.html());r.addClass("xt_video_player_common_active").siblings().removeClass("xt_video_player_common_active");this.recordCurrent=this.video.currentTime;this.$wrap.css({height:this.$video.height()});this.currentUrl=r.attr("key");this.setSrc(null,true);this.$video.trigger("quality.changed",{quality:r.html()});n.removeClass("xt_video_player_show");var i=function(e){if(this.options.sourceUrls[this.currentUrl].indexOf(".m3u8")!=-1&&!client.ISMOBILE&&!client.IS_SAFARI){}else{setTimeout(function(){this.video.currentTime=this.recordCurrent;this.video.play()}.bind(this),200)}if(this.video.pause)this.video.play();this.$video.off("loadedmetadata.video",i)}.bind(this);this.$video.on("loadedmetadata.video",i)}.bind(this));this.$video.on("quality.showhide",function(e,t){if(t.audio){a.hide()}else{a.show()}})};t.prototype.speed=function(){var t=this;var r=false;if(this.options.speed&&this.options.speed.show){r=true}if(t.options.server=="live"&&this.options.sourceUrls.url.indexOf(".m3u8")!=-1){r=false}var i=1;this.$video.on("loadedmetadata.speed",function(){if(this.video.duration==1/0){e(".xt_video_player_speed").hide()}else if(r)e(".xt_video_player_speed").show();this.video.playbackRate=i}.bind(this));if(r&&!window.client.ISMOBILE){var a="";this.options.speed.speedValue.forEach(function(e){if(e==i){a+='<li data-speed="'+e+'" class="xt_video_player_common_active">'+e.toFixed(2)+"x</li>"}else{a+='<li data-speed="'+e+'">'+e.toFixed(2)+"x</li>"}});var n=e('<div class="xt_video_player_speed xt_video_player_common fr"><div class="xt_video_player_common_value">'+i.toFixed(2)+'x</div><ul class="xt_video_player_common_list">'+a+"</ul></div>").appendTo(this.$controls);if(window.client.ISMOBILE){n.on("touchend",function(){if(s.hasClass("xt_video_player_show")){s.removeClass("xt_video_player_show");n.removeClass("hover")}else{s.addClass("xt_video_player_show");n.addClass("hover")}})}else{n.on({mouseover:function(){s.addClass("xt_video_player_show");n.addClass("hover")},mouseout:function(){s.removeClass("xt_video_player_show");n.removeClass("hover")}})}this.on("hidelist.speed",function(){s.removeClass("xt_video_player_show");n.removeClass("hover")}.bind(this));var s=n.find(".xt_video_player_common_list");var o=n.find(".xt_video_player_common_value");var l=i;n.find("li").on(this.eventList.clickType,function(t){t.stopPropagation();n.removeClass("hover");var r=e(t.target);if(r.hasClass("xt_video_player_common_active")){return false}l=e(t.target).data("speed");o.html(r.html());this.video.playbackRate=l;r.addClass("xt_video_player_common_active").siblings().removeClass("xt_video_player_common_active");s.removeClass("xt_video_player_show")}.bind(this));this.$video.on("quality.changed",function(t){this.$video.on("loadedmetadata.speed",function(){if(this.video.duration==1/0){e(".xt_video_player_speed").hide();l=i}else{e(".xt_video_player_speed").show()}this.video.playbackRate=l}.bind(this))}.bind(this))}};t.prototype.startAndEnd=function(){if(this.options.startTime){this.$video.on("loadedmetadata.startend",function(){this.video.currentTime=this.options.startTime}.bind(this))}if(this.options.endTime){this.$video.on("timeupdate.startend",function(){if(this.video.currentTime>=parseInt(this.options.endTime)){this.video.load()}}.bind(this))}};t.prototype.resurrect=function(){var e=null;this.$video.on("timeupdate.startend",function(){clearTimeout(e);e=setTimeout(function(){var e={};this.$video.trigger("loader.isShow",e);if(!this.video.paused&&!e.isShow){this.video.currentTime=this.video.currentTime-.1}}.bind(this),3e3)}.bind(this))};t.prototype.on=function(e,t){var r=this;var i=false;for(var a in r.eventArr){if(a==e)i=true}if(!i)r.eventArr[e]=[];r.eventArr[e].push(t)};t.prototype.trigger=function(t,r){var i=this;if(!!i.eventArr[t]&&i.eventArr[t].length>0){e.each(i.eventArr[t],function(e,t){t(r)})}};t.prototype.events=function(){var t=this;var r=["loadstart","progress","suspend","abort","error","emptied","stalled","play","pause","loadedmetadata","loadeddata","waiting","playing","canplay","canplaythrough","seeking","seeked","timeupdate","ended","ratechange","readystatechange","durationchange","volumechange"];e.each(r,function(e,r){t.$video.on(r,function(e){var r=e.type;t.trigger(r,e)})})};window.MultiPlayer=t})(window.jQuery);